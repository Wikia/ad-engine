{"version":3,"sources":["webpack://adEngine/webpack/bootstrap","webpack://adEngine/external \"@wikia/ad-engine\"","webpack://adEngine/external \"babel-runtime/core-js/object/keys\"","webpack://adEngine/external \"babel-runtime/helpers/createClass\"","webpack://adEngine/external \"babel-runtime/helpers/classCallCheck\"","webpack://adEngine/external \"babel-runtime/core-js/promise\"","webpack://adEngine/external \"babel-runtime/core-js/object/assign\"","webpack://adEngine/./src/ad-services/bill-the-lizard/executor.js","webpack://adEngine/./src/ad-services/bill-the-lizard/projects-handler.js","webpack://adEngine/./src/ad-services/bill-the-lizard/index.js","webpack://adEngine/./src/ad-services/krux/index.js","webpack://adEngine/./src/ad-services/index.js"],"names":["logGroup","Executor","methods","name","callback","utils","logger","methodName","model","prediction","Error","models","response","forEach","modelName","result","executableModel","find","executable","definedMethods","execute","ProjectsHandler","projects","projectNames","context","get","projectParameters","enabledProjectNames","filter","isEnabled","includes","parameters","isNextModelExecutable","isProperGeo","countries","push","buildUrl","host","endpoint","queryParameters","params","key","encodeURI","join","httpRequest","timeout","request","window","XMLHttpRequest","url","open","responseType","resolve","reject","addEventListener","abort","onload","status","message","send","getQueryParameters","now","Date","day","getDay","map","h","getHours","dow","overridePredictions","newValue","queryString","parseInt","BillTheLizard","executor","projectsHandler","predictions","getEnabledModelsWithParams","length","then","parsePredictions","executeMethods","targeting","definition","version","suffix","indexOf","dfp_targeting","set","billTheLizard","loadScript","firstScript","document","getElementsByTagName","kruxId","kruxScript","createElement","type","id","async","src","parentNode","insertBefore","getKruxData","localStorage","navigator","cookieEnabled","match","cookie","decodeURI","Krux","args","q","exportPageParams","importUserData","value","user","segments","split","krux"],"mappings":"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","file":"ad-services.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","module.exports = require(\"@wikia/ad-engine\");","module.exports = require(\"babel-runtime/core-js/object/keys\");","module.exports = require(\"babel-runtime/helpers/createClass\");","module.exports = require(\"babel-runtime/helpers/classCallCheck\");","module.exports = require(\"babel-runtime/core-js/promise\");","module.exports = require(\"babel-runtime/core-js/object/assign\");","import { utils } from '@wikia/ad-engine';\n\nconst logGroup = 'executor';\n\n/**\n * Bill the Lizard methods executor\n */\nexport class Executor {\n\tconstructor() {\n\t\tthis.methods = {};\n\t}\n\n\t/**\n\t * Registeres new method\n\t * @param {string} name\n\t * @param {function} callback\n\t */\n\tregister(name, callback) {\n\t\tutils.logger(logGroup, `method ${name} registered`);\n\t\tthis.methods[name] = callback;\n\t}\n\n\t/**\n\t * Executes method by name\n\t * @param {string} methodName\n\t * @param {ModelDefinition} model\n\t * @param {number|undefined} prediction\n\t */\n\texecute(methodName, model, prediction) {\n\t\tconst callback = this.methods[methodName];\n\n\t\tif (typeof callback !== 'function') {\n\t\t\tthrow Error(`${methodName} is not executable`);\n\t\t}\n\n\t\tutils.logger(logGroup, `executing ${methodName} method`, model.name, prediction);\n\t\tcallback(model, prediction);\n\t}\n\n\t/**\n\t * Executes all methods defined in given model based on service response\n\t * @param {ModelDefinition[]} models\n\t * @param {Object} response\n\t */\n\texecuteMethods(models, response) {\n\t\tObject.keys(response).forEach((modelName) => {\n\t\t\tconst { result } = response[modelName];\n\n\t\t\tconst executableModel = models.find(model => model.name === modelName && model.executable);\n\t\t\tif (!executableModel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst definedMethods = executableModel[`on_${result}`];\n\t\t\tif (!definedMethods) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdefinedMethods.forEach(methodName => this.execute(methodName, executableModel, result));\n\t\t});\n\t}\n}\n","import { context, utils } from '@wikia/ad-engine';\n\nconst logGroup = 'project-handler';\n\n/**\n * Bill the Lizard projects handler\n */\nexport class ProjectsHandler {\n\tconstructor() {\n\t\tthis.projects = {};\n\t}\n\n\t/**\n\t * Enables project by name\n\t * @param {string} name\n\t */\n\tenable(name) {\n\t\tutils.logger(logGroup, `project ${name} enabled`);\n\t\tthis.projects[name] = true;\n\t}\n\n\t/**\n\t * Checks whether project is enabled\n\t * @param {string} name\n\t * @returns {boolean}\n\t */\n\tisEnabled(name) {\n\t\treturn !!this.projects[name];\n\t}\n\n\t/**\n\t * Returns all geo-enabled models' definitions based on enabled projects\n\t * @param {string[]} projectNames\n\t * @returns {{models: ModelDefinition[], parameters: Object}}\n\t */\n\tgetEnabledModelsWithParams(projectNames) {\n\t\tconst projects = context.get('services.billTheLizard.projects');\n\t\tconst projectParameters = context.get('services.billTheLizard.parameters');\n\t\tconst enabledProjectNames = Object.keys(projects)\n\t\t\t.filter(name => (this.isEnabled(name) && projectNames.includes(name)));\n\t\tconst models = [];\n\t\tconst parameters = {};\n\n\t\tenabledProjectNames.forEach((name) => {\n\t\t\t// Only first enabled model in project is executable\n\t\t\tlet isNextModelExecutable = true;\n\n\t\t\tprojects[name].forEach((model) => {\n\t\t\t\tif (utils.isProperGeo(model.countries, model.name)) {\n\t\t\t\t\tmodel.executable = isNextModelExecutable;\n\t\t\t\t\tisNextModelExecutable = false;\n\t\t\t\t\tmodels.push(model);\n\t\t\t\t\tObject.assign(parameters, projectParameters[name]);\n\t\t\t\t} else {\n\t\t\t\t\tmodel.executable = false;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn {\n\t\t\tmodels,\n\t\t\tparameters\n\t\t};\n\t}\n}\n","import { context, utils } from '@wikia/ad-engine';\nimport { Executor } from './executor';\nimport { ProjectsHandler } from './projects-handler';\n\n/**\n * @typedef {Object} ModelDefinition\n * @property {boolean|undefined} executable\n * @property {string[]} countries\n * @property {string} name\n * @property {function} on_*\n */\n\nconst logGroup = 'bill-the-lizard';\n\n/**\n * Builds endpoint url\n * @param {string} host\n * @param {string} endpoint\n * @param {Object} queryParameters (key-value pairs for query parameters)\n * @returns {string}\n */\nfunction buildUrl(host, endpoint, queryParameters = {}) {\n\tconst params = [];\n\n\tObject.keys(queryParameters).forEach((key) => {\n\t\tparams.push(`${key}=${queryParameters[key]}`);\n\t});\n\n\treturn `${host}/${endpoint}?${encodeURI(params.join('&'))}`;\n}\n\n/**\n * Requests service\n * @param {string} host\n * @param {string} endpoint\n * @param {Object} queryParameters (key-value pairs for query parameters)\n * @param {number} timeout\n * @returns {Promise}\n */\nfunction httpRequest(host, endpoint, queryParameters = {}, timeout = 0) {\n\tconst request = new window.XMLHttpRequest();\n\tconst url = buildUrl(host, endpoint, queryParameters);\n\n\trequest.open('GET', url, true);\n\trequest.responseType = 'json';\n\trequest.timeout = timeout;\n\n\tutils.logger(logGroup, 'timeout configured to', request.timeout);\n\n\treturn new Promise((resolve, reject) => {\n\t\trequest.addEventListener('timeout', () => {\n\t\t\trequest.abort();\n\t\t\treject(new Error('Timeout reached'));\n\t\t\tutils.logger(logGroup, 'timed out');\n\t\t});\n\t\trequest.onload = function () {\n\t\t\tif (this.status === 200) {\n\t\t\t\tutils.logger(logGroup, 'has response');\n\t\t\t\tresolve(this.response);\n\t\t\t} else {\n\t\t\t\tutils.logger(logGroup, 'error occurred');\n\t\t\t\treject(new Error(this.response ? this.response.message : 'Error'));\n\t\t\t}\n\t\t};\n\t\trequest.send();\n\t});\n}\n\n/**\n * Builds key-value pairs for query parameters\n * @param {ModelDefinition[]} models\n * @param {Object} parameters (key-value pairs)\n * @returns {Object}\n */\nfunction getQueryParameters(models, parameters) {\n\tconst now = new Date();\n\tconst day = now.getDay() - 1;\n\n\treturn Object.assign({}, {\n\t\tmodels: models.map(model => model.name),\n\t\th: now.getHours(),\n\t\tdow: day === -1 ? 6 : day\n\t}, parameters);\n}\n\n/**\n * Overrides predictions based on response\n * @param {Object} response\n * @returns {Object}\n */\nfunction overridePredictions(response) {\n\tObject.keys(response).forEach((name) => {\n\t\tconst newValue = utils.queryString.get(`bill.${name}`);\n\n\t\tif (newValue) {\n\t\t\tresponse[name].result = parseInt(newValue, 10);\n\t\t}\n\t});\n\n\treturn response;\n}\n\n/**\n * Bill the Lizard service handler\n */\nclass BillTheLizard {\n\tconstructor() {\n\t\tthis.executor = new Executor();\n\t\tthis.projectsHandler = new ProjectsHandler();\n\t\tthis.predictions = {};\n\t}\n\n\t/**\n\t * Requests service, executes defined methods and parses response\n\t * @param {string[]} projectNames\n\t * @returns {Promise}\n\t */\n\tcall(projectNames) {\n\t\tif (!context.get('services.billTheLizard.enabled')) {\n\t\t\tutils.logger(logGroup, 'disabled');\n\t\t\treturn new Promise((resolve, reject) => reject(new Error('Disabled')));\n\t\t}\n\n\t\tconst host = context.get('services.billTheLizard.host');\n\t\tconst endpoint = context.get('services.billTheLizard.endpoint');\n\t\tconst timeout = context.get('services.billTheLizard.timeout');\n\t\tconst { models, parameters } = this.projectsHandler.getEnabledModelsWithParams(projectNames);\n\n\t\tif (!models || models.length < 1) {\n\t\t\tutils.logger(logGroup, 'no models to predict');\n\t\t\treturn new Promise((resolve, reject) => reject(new Error('Missing models')));\n\t\t}\n\n\t\tconst queryParameters = getQueryParameters(models, parameters);\n\t\tutils.logger(logGroup, 'calling service', host, endpoint, queryParameters);\n\n\t\treturn httpRequest(host, endpoint, queryParameters, timeout)\n\t\t\t.then(response => overridePredictions(response))\n\t\t\t.then((response) => {\n\t\t\t\tconst predictions = this.parsePredictions(models, response);\n\n\t\t\t\tthis.executor.executeMethods(models, response);\n\n\t\t\t\treturn predictions;\n\t\t\t});\n\t}\n\n\t/**\n\t * Parses predictions based on response\n\t * @param {ModelDefinition[]} models\n\t * @param {Object} response\n\t * @returns {Object}\n\t */\n\tparsePredictions(models, response) {\n\t\tconst targeting = [];\n\t\tthis.predictions = {};\n\n\t\tObject.keys(response).forEach((key) => {\n\t\t\tconst model = models.find(definition => definition.name === key);\n\t\t\tconst { result, version } = response[key];\n\t\t\tconst suffix = key.indexOf(version) > 0 ? '' : `:${version}`;\n\n\t\t\tif (typeof result !== 'undefined') {\n\t\t\t\tthis.predictions[`${key}${suffix}`] = result;\n\n\t\t\t\tif (model && model.dfp_targeting) {\n\t\t\t\t\ttargeting.push(`${key}${suffix}_${result}`);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (targeting.length > 0) {\n\t\t\tcontext.set('targeting.btl', targeting);\n\t\t}\n\n\t\tutils.logger(logGroup, 'predictions', this.predictions);\n\n\t\treturn this.predictions;\n\t}\n\n\t/**\n\t * Returns prediction for given model name\n\t * @param {string} modelName\n\t * @returns {number|undefined}\n\t */\n\tgetPrediction(modelName) {\n\t\treturn this.predictions[modelName];\n\t}\n\n\t/**\n\t * Returns all (parsed) predictions\n\t * @returns {Object}\n\t */\n\tgetPredictions() {\n\t\treturn this.predictions;\n\t}\n\n\t/**\n\t * Serializes all predictions\n\t * @returns {string}\n\t */\n\tserialize() {\n\t\treturn Object.keys(this.predictions).map(key => `${key}=${this.predictions[key]}`).join(';');\n\t}\n}\n\nexport const billTheLizard = new BillTheLizard();\n","import { context, utils } from '@wikia/ad-engine';\n\nconst logGroup = 'krux';\n\n/**\n * Injects Krux script\n * @returns {Promise}\n */\nfunction loadScript() {\n\tconst firstScript = document.getElementsByTagName('script')[0];\n\tconst kruxId = context.get('services.krux.id');\n\tconst kruxScript = document.createElement('script');\n\n\treturn new Promise((resolve) => {\n\t\tkruxScript.type = 'text/javascript';\n\t\tkruxScript.id = 'krux-control-tag';\n\t\tkruxScript.async = true;\n\t\tkruxScript.onload = resolve;\n\t\tkruxScript.src = `//cdn.krxd.net/controltag?confid=${kruxId}`;\n\t\tfirstScript.parentNode.insertBefore(kruxScript, firstScript);\n\t});\n}\n\n/**\n * Gets Krux data from localStorage\n * @param {string} key\n * @returns {string}\n */\nfunction getKruxData(key) {\n\tif (window.localStorage) {\n\t\treturn window.localStorage[key];\n\t} else if (window.navigator.cookieEnabled) {\n\t\tconst match = document.cookie.match(`${key}=([^;]*)`);\n\n\t\treturn (match && decodeURI(match[1])) || '';\n\t}\n\n\treturn '';\n}\n\nwindow.Krux = window.Krux || function (...args) {\n\twindow.Krux.q.push(args);\n};\nwindow.Krux.q = window.Krux.q || [];\n\n/**\n * Krux service handler\n */\nclass Krux {\n\t/**\n\t * Requests service, saves user id and segments in context and exports page level params\n\t * @returns {Promise}\n\t */\n\tcall() {\n\t\tif (!context.get('services.krux.enabled') || !context.get('options.trackingOptIn')) {\n\t\t\tutils.logger(logGroup, 'disabled');\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tutils.logger(logGroup, 'loading');\n\t\treturn loadScript().then(() => {\n\t\t\tthis.exportPageParams();\n\t\t\tthis.importUserData();\n\t\t});\n\t}\n\n\t/**\n\t * Export page level params to Krux\n\t * @returns {void}\n\t */\n\texportPageParams() {\n\t\tObject.keys(context.get('targeting')).forEach((key) => {\n\t\t\tconst value = context.get(`targeting.${key}`);\n\n\t\t\tif (value) {\n\t\t\t\twindow[`kruxDartParam_${key}`] = value;\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Imports Krux data from localStorage\n\t * @returns {void}\n\t */\n\timportUserData() {\n\t\tconst user = getKruxData('kxuser');\n\t\tconst segments = getKruxData('kxsegs');\n\n\t\tcontext.set('targeting.kuid', user || null);\n\t\tcontext.set('targeting.ksg', segments ? segments.split(',') : []);\n\t\tutils.logger(logGroup, 'data set', user, segments);\n\t}\n\n\t/**\n\t * Returns Krux user ID\n\t * @returns {string}\n\t */\n\tgetUserId() {\n\t\treturn context.get('targeting.kuid') || null;\n\t}\n\n\t/**\n\t * Returns Krux segments\n\t * @returns {string[]}\n\t */\n\tgetSegments() {\n\t\treturn context.get('targeting.ksg') || [];\n\t}\n}\n\nexport const krux = new Krux();\n","export * from './bill-the-lizard';\nexport * from './krux';\n"],"sourceRoot":""}