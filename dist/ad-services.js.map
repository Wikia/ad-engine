{"version":3,"sources":["webpack://adEngine/webpack/bootstrap","webpack://adEngine/external \"@wikia/ad-engine\"","webpack://adEngine/external \"babel-runtime/helpers/createClass\"","webpack://adEngine/external \"babel-runtime/helpers/classCallCheck\"","webpack://adEngine/external \"babel-runtime/core-js/promise\"","webpack://adEngine/external \"babel-runtime/core-js/object/keys\"","webpack://adEngine/external \"babel-runtime/core-js/object/assign\"","webpack://adEngine/external \"babel-runtime/core-js/set\"","webpack://adEngine/external \"babel-runtime/helpers/toConsumableArray\"","webpack://adEngine/external \"babel-runtime/core-js/object/entries\"","webpack://adEngine/external \"babel-runtime/helpers/slicedToArray\"","webpack://adEngine/./src/ad-services/bill-the-lizard/executor.js","webpack://adEngine/./src/ad-services/bill-the-lizard/projects-handler.js","webpack://adEngine/./src/ad-services/bill-the-lizard/index.js","webpack://adEngine/./src/ad-services/geo-edge/index.js","webpack://adEngine/./src/ad-services/krux/index.js","webpack://adEngine/./src/ad-services/moat-yi/index.js","webpack://adEngine/./src/ad-services/index.js"],"names":["logGroup","Executor","methods","name","callback","utils","logger","methodName","model","prediction","Error","models","response","forEach","modelName","result","executableModel","find","executable","definedMethods","execute","ProjectsHandler","projects","projectNames","context","get","projectParameters","enabledProjectNames","filter","isEnabled","includes","parameters","isNextModelExecutable","isProperGeo","countries","push","events","registerEvent","buildQueryUrl","queryParameters","params","key","encodeURI","join","buildUrl","host","endpoint","query","httpRequest","timeout","callId","request","window","XMLHttpRequest","url","emit","BILL_THE_LIZARD_REQUEST","open","responseType","resolve","reject","addEventListener","onreadystatechange","readyState","status","send","getQueryParameters","now","Date","day","getDay","map","h","getHours","dow","overridePredictions","newValue","queryString","parseInt","BillTheLizard","executor","projectsHandler","statuses","predictions","callCounter","targetedModelNames","getEnabledModelsWithParams","length","NOT_USED","dfp_targeting","add","TOO_LATE","catch","error","message","TIMEOUT","FAILURE","then","ON_TIME","modelToResultMap","getModelToResultMap","buildPredictions","setTargeting","BILL_THE_LIZARD_RESPONSE","serialize","executeMethods","undefined","targeting","getTargeting","serializedTargeting","set","latestResults","pred","has","getPredictions","separator","split","billTheLizard","scriptDomainId","loadScript","geoEdgeLibraryUrl","scriptLoader","GeoEdge","geoEdgeKey","geoEdgeConfig","grumi","cfg","geoEdge","kruxId","kruxLibraryUrl","id","getKruxData","localStorage","navigator","cookieEnabled","match","document","cookie","decodeURI","Krux","args","q","exportPageParams","importUserData","value","user","segments","krux","partnerCode","MoatYi","moatYeildReadyResolve","promise","moatYieldReady","importPageParams","moatPrebidApi","getMoatTargetingForPage","pageParams","m_data","MOAT_YI_READY","moatYi"],"mappings":"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","file":"ad-services.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 10);\n","module.exports = require(\"@wikia/ad-engine\");","module.exports = require(\"babel-runtime/helpers/createClass\");","module.exports = require(\"babel-runtime/helpers/classCallCheck\");","module.exports = require(\"babel-runtime/core-js/promise\");","module.exports = require(\"babel-runtime/core-js/object/keys\");","module.exports = require(\"babel-runtime/core-js/object/assign\");","module.exports = require(\"babel-runtime/core-js/set\");","module.exports = require(\"babel-runtime/helpers/toConsumableArray\");","module.exports = require(\"babel-runtime/core-js/object/entries\");","module.exports = require(\"babel-runtime/helpers/slicedToArray\");","import { utils } from '@wikia/ad-engine';\n\nconst logGroup = 'executor';\n\n/**\n * Bill the Lizard methods executor\n */\nexport class Executor {\n\tconstructor() {\n\t\tthis.methods = {};\n\t}\n\n\t/**\n\t * Registeres new method\n\t * @param {string} name\n\t * @param {function} callback\n\t */\n\tregister(name, callback) {\n\t\tutils.logger(logGroup, `method ${name} registered`);\n\t\tthis.methods[name] = callback;\n\t}\n\n\t/**\n\t * Executes method by name\n\t * @param {string} methodName\n\t * @param {ModelDefinition} model\n\t * @param {number|undefined} prediction\n\t */\n\texecute(methodName, model, prediction) {\n\t\tconst callback = this.methods[methodName];\n\n\t\tif (typeof callback !== 'function') {\n\t\t\tthrow Error(`${methodName} is not executable`);\n\t\t}\n\n\t\tutils.logger(logGroup, `executing ${methodName} method`, model.name, prediction);\n\t\tcallback(model, prediction);\n\t}\n\n\t/**\n\t * Executes all methods defined in given model based on service response\n\t * @param {ModelDefinition[]} models\n\t * @param {Object} response\n\t */\n\texecuteMethods(models, response) {\n\t\tObject.keys(response).forEach((modelName) => {\n\t\t\tconst { result } = response[modelName];\n\n\t\t\tconst executableModel = models.find((model) => model.name === modelName && model.executable);\n\n\t\t\tif (!executableModel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst definedMethods = executableModel[`on_${result}`];\n\n\t\t\tif (!definedMethods) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdefinedMethods.forEach((methodName) => this.execute(methodName, executableModel, result));\n\t\t});\n\t}\n}\n","import { context, utils } from '@wikia/ad-engine';\n\nconst logGroup = 'project-handler';\n\n/**\n * Bill the Lizard projects handler\n */\nexport class ProjectsHandler {\n\tconstructor() {\n\t\tthis.projects = {};\n\t}\n\n\t/**\n\t * Enables project by name\n\t * @param {string} name\n\t */\n\tenable(name) {\n\t\tutils.logger(logGroup, `project ${name} enabled`);\n\t\tthis.projects[name] = true;\n\t}\n\n\t/**\n\t * Checks whether project is enabled\n\t * @param {string} name\n\t * @returns {boolean}\n\t */\n\tisEnabled(name) {\n\t\treturn !!this.projects[name];\n\t}\n\n\t/**\n\t * Returns all geo-enabled models' definitions based on enabled projects\n\t * @param {string[]} projectNames\n\t * @returns {{models: ModelDefinition[], parameters: Object}}\n\t */\n\tgetEnabledModelsWithParams(projectNames) {\n\t\tconst projects = context.get('services.billTheLizard.projects');\n\t\tconst projectParameters = context.get('services.billTheLizard.parameters');\n\t\tconst enabledProjectNames = Object.keys(projects).filter(\n\t\t\t(name) => this.isEnabled(name) && projectNames.includes(name),\n\t\t);\n\t\tconst models = [];\n\t\tconst parameters = {};\n\n\t\tenabledProjectNames.forEach((name) => {\n\t\t\t// Only first enabled model in project is executable\n\t\t\tlet isNextModelExecutable = true;\n\n\t\t\tprojects[name].forEach((model) => {\n\t\t\t\tif (utils.isProperGeo(model.countries, model.name)) {\n\t\t\t\t\tmodel.executable = isNextModelExecutable;\n\t\t\t\t\tisNextModelExecutable = false;\n\t\t\t\t\tmodels.push(model);\n\t\t\t\t\tObject.assign(parameters, projectParameters[name]);\n\t\t\t\t} else {\n\t\t\t\t\tmodel.executable = false;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn {\n\t\t\tmodels,\n\t\t\tparameters,\n\t\t};\n\t}\n}\n","import { context, events, utils } from '@wikia/ad-engine';\nimport { Executor } from './executor';\nimport { ProjectsHandler } from './projects-handler';\n\n/**\n * @typedef {Object} ModelDefinition\n * @property {boolean|undefined} executable\n * @property {string[]} countries\n * @property {string} name\n * @property {function} on_*\n */\n\n/**\n * @typedef {Object} PredictionDefinition\n * @property {string} modelName\n * @property {result} number\n * @property {(number|string)} callId\n */\n\nconst logGroup = 'bill-the-lizard';\n\nevents.registerEvent('BILL_THE_LIZARD_REQUEST');\nevents.registerEvent('BILL_THE_LIZARD_RESPONSE');\n\n/**\n * Builds query parameters for url\n * @param {Object} queryParameters (key-value pairs for query parameters)\n * @returns {string}\n */\nfunction buildQueryUrl(queryParameters) {\n\tconst params = [];\n\n\tObject.keys(queryParameters).forEach((key) => {\n\t\tparams.push(`${key}=${queryParameters[key]}`);\n\t});\n\n\treturn encodeURI(params.join('&'));\n}\n\n/**\n * Builds endpoint url\n * @param {string} host\n * @param {string} endpoint\n * @param {string} query\n * @returns {string}\n */\nfunction buildUrl(host, endpoint, query) {\n\treturn `${host}/${endpoint}?${query}`;\n}\n\n/**\n * Requests service\n * @param {string} host\n * @param {string} endpoint\n * @param {Object} queryParameters (key-value pairs for query parameters)\n * @param {number} timeout\n * @param {number|string} callId\n * @returns {Promise}\n */\nfunction httpRequest(host, endpoint, queryParameters = {}, timeout = 0, callId) {\n\tconst request = new window.XMLHttpRequest();\n\tconst query = buildQueryUrl(queryParameters);\n\tconst url = buildUrl(host, endpoint, query);\n\n\tevents.emit(events.BILL_THE_LIZARD_REQUEST, {\n\t\tquery,\n\t\tcallId,\n\t});\n\n\trequest.open('GET', url, true);\n\trequest.responseType = 'json';\n\trequest.timeout = timeout;\n\n\tutils.logger(logGroup, 'timeout configured to', request.timeout);\n\n\treturn new Promise((resolve, reject) => {\n\t\trequest.addEventListener('timeout', () => {\n\t\t\treject(new Error('timeout'));\n\t\t\tutils.logger(logGroup, 'timed out');\n\t\t});\n\t\trequest.addEventListener('error', () => {\n\t\t\treject(new Error('error'));\n\t\t\tutils.logger(logGroup, 'errored');\n\t\t});\n\t\trequest.onreadystatechange = function () {\n\t\t\tif (this.readyState === 4 && this.status === 200) {\n\t\t\t\tutils.logger(logGroup, 'has response');\n\t\t\t\tresolve(this.response);\n\t\t\t}\n\t\t};\n\t\trequest.send();\n\t});\n}\n\n/**\n * Builds key-value pairs for query parameters\n * @param {ModelDefinition[]} models\n * @param {Object} parameters (key-value pairs)\n * @returns {Object}\n */\nfunction getQueryParameters(models, parameters) {\n\tconst now = new Date();\n\tconst day = now.getDay() - 1;\n\n\treturn Object.assign(\n\t\t{},\n\t\t{\n\t\t\tmodels: models.map((model) => model.name),\n\t\t\th: now.getHours(),\n\t\t\tdow: day === -1 ? 6 : day,\n\t\t},\n\t\tparameters,\n\t);\n}\n\n/**\n * Overrides predictions based on response\n * @param {Object} response\n * @returns {Object}\n */\nfunction overridePredictions(response) {\n\tObject.keys(response).forEach((name) => {\n\t\tconst newValue = utils.queryString.get(`bill.${name}`);\n\n\t\tif (newValue) {\n\t\t\tresponse[name].result = parseInt(newValue, 10);\n\t\t}\n\t});\n\n\treturn response;\n}\n\n/**\n * Bill the Lizard service handler\n */\nexport class BillTheLizard {\n\tstatic FAILURE = 'failure';\n\tstatic NOT_USED = 'not_used';\n\tstatic ON_TIME = 'on_time';\n\tstatic TIMEOUT = 'timeout';\n\tstatic TOO_LATE = 'too_late';\n\n\tconstructor() {\n\t\tthis.executor = new Executor();\n\t\tthis.projectsHandler = new ProjectsHandler();\n\t\tthis.statuses = {};\n\t\tthis.predictions = [];\n\t\tthis.callCounter = 0;\n\t\tthis.targetedModelNames = new Set();\n\t}\n\n\t/**\n\t * Requests service, executes defined methods and parses response\n\t *\n\t * Supply callKey if you need to access status for this specific request.\n\t * DO NOT use an integer as callKey as it's the default value.\n\t * Good key example: \"incontent_boxad1\".\n\t *\n\t * @param {string[]} projectNames\n\t * @param {string} callId key for this call\n\t * @returns {Promise}\n\t */\n\tcall(projectNames, callId) {\n\t\tif (!context.get('services.billTheLizard.enabled')) {\n\t\t\tutils.logger(logGroup, 'disabled');\n\n\t\t\treturn new Promise((resolve, reject) => reject(new Error('Disabled')));\n\t\t}\n\n\t\tif (!callId) {\n\t\t\tthis.callCounter += 1;\n\t\t\tcallId = this.callCounter;\n\t\t}\n\n\t\tconst host = context.get('services.billTheLizard.host');\n\t\tconst endpoint = context.get('services.billTheLizard.endpoint');\n\t\tconst timeout = context.get('services.billTheLizard.timeout');\n\t\tconst { models, parameters } = this.projectsHandler.getEnabledModelsWithParams(projectNames);\n\n\t\tif (!models || models.length < 1) {\n\t\t\tutils.logger(logGroup, 'no models to predict');\n\t\t\tthis.statuses[callId] = BillTheLizard.NOT_USED;\n\n\t\t\treturn Promise.resolve({});\n\t\t}\n\n\t\t// update names of GAM targeted models\n\t\tmodels\n\t\t\t.filter((model) => model.dfp_targeting)\n\t\t\t.forEach((model) => this.targetedModelNames.add(model.name));\n\n\t\tconst queryParameters = getQueryParameters(models, parameters);\n\n\t\tutils.logger(logGroup, 'calling service', host, endpoint, queryParameters, `callId: ${callId}`);\n\n\t\tthis.statuses[callId] = BillTheLizard.TOO_LATE;\n\n\t\treturn httpRequest(host, endpoint, queryParameters, timeout, callId)\n\t\t\t.catch((error) => {\n\t\t\t\tif (error.message === 'timeout') {\n\t\t\t\t\tthis.statuses[callId] = BillTheLizard.TIMEOUT;\n\t\t\t\t} else {\n\t\t\t\t\tthis.statuses[callId] = BillTheLizard.FAILURE;\n\t\t\t\t}\n\n\t\t\t\treturn Promise.reject(error);\n\t\t\t})\n\t\t\t.then((response) => overridePredictions(response))\n\t\t\t.then((response) => {\n\t\t\t\tutils.logger(logGroup, 'service response OK', `callId: ${callId}`);\n\n\t\t\t\tthis.statuses[callId] = BillTheLizard.ON_TIME;\n\n\t\t\t\tconst modelToResultMap = this.getModelToResultMap(response);\n\n\t\t\t\tutils.logger(logGroup, 'predictions', modelToResultMap, `callId: ${callId}`);\n\n\t\t\t\tconst predictions = this.buildPredictions(models, modelToResultMap, callId);\n\n\t\t\t\tthis.predictions.push(...predictions);\n\n\t\t\t\tthis.setTargeting();\n\n\t\t\t\tevents.emit(events.BILL_THE_LIZARD_RESPONSE, {\n\t\t\t\t\tcallId,\n\t\t\t\t\tresponse: this.serialize(callId),\n\t\t\t\t});\n\n\t\t\t\tthis.executor.executeMethods(models, response);\n\n\t\t\t\treturn modelToResultMap;\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tutils.logger(logGroup, 'service response', error.message, `callId: ${callId}`);\n\n\t\t\t\treturn {};\n\t\t\t});\n\t}\n\n\t/**\n\t *\n\t * @param {ModelDefinition[]} models\n\t * @param {Object.<string, number>} modelToResultMap\n\t * @param {number|string} callId\n\t * @returns {PredictionDefinition[]}\n\t */\n\tbuildPredictions(models, modelToResultMap, callId) {\n\t\treturn models\n\t\t\t.map((model) => model.name)\n\t\t\t.filter((modelName) => modelToResultMap[modelName] !== undefined)\n\t\t\t.map((modelName) => ({ modelName, callId, result: modelToResultMap[modelName] }));\n\t}\n\n\t/**\n\t * Converts response to predictions\n\t * @param {Object} response\n\t * @returns {PredictionDefinition}\n\t */\n\tgetModelToResultMap(response) {\n\t\tconst modelToResultMap = {};\n\n\t\tObject.keys(response).forEach((modelName) => {\n\t\t\tconst { result } = response[modelName];\n\n\t\t\tif (typeof result !== 'undefined') {\n\t\t\t\tmodelToResultMap[modelName] = result;\n\t\t\t}\n\t\t});\n\n\t\treturn modelToResultMap;\n\t}\n\n\t/**\n\t * Sets DFP targeting in context.\n\t *\n\t * @returns string\n\t */\n\tsetTargeting() {\n\t\tconst targeting = this.getTargeting();\n\n\t\tif (Object.keys(targeting).length > 0) {\n\t\t\tconst serializedTargeting = Object.entries(targeting).map(\n\t\t\t\t([modelName, result]) => `${modelName}_${result}`,\n\t\t\t);\n\n\t\t\tcontext.set('targeting.btl', serializedTargeting);\n\n\t\t\treturn serializedTargeting;\n\t\t}\n\n\t\treturn '';\n\t}\n\n\t/**\n\t * Returns map of targeted models to their results.\n\t *\n\t * For each model, it takes the latest result.\n\t *\n\t * @returns {Object.<string, number>}\n\t */\n\tgetTargeting() {\n\t\tconst latestResults = {};\n\n\t\tthis.predictions\n\t\t\t.filter((pred) => this.targetedModelNames.has(pred.modelName))\n\t\t\t.forEach((pred) => {\n\t\t\t\tlatestResults[pred.modelName] = pred.result;\n\t\t\t});\n\n\t\treturn latestResults;\n\t}\n\n\t/**\n\t * Get prediction by modelName and callId.\n\t *\n\t * @param {string} modelName\n\t * @param {(number|string)} callId\n\t * @returns {PredictionDefinition}\n\t */\n\tgetPrediction(modelName, callId) {\n\t\treturn this.getPredictions(modelName).find((pred) => pred.callId === callId);\n\t}\n\n\t/**\n\t * Returns predictions optionally filtered by model name.\n\t *\n\t * If model name is given, it returns all predictions with models matching.\n\t * Model matches when raw name (without version) is matched.\n\t *\n\t * @param {string} [modelName]\n\t * @returns {PredictionDefinition[]}\n\t */\n\tgetPredictions(modelName) {\n\t\tconst separator = ':';\n\n\t\tif (modelName) {\n\t\t\treturn this.predictions.filter(\n\t\t\t\t(pred) => pred.modelName.split(separator)[0] === modelName.split(separator)[0],\n\t\t\t);\n\t\t}\n\n\t\treturn this.predictions;\n\t}\n\n\t/**\n\t * Returns response status (one of: failure, not_used, on_time, timeout, too_late or undefined);\n\t *\n\t * If callId is not supplied, the latest response without a specific key is returned.\n\t *\n\t * @param {number|string} [callId] value passed as key for call\n\t * @returns {string}\n\t */\n\tgetResponseStatus(callId) {\n\t\tcallId = callId || this.callCounter;\n\n\t\treturn this.statuses[callId];\n\t}\n\n\t/**\n\t * Serializes all predictions\n\t * @param {number|string} [callId]\n\t * @returns {string}\n\t */\n\tserialize(callId) {\n\t\tlet { predictions } = this;\n\n\t\tif (callId !== undefined) {\n\t\t\tpredictions = predictions.filter((pred) => pred.callId === callId);\n\t\t}\n\n\t\treturn predictions.map((pred) => `${pred.modelName}|${pred.callId}=${pred.result}`).join(';');\n\t}\n}\n\nexport const billTheLizard = new BillTheLizard();\n","import { context, utils } from '@wikia/ad-engine';\n\nconst logGroup = 'geo-edge';\nconst scriptDomainId = 'd3b02estmut877';\n\n/**\n * Injects Geo Edge Site Side Protection script\n * @returns {Promise}\n */\nfunction loadScript() {\n\tconst geoEdgeLibraryUrl = `//${scriptDomainId}.cloudfront.net/grumi-ip.js`;\n\n\treturn utils.scriptLoader.loadScript(geoEdgeLibraryUrl, 'text/javascript', true, 'first');\n}\n\n/**\n * GeoEdge service handler\n */\nclass GeoEdge {\n\t/**\n\t * Requests service and injects script tag\n\t * @returns {Promise}\n\t */\n\tcall() {\n\t\tconst geoEdgeKey = context.get('services.geoEdge.id');\n\t\tconst geoEdgeConfig = context.get('services.geoEdge.config');\n\n\t\tif (!context.get('services.geoEdge.enabled') || !geoEdgeKey) {\n\t\t\tutils.logger(logGroup, 'disabled');\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tutils.logger(logGroup, 'loading');\n\t\twindow.grumi = {\n\t\t\tcfg: geoEdgeConfig,\n\t\t\tkey: geoEdgeKey,\n\t\t};\n\n\t\treturn loadScript().then(() => {\n\t\t\tutils.logger(logGroup, 'ready');\n\t\t});\n\t}\n}\n\nexport const geoEdge = new GeoEdge();\n","import { context, utils } from '@wikia/ad-engine';\n\nconst logGroup = 'krux';\n\n/**\n * Injects Krux script\n * @returns {Promise}\n */\nfunction loadScript() {\n\tconst kruxId = context.get('services.krux.id');\n\tconst kruxLibraryUrl = `//cdn.krxd.net/controltag?confid=${kruxId}`;\n\n\treturn utils.scriptLoader.loadScript(kruxLibraryUrl, 'text/javascript', true, 'first', {\n\t\tid: 'krux-control-tag',\n\t});\n}\n\n/**\n * Gets Krux data from localStorage\n * @param {string} key\n * @returns {string}\n */\nfunction getKruxData(key) {\n\tif (window.localStorage) {\n\t\treturn window.localStorage[key];\n\t}\n\tif (window.navigator.cookieEnabled) {\n\t\tconst match = document.cookie.match(`${key}=([^;]*)`);\n\n\t\treturn (match && decodeURI(match[1])) || '';\n\t}\n\n\treturn '';\n}\n\nwindow.Krux =\n\twindow.Krux ||\n\tfunction (...args) {\n\t\twindow.Krux.q.push(args);\n\t};\nwindow.Krux.q = window.Krux.q || [];\n\n/**\n * Krux service handler\n */\nclass Krux {\n\t/**\n\t * Requests service, saves user id and segments in context and exports page level params\n\t * @returns {Promise}\n\t */\n\tcall() {\n\t\tif (!context.get('services.krux.enabled') || !context.get('options.trackingOptIn')) {\n\t\t\tutils.logger(logGroup, 'disabled');\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tutils.logger(logGroup, 'loading');\n\n\t\treturn loadScript().then(() => {\n\t\t\tthis.exportPageParams();\n\t\t\tthis.importUserData();\n\t\t});\n\t}\n\n\t/**\n\t * Export page level params to Krux\n\t * @returns {void}\n\t */\n\texportPageParams() {\n\t\tObject.keys(context.get('targeting')).forEach((key) => {\n\t\t\tconst value = context.get(`targeting.${key}`);\n\n\t\t\tif (value) {\n\t\t\t\twindow[`kruxDartParam_${key}`] = value;\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Imports Krux data from localStorage\n\t * @returns {void}\n\t */\n\timportUserData() {\n\t\tconst user = getKruxData('kxuser');\n\t\tconst segments = getKruxData('kxsegs');\n\n\t\tcontext.set('targeting.kuid', user || null);\n\t\tcontext.set('targeting.ksg', segments ? segments.split(',') : []);\n\t\tutils.logger(logGroup, 'data set', user, segments);\n\t}\n\n\t/**\n\t * Returns Krux user ID\n\t * @returns {string}\n\t */\n\tgetUserId() {\n\t\treturn context.get('targeting.kuid') || null;\n\t}\n\n\t/**\n\t * Returns Krux segments\n\t * @returns {string[]}\n\t */\n\tgetSegments() {\n\t\treturn context.get('targeting.ksg') || [];\n\t}\n}\n\nexport const krux = new Krux();\n","import { context, events, utils } from '@wikia/ad-engine';\n\nconst logGroup = 'moat-yi';\n\nevents.registerEvent('MOAT_YI_READY');\n\n/**\n * Injects MOAT YI script\n * @returns {Promise}\n */\nfunction loadScript() {\n\tconst partnerCode = context.get('services.moatYi.partnerCode');\n\tconst url = `//z.moatads.com/${partnerCode}/yi.js`;\n\n\treturn utils.scriptLoader.loadScript(url, 'text/javascript', true, 'first');\n}\n\n/**\n * MOAT YI service handler\n */\nclass MoatYi {\n\t/**\n\t * Requests MOAT YI service and saves page level data in targeting\n\t * @returns {Promise}\n\t */\n\tcall() {\n\t\tif (!context.get('services.moatYi.enabled') || !context.get('services.moatYi.partnerCode')) {\n\t\t\tutils.logger(logGroup, 'disabled');\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tlet moatYeildReadyResolve;\n\t\tconst promise = new Promise((resolve) => {\n\t\t\tmoatYeildReadyResolve = resolve;\n\t\t});\n\n\t\tutils.logger(logGroup, 'loading');\n\t\twindow.moatYieldReady = () => {\n\t\t\tthis.importPageParams();\n\t\t\tmoatYeildReadyResolve();\n\t\t};\n\t\tcontext.set('targeting.m_data', 'waiting');\n\n\t\tloadScript().then(() => {\n\t\t\tutils.logger(logGroup, 'ready');\n\t\t});\n\n\t\treturn promise;\n\t}\n\n\t/**\n\t * Adds page params to targeting\n\t * @returns {void}\n\t */\n\timportPageParams() {\n\t\tif (\n\t\t\twindow.moatPrebidApi &&\n\t\t\ttypeof window.moatPrebidApi.getMoatTargetingForPage === 'function'\n\t\t) {\n\t\t\tconst pageParams = window.moatPrebidApi.getMoatTargetingForPage() || {};\n\n\t\t\tcontext.set('targeting.m_data', pageParams.m_data);\n\t\t\tevents.emit(events.MOAT_YI_READY, `m_data=${pageParams.m_data}`);\n\t\t\tutils.logger(logGroup, 'moatYieldReady', pageParams);\n\t\t}\n\t}\n}\n\nexport const moatYi = new MoatYi();\n","export * from './bill-the-lizard';\nexport * from './geo-edge';\nexport * from './krux';\nexport * from './moat-yi';\n"],"sourceRoot":""}