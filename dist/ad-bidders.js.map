{"version":3,"sources":["webpack://adEngine/webpack/bootstrap","webpack://adEngine/external \"@wikia/ad-engine\"","webpack://adEngine/external \"babel-runtime/helpers/createClass\"","webpack://adEngine/external \"babel-runtime/helpers/classCallCheck\"","webpack://adEngine/external \"babel-runtime/helpers/inherits\"","webpack://adEngine/external \"babel-runtime/helpers/possibleConstructorReturn\"","webpack://adEngine/external \"babel-runtime/core-js/object/get-prototype-of\"","webpack://adEngine/external \"babel-runtime/regenerator\"","webpack://adEngine/external \"babel-runtime/core-js/object/keys\"","webpack://adEngine/external \"babel-runtime/helpers/asyncToGenerator\"","webpack://adEngine/external \"babel-runtime/helpers/slicedToArray\"","webpack://adEngine/external \"babel-runtime/helpers/extends\"","webpack://adEngine/external \"babel-runtime/core-js/object/assign\"","webpack://adEngine/external \"core-decorators\"","webpack://adEngine/external \"babel-runtime/core-js/object/get-own-property-descriptor\"","webpack://adEngine/external \"babel-runtime/core-js/promise\"","webpack://adEngine/./src/ad-bidders/wrappers/apstag.js","webpack://adEngine/./src/ad-bidders/wrappers/cmp.js","webpack://adEngine/./src/ad-bidders/wrappers/index.js","webpack://adEngine/./src/ad-bidders/base-bidder.js","webpack://adEngine/./src/ad-bidders/a9/index.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/base-adapter.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/aol.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/appnexus.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/appnexus-ast.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/audience-network.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/beachfront.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/index-exchange.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/kargo.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/lkqd.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/onemobile.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/openx.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/pubmatic.js","webpack://adEngine/./src/ad-bidders/prebid/prebid-helper.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/rubicon.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/rubicon-display.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/wikia.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/wikia-video.js","webpack://adEngine/./src/ad-bidders/prebid/adapters-registry.js","webpack://adEngine/./src/ad-bidders/prebid/price-helper.js","webpack://adEngine/./src/ad-bidders/prebid/prebid-settings.js","webpack://adEngine/./src/ad-bidders/prebid/index.js","webpack://adEngine/./src/ad-bidders/index.js"],"names":["Apstag","instance","renderImpEndCallbacks","utils","insertScript","configure","addRenderImpHooks","script","scriptLoader","loadScript","original","window","apstag","renderImp","doc","impId","forEach","cb","_Q","init","args","configureCommand","fetchBids","command","push","apsConfig","bidsConfig","getPromiseAndExecuteCallback","resolve","currentBids","targetingKeys","debug","callback","Error","Cmp","param","__cmp","consentData","newCmp","cmp","BaseBidder","name","bidderConfig","timeout","logGroup","context","resetState","logger","called","response","onResponseCallbacks","LazyQueue","onItemFlush","callBids","onBidResponse","calculatePrices","flush","slotName","get","getBestPrice","isSlotSupported","getTargetingParams","isSupported","createWithTimeout","hasResponse","addResponseListener","NotImplementedException","A9","loaded","isCMPEnabled","amazonId","slots","slotsNames","bids","priceMap","slotNamesMap","make","events","slotService","bidsRefreshing","isRenderImpOverwritten","initIfNotLoaded","a9Slots","getA9SlotsDefinitions","getApstagConfig","pubID","videoAdServer","deals","dealsEnabled","getGdprIfApplicable","gdpr","enabled","gdprApplies","consent","cmpTimeout","map","getSlotAlias","slotAlias","createSlotDefinition","filter","slot","refresh","addApstagRenderImpHookOnFirstFetch","bid","slotID","getBidTargetingWithKeys","keys","bidTargeting","updateBidSlot","emit","BIDS_REFRESH","addApstagRenderImpHook","onRenderImpEnd","getRenderedSlot","getSlotName","refreshBid","renderedSlot","getTargeting","amzniid","shouldRefreshSlot","slotDef","includes","config","slotId","definition","videoEnabled","type","mediaType","sizes","helpers","targeting","key","indexOf","exists","getConsentData","amznbid","a9","BaseAdapter","prepareConfigForAdUnit","Aol","options","bidderName","network","code","placement","alias","sizeId","mediaTypes","banner","bidder","params","Appnexus","placements","position","placementId","getPlacement","vertical","AppnexusAst","aliases","appnexus","debugPlacementId","isDebugMode","queryString","video","playerSize","skippable","playback_method","AudienceNetwork","testMode","Beachfront","bidfloor","debugAppId","appId","IndexExchange","ix","siteId","size","Kargo","Lkqd","pageurl","location","hostname","output","Onemobile","pos","dcn","Openx","delDomain","unit","Pubmatic","publisherId","ids","toLowerCase","getVideoConfig","getStandardConfig","videoParams","mimes","minduration","maxduration","startdelay","playbackmethod","protocols","linearity","getBids","adSlot","lazyLoadSlots","isSlotApplicable","lazyLoad","isSlotLazy","getState","setupAdUnits","adaptersConfig","adUnits","adapters","getAdapters","adapter","adapterAdUnits","prepareAdUnits","adUnit","getBidByAdId","adId","pbjs","getBidResponses","getAllPrebidWinningBids","length","responses","adUnitsBids","concat","getAvailableBidsByAdUnitCode","adUnitCode","getBidResponsesForAdUnitCode","status","getPrebid","getWinningVideoBidBySlotName","allowedBidders","canUseThisBidder","bidderCode","hasVast","vastUrl","vastContent","cpm","reduce","previousBid","currentBid","pushPrebid","que","Rubicon","accountId","zoneId","inventory","playerWidth","playerHeight","size_id","language","lang","RubiconDisplay","rubicon","pageTargeting","keywords","price","limit","parseInt","useRandomPrice","Wikia","create","supportedMediaTypes","Math","floor","random","bidRequest","addBidResponse","done","addBids","setTimeout","bidResponse","createBid","width","height","getPrice","ad","getCreative","ttl","creative","document","createElement","style","background","color","fontFamily","textAlign","title","innerText","fontWeight","margin","paddingTop","details","join","appendChild","outerHTML","WikiaVideo","buildVastUrl","videoAdUnitId","customParams","creativeId","getVastUrl","videoCacheKey","customAdapters","availableAdapters","aol","appnexusAst","audienceNetwork","beachfront","indexExchange","kargo","lkqd","onemobile","openx","pubmatic","rubiconDisplay","registerAliases","aliasMap","aliasBidder","setupAdapters","bidders","setupCustomAdapters","wikia","wikiaVideo","registerBidAdapter","getPriorities","priorities","priority","DEFAULT_MAX_CPM","videoBiddersCap50","isValidPrice","getStatusCode","Prebid","validResponseStatusCode","roundCpm","maxCpm","result","transformPriceFromCpm","max","toFixed","getPrebidBestPrice","bestPrices","slotBids","cmpPrice","transformPriceFromBid","dfpVideoBidders","contextKey","getSettings","standard","alwaysUseBid","adserverTargeting","val","getBidderUuid","isVideo","some","postponeExecutionUntilPbjsLoads","method","apply","on","VIDEO_AD_IMPRESSION","markWinningBidAsUsed","VIDEO_AD_ERROR","VIDEO_AD_USED","registerEvent","decorate","lazyLoaded","isLazyLoadingEnabled","lazyLoadingEnabled","prebidConfig","enableSendAllBids","bidderSequence","bidderTimeout","cache","url","userSync","iframeEnabled","enabledBidders","syncDelay","consentManagement","cmpApi","allowAuctionWithoutConsent","applyConfig","registerBidsRefreshing","setConfig","bidderSettings","bidsBackHandler","applySettings","requestBids","removeAdUnits","PREBID_LAZY_CALL","lazyCall","libraryUrl","adUnitsLazy","removeAdUnit","slotParams","bidParams","timeToRespond","hb_uuid","refreshUsedBid","winningBid","adUnitsToRefresh","onEvent","once","PAGE_CHANGE_EVENT","offEvent","withRemove","undefined","errorResponseStatusCode","biddersRegistry","realSlotPrices","VIDEO_AD_REQUESTED","updateWinningPbBidderDetails","updateSlotTargeting","applyTargetingParams","set","forEachBidder","getBidParameters","wasCalled","getSlotTargetingParams","getCurrentSlotPrices","slotPrices","priceFromBidder","getSlotBestPrice","getDfpSlotPrices","hasAllResponses","missingBidders","resetTargetingKeys","getTargetingKeysToReset","remove","responseListener","prebid","call","runOnBiddingReady","waitForResponse","all","then","storeRealSlotPrices","bidderTargeting","prebidHelper"],"mappings":"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","file":"ad-bidders.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 15);\n","module.exports = require(\"@wikia/ad-engine\");","module.exports = require(\"babel-runtime/helpers/createClass\");","module.exports = require(\"babel-runtime/helpers/classCallCheck\");","module.exports = require(\"babel-runtime/helpers/inherits\");","module.exports = require(\"babel-runtime/helpers/possibleConstructorReturn\");","module.exports = require(\"babel-runtime/core-js/object/get-prototype-of\");","module.exports = require(\"babel-runtime/regenerator\");","module.exports = require(\"babel-runtime/core-js/object/keys\");","module.exports = require(\"babel-runtime/helpers/asyncToGenerator\");","module.exports = require(\"babel-runtime/helpers/slicedToArray\");","module.exports = require(\"babel-runtime/helpers/extends\");","module.exports = require(\"babel-runtime/core-js/object/assign\");","module.exports = require(\"core-decorators\");","module.exports = require(\"babel-runtime/core-js/object/get-own-property-descriptor\");","module.exports = require(\"babel-runtime/core-js/promise\");","import { utils } from '@wikia/ad-engine';\n\nexport class Apstag {\n\t/**\n\t * @private\n\t */\n\tstatic instance;\n\n\tstatic make() {\n\t\tif (!Apstag.instance) {\n\t\t\tApstag.instance = new Apstag();\n\t\t}\n\n\t\treturn Apstag.instance;\n\t}\n\n\t/**\n\t * @private\n\t */\n\trenderImpEndCallbacks = [];\n\n\t/**\n\t * @private\n\t */\n\tconstructor() {\n\t\tthis.utils = utils;\n\t\tthis.insertScript();\n\t\tthis.configure();\n\t\tthis.addRenderImpHooks();\n\t}\n\n\t/**\n\t * @private\n\t */\n\tinsertScript() {\n\t\tthis.script = this.utils.scriptLoader.loadScript(\n\t\t\t'//c.amazon-adsystem.com/aax2/apstag.js',\n\t\t\t'text/javascript',\n\t\t\ttrue,\n\t\t\t'first',\n\t\t);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tasync addRenderImpHooks() {\n\t\tawait this.script;\n\t\tconst original = window.apstag.renderImp;\n\n\t\twindow.apstag.renderImp = (doc, impId) => {\n\t\t\toriginal(doc, impId);\n\t\t\tthis.renderImpEndCallbacks.forEach((cb) => cb(doc, impId));\n\t\t};\n\t}\n\n\t/**\n\t * @private\n\t */\n\t// TODO May not be necessary - try to remove.\n\tconfigure() {\n\t\twindow.apstag = window.apstag || {};\n\t\twindow.apstag._Q = window.apstag._Q || [];\n\n\t\tif (typeof window.apstag.init === 'undefined') {\n\t\t\twindow.apstag.init = (...args) => {\n\t\t\t\tthis.configureCommand('i', args);\n\t\t\t};\n\t\t}\n\n\t\tif (typeof window.apstag.fetchBids === 'undefined') {\n\t\t\twindow.apstag.fetchBids = (...args) => {\n\t\t\t\tthis.configureCommand('f', args);\n\t\t\t};\n\t\t}\n\t}\n\n\t/** @private */\n\tconfigureCommand(command, args) {\n\t\twindow.apstag._Q.push([command, args]);\n\t}\n\n\tasync init(apsConfig) {\n\t\tawait this.script;\n\t\twindow.apstag.init(apsConfig);\n\t}\n\n\t/**\n\t * @param {{slots: A9SlotDefinition[], timeout: number}} bidsConfig configuration of bids\n\t * @param {function(object)} cb Callback receiving current bids\n\t * @returns {!Promise} If `cb` has been omitted\n\t */\n\tasync fetchBids(bidsConfig, cb = null) {\n\t\tawait this.script;\n\n\t\treturn this.utils.getPromiseAndExecuteCallback((resolve) => {\n\t\t\twindow.apstag.fetchBids(bidsConfig, (currentBids) => resolve(currentBids));\n\t\t}, cb);\n\t}\n\n\tasync targetingKeys() {\n\t\tawait this.script;\n\n\t\treturn window.apstag.targetingKeys();\n\t}\n\n\tasync enableDebug() {\n\t\tawait this.script;\n\t\twindow.apstag.debug('enable');\n\t}\n\n\tasync disableDebug() {\n\t\tawait this.script;\n\t\twindow.apstag.debug('disable');\n\t}\n\n\t/**\n\t * Executes callback each time after apstag.renderImp is called\n\t * @param {function} callback\n\t */\n\tonRenderImpEnd(callback) {\n\t\tif (typeof callback !== 'function') {\n\t\t\tthrow new Error('onRenderImpEnd used with callback not being a function');\n\t\t}\n\t\tthis.renderImpEndCallbacks.push(callback);\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\n\nexport class Cmp {\n\tget exists() {\n\t\treturn !!window.__cmp;\n\t}\n\n\t/**\n\t * @param {*=} param\n\t * @param {function(object)} cb Callback receiving current bids\n\t * @returns {!Promise} If `cb` has been omitted\n\t */\n\tgetConsentData(param, cb = null) {\n\t\treturn utils.getPromiseAndExecuteCallback((resolve) => {\n\t\t\twindow.__cmp('getConsentData', param, (consentData) => resolve(consentData));\n\t\t}, cb);\n\t}\n\n\toverride(newCmp) {\n\t\twindow.__cmp = newCmp;\n\t}\n}\n\nexport const cmp = new Cmp();\n","export * from './apstag';\nexport * from './cmp';\n","import { context, utils } from '@wikia/ad-engine';\n\n/**\n * @abstract\n */\nexport class BaseBidder {\n\tconstructor(name, bidderConfig, timeout = 2000) {\n\t\tthis.name = name;\n\t\tthis.logGroup = `${name}-bidder`;\n\t\tthis.bidderConfig = bidderConfig;\n\t\tthis.timeout = timeout;\n\t\tthis.utils = utils;\n\t\tthis.context = context;\n\n\t\tthis.resetState();\n\n\t\tthis.utils.logger(this.logGroup, 'created');\n\t}\n\n\tresetState() {\n\t\tthis.called = false;\n\t\tthis.response = false;\n\n\t\tthis.onResponseCallbacks = new utils.LazyQueue();\n\t\tthis.onResponseCallbacks.onItemFlush((callback) => {\n\t\t\tcallback(this.name);\n\t\t});\n\t}\n\n\tcall() {\n\t\tthis.response = false;\n\t\tthis.called = true;\n\n\t\tthis.callBids(() => this.onBidResponse());\n\n\t\tthis.utils.logger(this.logGroup, 'called');\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tonBidResponse() {\n\t\tthis.response = true;\n\n\t\tthis.calculatePrices();\n\t\tthis.onResponseCallbacks.flush();\n\n\t\tthis.utils.logger(this.logGroup, 'respond');\n\t}\n\n\t/**\n\t * Returns bidder slot alias if available, otherwise slot name\n\t * @protected\n\t * @param {string} slotName\n\t * @returns {string}\n\t */\n\tgetSlotAlias(slotName) {\n\t\treturn context.get(`slots.${slotName}.bidderAlias`) || slotName;\n\t}\n\n\t/**\n\t * @param {string} slotName\n\t * @returns {{}}\n\t */\n\tgetSlotBestPrice(slotName) {\n\t\treturn this.getBestPrice(slotName);\n\t}\n\n\t/**\n\t * @param {string} slotName\n\t * @returns {{}}\n\t */\n\tgetSlotTargetingParams(slotName) {\n\t\tif (!this.called || !this.isSlotSupported(slotName)) {\n\t\t\treturn {};\n\t\t}\n\n\t\treturn this.getTargetingParams(slotName);\n\t}\n\n\t/**\n\t * @param {string} slotName\n\t * @returns {boolean}\n\t */\n\tisSlotSupported(slotName) {\n\t\treturn this.isSupported(slotName);\n\t}\n\n\t/**\n\t * Fires the Promise if bidder replied or timeout is reached\n\t * @returns {Promise}\n\t */\n\twaitForResponse() {\n\t\treturn this.utils.createWithTimeout((resolve) => {\n\t\t\tif (this.hasResponse()) {\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\tthis.addResponseListener(resolve);\n\t\t\t}\n\t\t}, this.timeout);\n\t}\n\n\t/**\n\t * @returns {boolean}\n\t */\n\thasResponse() {\n\t\treturn this.response;\n\t}\n\n\taddResponseListener(callback) {\n\t\tthis.onResponseCallbacks.push(callback);\n\t}\n\n\t/**\n\t * Check if bidder was called\n\t * @returns {boolean}\n\t */\n\twasCalled() {\n\t\treturn this.called;\n\t}\n\n\t/**\n\t * @abstract\n\t * @protected\n\t */\n\tcallBids(cb) {\n\t\tthrow new utils.NotImplementedException({ cb });\n\t}\n\n\t/**\n\t * @abstract\n\t * @protected\n\t */\n\tcalculatePrices() {\n\t\tthrow new utils.NotImplementedException();\n\t}\n\n\t/**\n\t * @abstract\n\t * @protected\n\t * @param {string} slotName\n\t * @returns {*|{}}\n\t */\n\tgetBestPrice(slotName) {\n\t\tthrow new utils.NotImplementedException({ slotName });\n\t}\n\n\t/**\n\t * @abstract\n\t * @protected\n\t * @param {string} slotName\n\t * @returns {*|{}}\n\t */\n\tgetTargetingParams(slotName) {\n\t\tthrow new utils.NotImplementedException({ slotName });\n\t}\n\n\t/**\n\t * Checks if slot with given name is supported by bidder.\n\t * @abstract\n\t * @protected\n\t * @param {string} slotName\n\t * @returns {boolean}\n\t */\n\tisSupported(slotName) {\n\t\tthrow new utils.NotImplementedException({ slotName });\n\t}\n}\n","import { context, events, slotService, utils } from '@wikia/ad-engine';\nimport { Apstag, cmp } from '../wrappers';\nimport { BaseBidder } from '../base-bidder';\n\nconst logGroup = 'A9';\n\n/**\n * @typedef {Object} A9SlotDefinition\n * @property {string} slotID\n * @property {string} slotName\n */\n\nexport class A9 extends BaseBidder {\n\t/** @private */\n\tloaded = false;\n\n\tconstructor(bidderConfig, timeout = 2000) {\n\t\tsuper('a9', bidderConfig, timeout);\n\n\t\tthis.isCMPEnabled = context.get('custom.isCMPEnabled');\n\t\tthis.amazonId = this.bidderConfig.amazonId;\n\t\tthis.slots = this.bidderConfig.slots;\n\t\tthis.slotsNames = Object.keys(this.slots);\n\t\tthis.bids = {};\n\t\tthis.priceMap = {};\n\t\tthis.slotNamesMap = {};\n\t\tthis.targetingKeys = [];\n\t\tthis.apstag = Apstag.make();\n\t\tthis.cmp = cmp;\n\t\tthis.utils = utils;\n\t\tthis.events = events;\n\t\tthis.slotService = slotService;\n\t\tthis.timeout = timeout;\n\t\tthis.bidsRefreshing = context.get('bidders.a9.bidsRefreshing') || {};\n\t\tthis.isRenderImpOverwritten = false;\n\t}\n\n\tgetPrices() {\n\t\treturn this.priceMap;\n\t}\n\n\tgetTargetingKeysToReset() {\n\t\treturn this.targetingKeys;\n\t}\n\n\tinit(consentData = {}) {\n\t\tthis.initIfNotLoaded(consentData);\n\n\t\tthis.bids = {};\n\t\tthis.priceMap = {};\n\t\tconst a9Slots = this.getA9SlotsDefinitions(this.slotsNames);\n\n\t\tthis.fetchBids(a9Slots);\n\t}\n\n\t/**\n\t * @private\n\t * @param consentData\n\t */\n\tinitIfNotLoaded(consentData) {\n\t\tif (!this.loaded) {\n\t\t\tthis.apstag.init(this.getApstagConfig(consentData));\n\t\t\tthis.loaded = true;\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t * @param consentData\n\t * @returns {{videoAdServer: string, deals: boolean, pubID: (*|string), gdpr: ()}}\n\t */\n\tgetApstagConfig(consentData) {\n\t\treturn {\n\t\t\tpubID: this.amazonId,\n\t\t\tvideoAdServer: 'DFP',\n\t\t\tdeals: !!this.bidderConfig.dealsEnabled,\n\t\t\t...this.getGdprIfApplicable(consentData),\n\t\t};\n\t}\n\n\t/**\n\t * @private\n\t * @param consentData\n\t * @returns {*}\n\t */\n\tgetGdprIfApplicable(consentData) {\n\t\tif (this.isCMPEnabled && consentData && consentData.consentData) {\n\t\t\treturn {\n\t\t\t\tgdpr: {\n\t\t\t\t\tenabled: consentData.gdprApplies,\n\t\t\t\t\tconsent: consentData.consentData,\n\t\t\t\t\tcmpTimeout: 5000,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\treturn {};\n\t}\n\n\t/**\n\t * Transforms slots names into A9 slot definitions.\n\t * @param {string[]} slotsNames\n\t * @returns {A9SlotDefinition[]}\n\t */\n\tgetA9SlotsDefinitions(slotsNames) {\n\t\treturn slotsNames\n\t\t\t.map((slotName) => this.getSlotAlias(slotName))\n\t\t\t.map((slotAlias) => this.createSlotDefinition(slotAlias))\n\t\t\t.filter((slot) => slot !== null);\n\t}\n\n\t/**\n\t * Fetches bids from A9.\n\t * Calls this.onBidResponse() upon success.\n\t * @private\n\t * @param {A9SlotDefinition[]} slots\n\t * @param {boolean} refresh\n\t */\n\tasync fetchBids(slots, refresh = false) {\n\t\tutils.logger(logGroup, 'fetching bids for slots', slots);\n\t\tconst currentBids = await this.apstag.fetchBids({ slots, timeout: this.timeout });\n\n\t\tutils.logger(logGroup, 'bids fetched for slots', slots, 'bids', currentBids);\n\t\tthis.addApstagRenderImpHookOnFirstFetch();\n\n\t\tcurrentBids.forEach(async (bid) => {\n\t\t\tconst slotName = this.slotNamesMap[bid.slotID] || bid.slotID;\n\t\t\tconst { keys, bidTargeting } = await this.getBidTargetingWithKeys(bid);\n\n\t\t\tthis.updateBidSlot(slotName, keys, bidTargeting);\n\t\t});\n\n\t\tthis.onBidResponse();\n\t\tif (refresh) {\n\t\t\tthis.events.emit(this.events.BIDS_REFRESH);\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\taddApstagRenderImpHookOnFirstFetch() {\n\t\tif (!this.isRenderImpOverwritten) {\n\t\t\tthis.isRenderImpOverwritten = true;\n\t\t\tthis.addApstagRenderImpHook();\n\t\t}\n\t}\n\n\t/**\n\t * Wraps apstag.renderImp\n\t * Calls this.refreshBid() if bids refreshing is enabled.\n\t * @private\n\t */\n\taddApstagRenderImpHook() {\n\t\tutils.logger(logGroup, 'overwriting window.apstag.renderImp');\n\t\tthis.apstag.onRenderImpEnd((doc, impId) => {\n\t\t\tconst slot = this.getRenderedSlot(impId);\n\t\t\tconst slotName = slot.getSlotName();\n\n\t\t\tutils.logger(logGroup, `bid used for slot ${slotName}`);\n\t\t\tdelete this.bids[this.getSlotAlias(slotName)];\n\n\t\t\tif (this.bidsRefreshing.enabled) {\n\t\t\t\tthis.refreshBid(slot);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Returns slot which used bid with given impression id.\n\t * @private\n\t * @param {string | number} impId\n\t * @returns {AdSlot | undefined }\n\t */\n\tgetRenderedSlot(impId) {\n\t\tlet renderedSlot;\n\n\t\tslotService.forEach((slot) => {\n\t\t\tif (slot.getTargeting().amzniid === impId) {\n\t\t\t\trenderedSlot = slot;\n\t\t\t}\n\t\t});\n\n\t\treturn renderedSlot;\n\t}\n\n\t/**\n\t * Refreshes bid for given slot.\n\t * @private\n\t * @param {AdSlot} slot\n\t */\n\trefreshBid(slot) {\n\t\tif (!this.shouldRefreshSlot(slot)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst slotDef = this.createSlotDefinition(this.getSlotAlias(slot.getSlotName()));\n\n\t\tif (slotDef) {\n\t\t\tutils.logger(logGroup, 'refresh bids for slot', slotDef);\n\t\t\tthis.fetchBids([slotDef], true);\n\t\t}\n\t}\n\n\t/**\n\t * Checks if slot should be refreshed.\n\t * @private\n\t * @param {AdSlot} slot\n\t * @returns {boolean}\n\t */\n\tshouldRefreshSlot(slot) {\n\t\treturn this.bidsRefreshing.slots.includes(this.getSlotAlias(slot.getSlotName()));\n\t}\n\n\t/**\n\t * Creates A9 slot definition from slot alias.\n\t * @param {string} slotAlias\n\t * @returns {A9SlotDefinition | null} Returns null i\n\t */\n\tcreateSlotDefinition(slotAlias) {\n\t\tconst config = this.slots[slotAlias];\n\t\tconst slotID = config.slotId || slotAlias;\n\t\tconst definition = {\n\t\t\tslotID,\n\t\t\tslotName: slotID,\n\t\t};\n\n\t\tthis.slotNamesMap[slotID] = slotAlias;\n\n\t\tif (!this.bidderConfig.videoEnabled && config.type === 'video') {\n\t\t\treturn null;\n\t\t}\n\t\tif (config.type === 'video') {\n\t\t\tdefinition.mediaType = 'video';\n\t\t} else {\n\t\t\tdefinition.sizes = config.sizes;\n\t\t}\n\n\t\treturn definition;\n\t}\n\n\t/**\n\t * @private\n\t * @param bid\n\t * @returns {*}\n\t */\n\tasync getBidTargetingWithKeys(bid) {\n\t\tif (this.bidderConfig.dealsEnabled) {\n\t\t\treturn {\n\t\t\t\tkeys: await bid.helpers.targetingKeys,\n\t\t\t\tbidTargeting: bid.targeting,\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tkeys: await this.apstag.targetingKeys(),\n\t\t\tbidTargeting: bid,\n\t\t};\n\t}\n\n\t/**\n\t * @private\n\t * @param slotName\n\t * @param keys\n\t * @param bidTargeting\n\t */\n\tupdateBidSlot(slotName, keys, bidTargeting) {\n\t\tthis.bids[slotName] = {};\n\t\tkeys.forEach((key) => {\n\t\t\tif (this.targetingKeys.indexOf(key) === -1) {\n\t\t\t\tthis.targetingKeys.push(key);\n\t\t\t}\n\t\t\tthis.bids[slotName][key] = bidTargeting[key];\n\t\t});\n\t}\n\n\t/**\n\t * @protected\n\t * @returns {Promise<void>}\n\t */\n\tasync callBids() {\n\t\tif (this.cmp.exists) {\n\t\t\tconst consentData = await this.cmp.getConsentData(null);\n\n\t\t\tthis.init(consentData);\n\t\t} else {\n\t\t\tthis.init();\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tcalculatePrices() {\n\t\treturn Object.keys(this.bids).forEach((slotName) => {\n\t\t\tthis.priceMap[slotName] = this.bids[slotName].amznbid;\n\t\t});\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tgetBestPrice(slotName) {\n\t\tconst slotAlias = this.getSlotAlias(slotName);\n\n\t\treturn this.priceMap[slotAlias] ? { a9: this.priceMap[slotAlias] } : {};\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tgetTargetingParams(slotName) {\n\t\treturn this.bids[this.getSlotAlias(slotName)] || {};\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tisSupported(slotName) {\n\t\treturn !!this.slots[this.getSlotAlias(slotName)];\n\t}\n}\n","export class BaseAdapter {\n\tconstructor({ enabled, slots }) {\n\t\tthis.enabled = enabled;\n\t\tthis.slots = slots;\n\t}\n\n\tprepareAdUnits() {\n\t\treturn Object.keys(this.slots).map((slotName) =>\n\t\t\tthis.prepareConfigForAdUnit(slotName, this.slots[slotName]),\n\t\t);\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Aol extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'aol';\n\t\tthis.network = options.network;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, placement, alias, sizeId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacement,\n\t\t\t\t\t\tnetwork: this.network,\n\t\t\t\t\t\talias,\n\t\t\t\t\t\tsizeId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { context } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class Appnexus extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'appnexus';\n\t\tthis.placements = options.placements;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, position = 'mobile' }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacementId: this.getPlacement(position),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tgetPlacement(position) {\n\t\tif (position === 'mobile') {\n\t\t\tconst vertical = context.get('targeting.mappedVerticalName');\n\n\t\t\tposition = vertical && this.placements[vertical] ? vertical : 'other';\n\t\t}\n\n\t\treturn this.placements[position];\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class AppnexusAst extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'appnexusAst';\n\t\tthis.aliases = {\n\t\t\tappnexus: [this.bidderName],\n\t\t};\n\t\tthis.debugPlacementId = options.debugPlacementId;\n\t\tthis.isDebugMode = utils.queryString.get('appnexusast_debug_mode') === '1';\n\t}\n\n\tprepareConfigForAdUnit(code, { placementId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tcontext: 'instream',\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacementId: this.isDebugMode ? this.debugPlacementId : placementId,\n\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\tskippable: false,\n\t\t\t\t\t\t\tplayback_method: ['auto_play_sound_off'],\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class AudienceNetwork extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'audienceNetwork';\n\t\tthis.testMode = utils.queryString.get('audiencenetworktest') === 'true';\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, placementId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\ttestMode: this.testMode,\n\t\t\t\t\t\tplacementId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class Beachfront extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'beachfront';\n\t\tthis.bidfloor = 0.01;\n\t\tthis.debugAppId = options.debugAppId;\n\t\tthis.isDebugMode = utils.queryString.get('beachfront_debug_mode') === '1';\n\t}\n\n\tprepareConfigForAdUnit(code, { appId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tcontext: 'instream',\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tbidfloor: this.bidfloor,\n\t\t\t\t\t\tappId: this.isDebugMode ? this.debugAppId : appId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class IndexExchange extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'indexExchange';\n\t\tthis.aliases = {\n\t\t\tix: [this.bidderName],\n\t\t};\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, siteId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: sizes.map((size) => ({\n\t\t\t\tbidder: this.bidderName,\n\t\t\t\tparams: {\n\t\t\t\t\tsiteId,\n\t\t\t\t\tsize,\n\t\t\t\t},\n\t\t\t})),\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Kargo extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'kargo';\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, placementId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tsizes,\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacementId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Lkqd extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'lkqd';\n\t}\n\n\tprepareConfigForAdUnit(code, { placementId, siteId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tsiteId,\n\t\t\t\t\t\tplacementId,\n\t\t\t\t\t\tpageurl: window.location.hostname,\n\t\t\t\t\t\toutput: 'svpaid',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Onemobile extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'onemobile';\n\t\tthis.siteId = options.siteId;\n\t}\n\n\tprepareConfigForAdUnit(code, { size, pos }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes: [size],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tdcn: this.siteId,\n\t\t\t\t\t\tpos,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Openx extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'openx';\n\t\tthis.delDomain = options.delDomain;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, unit }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tunit,\n\t\t\t\t\t\tdelDomain: this.delDomain,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Pubmatic extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'pubmatic';\n\t\tthis.publisherId = options.publisherId;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, ids }) {\n\t\tswitch (code.toLowerCase()) {\n\t\t\tcase 'featured':\n\t\t\tcase 'incontent_player':\n\t\t\t\treturn this.getVideoConfig(code, ids);\n\t\t\tdefault:\n\t\t\t\treturn this.getStandardConfig(code, sizes, ids);\n\t\t}\n\t}\n\n\tgetVideoConfig(code, ids) {\n\t\tconst videoParams = {\n\t\t\tvideo: {\n\t\t\t\tmimes: ['video/mp4', 'video/x-flv', 'video/webm', 'video/ogg'],\n\t\t\t\tskippable: true,\n\t\t\t\tminduration: 1,\n\t\t\t\tmaxduration: 30,\n\t\t\t\tstartdelay: 0,\n\t\t\t\tplaybackmethod: [2, 3],\n\t\t\t\tprotocols: [2, 3, 5, 6],\n\t\t\t\tlinearity: 1,\n\t\t\t\tplacement: 1,\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t\tcontext: 'instream',\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: this.getBids(ids, videoParams),\n\t\t};\n\t}\n\n\tgetStandardConfig(code, sizes, ids) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: this.getBids(ids),\n\t\t};\n\t}\n\n\tgetBids(ids, params = {}) {\n\t\treturn ids.map((adSlot) => ({\n\t\t\tbidder: this.bidderName,\n\t\t\tparams: {\n\t\t\t\tadSlot,\n\t\t\t\tpublisherId: this.publisherId,\n\t\t\t\t...params,\n\t\t\t},\n\t\t}));\n\t}\n}\n","import { context, slotService } from '@wikia/ad-engine';\nimport { getAdapters } from './adapters-registry';\n\nconst lazyLoadSlots = ['bottom_leaderboard'];\n\nfunction isSlotApplicable(code, lazyLoad) {\n\tconst isSlotLazy = lazyLoadSlots.indexOf(code) !== -1;\n\n\tif (!slotService.getState(code)) {\n\t\treturn false;\n\t}\n\n\tif (\n\t\tlazyLoad !== 'off' &&\n\t\t((lazyLoad === 'pre' && isSlotLazy) || (lazyLoad === 'post' && !isSlotLazy))\n\t) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nexport function setupAdUnits(adaptersConfig, lazyLoad = 'off') {\n\tconst adUnits = [];\n\tconst adapters = getAdapters(adaptersConfig);\n\n\tadapters.forEach((adapter) => {\n\t\tif (adapter && adapter.enabled) {\n\t\t\tconst adapterAdUnits = adapter.prepareAdUnits();\n\n\t\t\tadapterAdUnits.forEach((adUnit) => {\n\t\t\t\tif (adUnit && isSlotApplicable(adUnit.code, lazyLoad)) {\n\t\t\t\t\tadUnits.push(adUnit);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\treturn adUnits;\n}\n\nexport function getBidByAdId(adId) {\n\tif (!window.pbjs || typeof window.pbjs.getBidResponses !== 'function') {\n\t\treturn null;\n\t}\n\n\tlet bids = window.pbjs.getAllPrebidWinningBids().filter((bid) => adId === bid.adId);\n\n\tif (!bids.length) {\n\t\tconst responses = window.pbjs.getBidResponses();\n\n\t\tObject.keys(responses).forEach((adUnit) => {\n\t\t\tconst adUnitsBids = responses[adUnit].bids.filter((bid) => adId === bid.adId);\n\n\t\t\tbids = bids.concat(adUnitsBids);\n\t\t});\n\t}\n\n\treturn bids.length ? bids[0] : null;\n}\n\nexport function getAvailableBidsByAdUnitCode(adUnitCode) {\n\tlet bids = [];\n\n\tif (window.pbjs && typeof window.pbjs.getBidResponsesForAdUnitCode === 'function') {\n\t\tbids = window.pbjs.getBidResponsesForAdUnitCode(adUnitCode).bids || [];\n\t\tbids = bids.filter((bid) => bid.status !== 'rendered');\n\t}\n\n\treturn bids;\n}\n\nexport function getPrebid() {\n\treturn window.pbjs;\n}\n\nexport function getTargeting(slotName) {\n\treturn Object.assign(\n\t\t{\n\t\t\tpos: [slotName],\n\t\t},\n\t\tcontext.get('bidders.prebid.targeting') || {},\n\t);\n}\n\nexport function getWinningVideoBidBySlotName(slotName, allowedBidders) {\n\tif (!window.pbjs || !window.pbjs.getBidResponsesForAdUnitCode) {\n\t\treturn null;\n\t}\n\n\tconst bids = window.pbjs.getBidResponsesForAdUnitCode(slotName).bids || [];\n\n\treturn bids\n\t\t.filter((bid) => {\n\t\t\tconst canUseThisBidder = !allowedBidders || allowedBidders.indexOf(bid.bidderCode) !== -1;\n\t\t\tconst hasVast = bid.vastUrl || bid.vastContent;\n\n\t\t\treturn canUseThisBidder && hasVast && bid.cpm > 0;\n\t\t})\n\t\t.reduce((previousBid, currentBid) => {\n\t\t\tif (previousBid === null || currentBid.cpm > previousBid.cpm) {\n\t\t\t\treturn currentBid;\n\t\t\t}\n\n\t\t\treturn previousBid;\n\t\t}, null);\n}\n\nexport function pushPrebid(callback) {\n\twindow.pbjs.que.push(callback);\n}\n","import { context } from '@wikia/ad-engine';\nimport { getTargeting } from '../prebid-helper';\nimport { BaseAdapter } from './base-adapter';\n\nexport class Rubicon extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'rubicon';\n\t\tthis.accountId = options.accountId;\n\t}\n\n\tprepareConfigForAdUnit(code, { siteId, zoneId, sizeId, position }) {\n\t\tif (code === 'featured' && !context.get('custom.rubiconInFV')) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst targeting = getTargeting(code);\n\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaType: 'video',\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t\tcontext: 'instream',\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\taccountId: this.accountId,\n\t\t\t\t\t\tsiteId,\n\t\t\t\t\t\tzoneId,\n\t\t\t\t\t\tname: code,\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\tinventory: targeting,\n\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\tplayerWidth: '640',\n\t\t\t\t\t\t\tplayerHeight: '480',\n\t\t\t\t\t\t\tsize_id: sizeId,\n\t\t\t\t\t\t\tlanguage: targeting.lang ? targeting.lang[0] : 'en',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { getTargeting } from '../prebid-helper';\nimport { BaseAdapter } from './base-adapter';\n\nexport class RubiconDisplay extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'rubicon_display';\n\t\tthis.aliases = {\n\t\t\trubicon: [this.bidderName],\n\t\t};\n\t\tthis.accountId = options.accountId;\n\t}\n\n\tprepareConfigForAdUnit(code, { siteId, zoneId, sizes, position, targeting }) {\n\t\tconst pageTargeting = getTargeting(code);\n\n\t\tObject.keys(targeting || {}).forEach((key) => {\n\t\t\tpageTargeting[key] = targeting[key];\n\t\t});\n\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\taccountId: this.accountId,\n\t\t\t\t\t\tsiteId,\n\t\t\t\t\t\tzoneId,\n\t\t\t\t\t\tname: code,\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\tkeywords: ['rp.fastlane'],\n\t\t\t\t\t\tinventory: pageTargeting,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nconst price = utils.queryString.get('wikia_adapter');\nconst limit = parseInt(utils.queryString.get('wikia_adapter_limit'), 10) || 99;\nconst timeout = parseInt(utils.queryString.get('wikia_adapter_timeout'), 10) || 0;\nconst useRandomPrice = utils.queryString.get('wikia_adapter_random') === '1';\n\nexport class Wikia extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'wikia';\n\t\tthis.enabled = !!price;\n\t\tthis.limit = limit;\n\t\tthis.useRandomPrice = useRandomPrice;\n\t\tthis.timeout = timeout;\n\n\t\tthis.create = () => this;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tgetSpec() {\n\t\treturn {\n\t\t\tcode: this.bidderName,\n\t\t\tsupportedMediaTypes: ['banner'],\n\t\t};\n\t}\n\n\tgetPrice() {\n\t\tif (this.useRandomPrice) {\n\t\t\treturn Math.floor(Math.random() * 2000) / 100;\n\t\t}\n\n\t\treturn parseInt(price, 10) / 100;\n\t}\n\n\tcallBids(bidRequest, addBidResponse, done) {\n\t\twindow.pbjs.que.push(() => {\n\t\t\tthis.addBids(bidRequest, addBidResponse, done);\n\t\t});\n\t}\n\n\taddBids(bidRequest, addBidResponse, done) {\n\t\tsetTimeout(() => {\n\t\t\tbidRequest.bids.forEach((bid) => {\n\t\t\t\tif (this.limit === 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst bidResponse = window.pbjs.createBid(1);\n\t\t\t\tconst [width, height] = bid.sizes[0];\n\t\t\t\tconst cpm = this.getPrice();\n\n\t\t\t\tbidResponse.ad = this.getCreative(bid.sizes[0], cpm);\n\t\t\t\tbidResponse.bidderCode = bidRequest.bidderCode;\n\t\t\t\tbidResponse.cpm = cpm;\n\t\t\t\tbidResponse.ttl = 300;\n\t\t\t\tbidResponse.mediaType = 'banner';\n\t\t\t\tbidResponse.width = width;\n\t\t\t\tbidResponse.height = height;\n\n\t\t\t\taddBidResponse(bid.adUnitCode, bidResponse);\n\t\t\t\tthis.limit -= 1;\n\t\t\t});\n\t\t\tdone();\n\t\t}, this.timeout);\n\t}\n\n\tgetCreative(size, cpm) {\n\t\tconst creative = document.createElement('div');\n\n\t\tcreative.style.background = '#00b7e0';\n\t\tcreative.style.color = '#fff';\n\t\tcreative.style.fontFamily = 'sans-serif';\n\t\tcreative.style.height = '100%';\n\t\tcreative.style.textAlign = 'center';\n\t\tcreative.style.width = '100%';\n\n\t\tconst title = document.createElement('p');\n\n\t\ttitle.innerText = 'Wikia Creative';\n\t\ttitle.style.fontWeight = 'bold';\n\t\ttitle.style.margin = '0';\n\t\ttitle.style.paddingTop = '10px';\n\n\t\tconst details = document.createElement('small');\n\n\t\tdetails.innerText = `cpm: ${cpm}, size: ${size.join('x')}`;\n\n\t\tcreative.appendChild(title);\n\t\tcreative.appendChild(details);\n\n\t\treturn creative.outerHTML;\n\t}\n}\n","import { buildVastUrl, context, utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nconst price = utils.queryString.get('wikia_video_adapter');\nconst limit = parseInt(utils.queryString.get('wikia_adapter_limit'), 10) || 99;\nconst timeout = parseInt(utils.queryString.get('wikia_adapter_timeout'), 10) || 0;\nconst useRandomPrice = utils.queryString.get('wikia_adapter_random') === '1';\n\nexport class WikiaVideo extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'wikiaVideo';\n\t\tthis.enabled = !!price;\n\t\tthis.limit = limit;\n\t\tthis.useRandomPrice = useRandomPrice;\n\t\tthis.timeout = timeout;\n\n\t\tthis.create = () => this;\n\t}\n\n\tprepareConfigForAdUnit(code) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tcontext: 'outstream',\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tgetSpec() {\n\t\treturn {\n\t\t\tcode: this.bidderName,\n\t\t\tsupportedMediaTypes: ['video'],\n\t\t};\n\t}\n\n\tgetPrice() {\n\t\tif (this.useRandomPrice) {\n\t\t\treturn Math.floor(Math.random() * 20);\n\t\t}\n\n\t\treturn parseInt(price, 10) / 100;\n\t}\n\n\tgetVastUrl(width, height, slotName) {\n\t\treturn buildVastUrl(width / height, slotName, {\n\t\t\tvideoAdUnitId: context.get(`bidders.prebid.wikiaVideo.slots.${slotName}.videoAdUnitId`),\n\t\t\tcustomParams: context.get(`bidders.prebid.wikiaVideo.slots.${slotName}.customParams`),\n\t\t});\n\t}\n\n\tcallBids(bidRequest, addBidResponse, done) {\n\t\twindow.pbjs.que.push(() => {\n\t\t\tthis.addBids(bidRequest, addBidResponse, done);\n\t\t});\n\t}\n\n\taddBids(bidRequest, addBidResponse, done) {\n\t\tsetTimeout(() => {\n\t\t\tbidRequest.bids.forEach((bid) => {\n\t\t\t\tif (this.limit === 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst bidResponse = window.pbjs.createBid(1);\n\t\t\t\tconst [width, height] = bid.sizes[0];\n\t\t\t\tconst slotName = bid.adUnitCode;\n\n\t\t\t\tbidResponse.bidderCode = bidRequest.bidderCode;\n\t\t\t\tbidResponse.cpm = this.getPrice();\n\t\t\t\tbidResponse.creativeId = 'foo123_wikiaVideoCreativeId';\n\t\t\t\tbidResponse.ttl = 300;\n\t\t\t\tbidResponse.mediaType = 'video';\n\t\t\t\tbidResponse.width = width;\n\t\t\t\tbidResponse.height = height;\n\t\t\t\tbidResponse.vastUrl = this.getVastUrl(width, height, slotName);\n\t\t\t\tbidResponse.videoCacheKey = '123foo_wikiaVideoCacheKey';\n\n\t\t\t\taddBidResponse(bid.adUnitCode, bidResponse);\n\t\t\t\tthis.limit -= 1;\n\t\t\t});\n\n\t\t\tdone();\n\t\t}, this.timeout);\n\t}\n}\n","import { Aol } from './adapters/aol';\nimport { Appnexus } from './adapters/appnexus';\nimport { AppnexusAst } from './adapters/appnexus-ast';\nimport { AudienceNetwork } from './adapters/audience-network';\nimport { Beachfront } from './adapters/beachfront';\nimport { IndexExchange } from './adapters/index-exchange';\nimport { Kargo } from './adapters/kargo';\nimport { Lkqd } from './adapters/lkqd';\nimport { Onemobile } from './adapters/onemobile';\nimport { Openx } from './adapters/openx';\nimport { Pubmatic } from './adapters/pubmatic';\nimport { Rubicon } from './adapters/rubicon';\nimport { RubiconDisplay } from './adapters/rubicon-display';\nimport { Wikia } from './adapters/wikia';\nimport { WikiaVideo } from './adapters/wikia-video';\n\nconst adapters = [];\nconst customAdapters = [];\nconst availableAdapters = {\n\taol: Aol,\n\tappnexus: Appnexus,\n\tappnexusAst: AppnexusAst,\n\taudienceNetwork: AudienceNetwork,\n\tbeachfront: Beachfront,\n\tindexExchange: IndexExchange,\n\tkargo: Kargo,\n\tlkqd: Lkqd,\n\tonemobile: Onemobile,\n\topenx: Openx,\n\tpubmatic: Pubmatic,\n\trubicon: Rubicon,\n\trubiconDisplay: RubiconDisplay,\n};\n\nfunction registerAliases() {\n\tadapters\n\t\t.filter((adapter) => adapter.aliases)\n\t\t.forEach((adapter) => {\n\t\t\twindow.pbjs.que.push(() => {\n\t\t\t\tconst aliasMap = adapter.aliases;\n\n\t\t\t\tObject.keys(aliasMap).forEach((bidderName) => {\n\t\t\t\t\taliasMap[bidderName].forEach((alias) => {\n\t\t\t\t\t\twindow.pbjs.aliasBidder(bidderName, alias);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n}\n\nfunction setupAdapters(bidders) {\n\tObject.keys(availableAdapters).forEach((key) => {\n\t\tif (bidders[key]) {\n\t\t\tconst adapter = new availableAdapters[key](bidders[key]);\n\n\t\t\tadapters.push(adapter);\n\t\t}\n\t});\n\n\tsetupCustomAdapters(bidders);\n}\n\nfunction setupCustomAdapters(bidders) {\n\tif (bidders.wikia) {\n\t\tcustomAdapters.push(new Wikia(bidders.wikia));\n\t}\n\n\tif (bidders.wikiaVideo) {\n\t\tcustomAdapters.push(new WikiaVideo(bidders.wikiaVideo));\n\t}\n\n\tcustomAdapters.forEach((adapter) => {\n\t\tadapters.push(adapter);\n\n\t\twindow.pbjs.que.push(() => {\n\t\t\twindow.pbjs.registerBidAdapter(adapter.create, adapter.bidderName);\n\t\t});\n\t});\n}\n\nexport function getPriorities() {\n\tconst priorities = {};\n\n\tadapters.forEach((adapter) => {\n\t\tpriorities[adapter.bidderName] = adapter.priority || 1;\n\t});\n\n\treturn priorities;\n}\n\nexport function getAdapters(config) {\n\tif (adapters.length === 0 && config) {\n\t\tsetupAdapters(config);\n\t\tregisterAliases();\n\t}\n\n\treturn adapters;\n}\n","import { getAdapters } from './adapters-registry';\nimport { Prebid } from './index';\n\nconst DEFAULT_MAX_CPM = 20;\nconst videoBiddersCap50 = ['appnexusAst', 'rubicon', 'wikiaVideo']; // bidders with $50 cap\n\nfunction isValidPrice(bid) {\n\treturn bid.getStatusCode && bid.getStatusCode() === Prebid.validResponseStatusCode;\n}\n\n/**\n * Round cpm to predefined values.\n *\n * @param {number} cpm\n * @param {number} maxCpm\n * @returns {number}\n */\nfunction roundCpm(cpm, maxCpm) {\n\tlet result = Math.floor(maxCpm);\n\n\tif (cpm === 0) {\n\t\tresult = 0.0;\n\t} else if (cpm < 0.05) {\n\t\tresult = 0.01;\n\t} else if (cpm < 5.0) {\n\t\tresult = Math.floor(cpm * 20) / 20;\n\t} else if (cpm < 10.0) {\n\t\tresult = Math.floor(cpm * 10) / 10;\n\t} else if (cpm < 20.0) {\n\t\tresult = Math.floor(cpm * 2) / 2;\n\t} else if (cpm < maxCpm) {\n\t\tresult = Math.floor(cpm);\n\t}\n\n\treturn result;\n}\n\n/**\n * Round cpm to predefined values and transform to String with 2 decimal places.\n *\n * @param {number} cpm\n * @param {number} maxCpm\n * @returns {string}\n */\nexport function transformPriceFromCpm(cpm, maxCpm = DEFAULT_MAX_CPM) {\n\tmaxCpm = Math.max(maxCpm, DEFAULT_MAX_CPM);\n\n\treturn roundCpm(cpm, maxCpm).toFixed(2);\n}\n\n/**\n *\n * @param {string} slotName\n * @return {object}\n */\nexport function getPrebidBestPrice(slotName) {\n\tconst bestPrices = {};\n\n\tif (window.pbjs && window.pbjs.getBidResponsesForAdUnitCode) {\n\t\tconst slotBids = window.pbjs.getBidResponsesForAdUnitCode(slotName).bids || [];\n\n\t\tgetAdapters().forEach((adapter) => {\n\t\t\tbestPrices[adapter.bidderName] = '';\n\t\t});\n\n\t\tslotBids.forEach((bid) => {\n\t\t\tif (isValidPrice(bid) && bid.status !== 'rendered') {\n\t\t\t\tconst { bidderCode, cpm } = bid;\n\t\t\t\tconst cmpPrice = Math.max(bestPrices[bidderCode] || 0, roundCpm(cpm, DEFAULT_MAX_CPM));\n\n\t\t\t\tif (cmpPrice > 0) {\n\t\t\t\t\tbestPrices[bidderCode] = cmpPrice.toFixed(2);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\treturn bestPrices;\n}\n\nexport function transformPriceFromBid(bid) {\n\tlet maxCpm = DEFAULT_MAX_CPM;\n\n\tif (videoBiddersCap50.includes(bid.bidderCode)) {\n\t\tmaxCpm = 50;\n\t}\n\n\treturn transformPriceFromCpm(bid.cpm, maxCpm);\n}\n","import { context } from '@wikia/ad-engine';\nimport { transformPriceFromBid } from './price-helper';\n\nconst dfpVideoBidders = [\n\t{ bidderCode: 'appnexusAst', contextKey: 'custom.appnexusDfp' },\n\t{ bidderCode: 'beachfront', contextKey: 'custom.beachfrontDfp' },\n\t{ bidderCode: 'lkqd', contextKey: 'custom.lkqdDfp' },\n\t{ bidderCode: 'rubicon', contextKey: 'custom.rubiconDfp' },\n\t{ bidderCode: 'pubmatic', contextKey: 'custom.pubmaticDfp' },\n];\n\nexport function getSettings() {\n\treturn {\n\t\tstandard: {\n\t\t\talwaysUseBid: false,\n\t\t\tadserverTargeting: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_bidder',\n\t\t\t\t\tval: ({ bidderCode }) => bidderCode,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_adid',\n\t\t\t\t\tval: ({ adId }) => adId,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_pb',\n\t\t\t\t\tval: (bidResponse) => transformPriceFromBid(bidResponse),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_size',\n\t\t\t\t\tval: ({ size }) => size,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_uuid',\n\t\t\t\t\tval: (bidResponse) => getBidderUuid(bidResponse),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t};\n}\n\nfunction getBidderUuid(bidResponse) {\n\tconst isVideo = dfpVideoBidders.some(\n\t\t(video) => bidResponse.bidderCode === video.bidderCode && context.get(video.contextKey),\n\t);\n\n\treturn isVideo ? bidResponse.videoCacheKey : 'disabled';\n}\n","import { decorate } from 'core-decorators';\nimport { context, events, utils } from '@wikia/ad-engine';\nimport { BaseBidder } from '../base-bidder';\nimport { getPriorities } from './adapters-registry';\nimport { getPrebidBestPrice } from './price-helper';\nimport { getSettings } from './prebid-settings';\nimport { getAvailableBidsByAdUnitCode, setupAdUnits } from './prebid-helper';\n\nfunction postponeExecutionUntilPbjsLoads(method) {\n\treturn function (...args) {\n\t\treturn window.pbjs.que.push(() => method.apply(this, args));\n\t};\n}\n\nevents.on(events.VIDEO_AD_IMPRESSION, markWinningBidAsUsed);\nevents.on(events.VIDEO_AD_ERROR, markWinningBidAsUsed);\n\nfunction markWinningBidAsUsed(adSlot) {\n\t// Mark ad as rendered\n\tconst adId = context.get(`slots.${adSlot.getSlotName()}.targeting.hb_adid`);\n\n\tif (adId) {\n\t\tif (window.pbjs && typeof window.pbjs.markWinningBidAsUsed === 'function') {\n\t\t\twindow.pbjs.markWinningBidAsUsed({ adId });\n\t\t\tevents.emit(events.VIDEO_AD_USED, adSlot);\n\t\t}\n\t}\n}\n\nconst logGroup = 'prebid';\n\nlet loaded = false;\n\nwindow.pbjs = window.pbjs || {};\nwindow.pbjs.que = window.pbjs.que || [];\n\nevents.registerEvent('BIDS_REFRESH');\nevents.registerEvent('PREBID_LAZY_CALL');\n\nexport class Prebid extends BaseBidder {\n\tstatic validResponseStatusCode = 1;\n\tstatic errorResponseStatusCode = 2;\n\n\tconstructor(bidderConfig, timeout = 2000) {\n\t\tsuper('prebid', bidderConfig, timeout);\n\n\t\tthis.insertScript();\n\n\t\tthis.lazyLoaded = false;\n\t\tthis.isLazyLoadingEnabled = this.bidderConfig.lazyLoadingEnabled;\n\t\tthis.isCMPEnabled = context.get('custom.isCMPEnabled');\n\t\tthis.adUnits = setupAdUnits(this.bidderConfig, this.isLazyLoadingEnabled ? 'pre' : 'off');\n\t\tthis.prebidConfig = {\n\t\t\tdebug:\n\t\t\t\tutils.queryString.get('pbjs_debug') === '1' ||\n\t\t\t\tutils.queryString.get('pbjs_debug') === 'true',\n\t\t\tenableSendAllBids: true,\n\t\t\tbidderSequence: 'random',\n\t\t\tbidderTimeout: this.timeout,\n\t\t\tcache: {\n\t\t\t\turl: 'https://prebid.adnxs.com/pbc/v1/cache',\n\t\t\t},\n\t\t\tuserSync: {\n\t\t\t\tiframeEnabled: true,\n\t\t\t\tenabledBidders: [],\n\t\t\t\tsyncDelay: 6000,\n\t\t\t},\n\t\t};\n\t\tthis.bidsRefreshing = context.get('bidders.prebid.bidsRefreshing');\n\n\t\tif (this.isCMPEnabled) {\n\t\t\tthis.prebidConfig.consentManagement = {\n\t\t\t\tcmpApi: 'iab',\n\t\t\t\ttimeout: this.timeout,\n\t\t\t\tallowAuctionWithoutConsent: false,\n\t\t\t};\n\t\t}\n\n\t\twindow.pbjs = window.pbjs || {};\n\t\twindow.pbjs.que = window.pbjs.que || [];\n\n\t\tthis.applyConfig(this.prebidConfig);\n\n\t\tif (this.bidsRefreshing && this.bidsRefreshing.enabled) {\n\t\t\tthis.registerBidsRefreshing();\n\t\t}\n\t}\n\n\t@decorate(postponeExecutionUntilPbjsLoads)\n\tapplyConfig(config) {\n\t\twindow.pbjs.setConfig(config);\n\t}\n\n\t@decorate(postponeExecutionUntilPbjsLoads)\n\tapplySettings() {\n\t\twindow.pbjs.bidderSettings = getSettings();\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tcallBids(bidsBackHandler) {\n\t\tif (!this.adUnits) {\n\t\t\tthis.adUnits = setupAdUnits(this.bidderConfig, this.isLazyLoadingEnabled ? 'pre' : 'off');\n\t\t}\n\n\t\tif (this.adUnits.length > 0) {\n\t\t\tthis.applySettings();\n\t\t\tthis.requestBids(this.adUnits, bidsBackHandler, this.removeAdUnits);\n\t\t}\n\n\t\tif (this.isLazyLoadingEnabled) {\n\t\t\tevents.on(events.PREBID_LAZY_CALL, () => {\n\t\t\t\tthis.lazyCall(bidsBackHandler);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\tinsertScript() {\n\t\tif (loaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst libraryUrl = context.get('bidders.prebid.libraryUrl');\n\n\t\tif (!libraryUrl) {\n\t\t\tutils.logger(\n\t\t\t\tlogGroup,\n\t\t\t\t'Prebid library URL not defined. Assuming that window.pbjs will be loaded.',\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\n\t\tutils.scriptLoader.loadScript(libraryUrl, 'text/javascript', true, 'first');\n\t\tloaded = true;\n\t}\n\n\tlazyCall(bidsBackHandler) {\n\t\tif (this.lazyLoaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.lazyLoaded = true;\n\n\t\tconst adUnitsLazy = setupAdUnits(this.bidderConfig, 'post');\n\n\t\tif (adUnitsLazy.length > 0) {\n\t\t\tthis.requestBids(adUnitsLazy, bidsBackHandler);\n\n\t\t\tthis.adUnits = this.adUnits.concat(adUnitsLazy);\n\t\t}\n\t}\n\n\tremoveAdUnits() {\n\t\t(window.pbjs.adUnits || []).forEach((adUnit) => {\n\t\t\twindow.pbjs.removeAdUnit(adUnit.code);\n\t\t});\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tgetBestPrice(slotName) {\n\t\tconst slotAlias = this.getSlotAlias(slotName);\n\n\t\treturn getPrebidBestPrice(slotAlias);\n\t}\n\n\tgetTargetingKeysToReset() {\n\t\treturn ['hb_bidder', 'hb_adid', 'hb_pb', 'hb_size', 'hb_uuid'];\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tgetTargetingParams(slotName) {\n\t\tlet slotParams = {};\n\n\t\tconst slotAlias = this.getSlotAlias(slotName);\n\t\tconst bids = getAvailableBidsByAdUnitCode(slotAlias);\n\n\t\tif (bids.length) {\n\t\t\tlet bidParams = null;\n\t\t\tconst priorities = getPriorities();\n\n\t\t\tbids.forEach((param) => {\n\t\t\t\tif (!bidParams) {\n\t\t\t\t\tbidParams = param;\n\t\t\t\t} else if (bidParams.cpm === param.cpm) {\n\t\t\t\t\tif (priorities[bidParams.bidder] === priorities[param.bidder]) {\n\t\t\t\t\t\tbidParams = bidParams.timeToRespond > param.timeToRespond ? param : bidParams;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbidParams = priorities[bidParams.bidder] < priorities[param.bidder] ? param : bidParams;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tbidParams = bidParams.cpm < param.cpm ? param : bidParams;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (bidParams) {\n\t\t\t\tslotParams = bidParams.adserverTargeting;\n\t\t\t}\n\n\t\t\t// ADEN-7436: AppNexus hb_uuid fix\n\t\t\t// (adserverTargeting params are being set before cache key is returned)\n\t\t\tslotParams.hb_uuid = slotParams.hb_uuid || bidParams.videoCacheKey || 'disabled';\n\t\t}\n\n\t\treturn slotParams || {};\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tisSupported(slotName) {\n\t\tconst slotAlias = this.getSlotAlias(slotName);\n\n\t\treturn this.adUnits && this.adUnits.some((adUnit) => adUnit.code === slotAlias);\n\t}\n\n\tregisterBidsRefreshing() {\n\t\twindow.pbjs.que.push(() => {\n\t\t\tconst refreshUsedBid = (winningBid) => {\n\t\t\t\tif (this.bidsRefreshing.slots.indexOf(winningBid.adUnitCode) !== -1) {\n\t\t\t\t\tevents.emit(events.BIDS_REFRESH);\n\t\t\t\t\tconst adUnitsToRefresh = this.adUnits.filter(\n\t\t\t\t\t\t(adUnit) =>\n\t\t\t\t\t\t\tadUnit.code === winningBid.adUnitCode &&\n\t\t\t\t\t\t\tadUnit.bids &&\n\t\t\t\t\t\t\tadUnit.bids[0] &&\n\t\t\t\t\t\t\tadUnit.bids[0].bidder === winningBid.bidderCode,\n\t\t\t\t\t);\n\n\t\t\t\t\tthis.requestBids(adUnitsToRefresh, this.bidsRefreshing.bidsBackHandler);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\twindow.pbjs.onEvent('bidWon', refreshUsedBid);\n\t\t\tevents.once(events.PAGE_CHANGE_EVENT, () => {\n\t\t\t\twindow.pbjs.offEvent('bidWon', refreshUsedBid);\n\t\t\t});\n\t\t});\n\t}\n\n\t@decorate(postponeExecutionUntilPbjsLoads)\n\trequestBids(adUnits, bidsBackHandler, withRemove = undefined) {\n\t\tif (withRemove) {\n\t\t\twithRemove();\n\t\t}\n\n\t\twindow.pbjs.requestBids({\n\t\t\tadUnits,\n\t\t\tbidsBackHandler,\n\t\t});\n\t}\n}\n","import { context, events, utils } from '@wikia/ad-engine';\nimport { A9 } from './a9';\nimport { Prebid } from './prebid';\nimport * as prebidHelper from './prebid/prebid-helper';\nimport { transformPriceFromBid } from './prebid/price-helper';\n\nconst biddersRegistry = {};\nconst realSlotPrices = {};\nconst logGroup = 'bidders';\n\nevents.on(events.VIDEO_AD_REQUESTED, (adSlot) => {\n\tadSlot.updateWinningPbBidderDetails();\n});\n\nevents.on(events.VIDEO_AD_USED, (adSlot) => {\n\tupdateSlotTargeting(adSlot.getSlotName());\n});\n\nfunction applyTargetingParams(slotName, targeting) {\n\tObject.keys(targeting).forEach((key) =>\n\t\tcontext.set(`slots.${slotName}.targeting.${key}`, targeting[key]),\n\t);\n}\n\n/**\n * Executes callback function on each enabled bidder\n *\n * @param {function} callback\n */\nfunction forEachBidder(callback) {\n\tObject.keys(biddersRegistry).forEach((bidderName) => {\n\t\tcallback(biddersRegistry[bidderName]);\n\t});\n}\n\nfunction getBidParameters(slotName) {\n\tconst slotParams = {};\n\n\tforEachBidder((bidder) => {\n\t\tif (bidder && bidder.wasCalled()) {\n\t\t\tconst params = bidder.getSlotTargetingParams(slotName);\n\n\t\t\tObject.assign(slotParams, params);\n\t\t}\n\t});\n\n\treturn slotParams;\n}\n\nfunction getCurrentSlotPrices(slotName) {\n\tconst slotPrices = {};\n\n\tforEachBidder((bidder) => {\n\t\tif (bidder && bidder.isSlotSupported(slotName)) {\n\t\t\tconst priceFromBidder = bidder.getSlotBestPrice(slotName);\n\n\t\t\tObject.keys(priceFromBidder).forEach((bidderName) => {\n\t\t\t\tslotPrices[bidderName] = priceFromBidder[bidderName];\n\t\t\t});\n\t\t}\n\t});\n\n\treturn slotPrices;\n}\n\nfunction getDfpSlotPrices(slotName) {\n\treturn realSlotPrices[slotName] || {};\n}\n\n/**\n * Returns true if all bidders replied\n *\n * @returns {boolean}\n */\nfunction hasAllResponses() {\n\tconst missingBidders = Object.keys(biddersRegistry).filter((bidderName) => {\n\t\tconst bidder = biddersRegistry[bidderName];\n\n\t\treturn !bidder.hasResponse();\n\t});\n\n\treturn missingBidders.length === 0;\n}\n\nfunction resetTargetingKeys(slotName) {\n\tforEachBidder((bidder) => {\n\t\tbidder.getTargetingKeysToReset().forEach((key) => {\n\t\t\tcontext.remove(`slots.${slotName}.targeting.${key}`);\n\t\t});\n\t});\n\n\tutils.logger(logGroup, 'resetTargetingKeys', slotName);\n}\n\nfunction requestBids({ responseListener = null }) {\n\tconst config = context.get('bidders');\n\n\tif (config.prebid && config.prebid.enabled) {\n\t\tbiddersRegistry.prebid = new Prebid(config.prebid, config.timeout);\n\t}\n\n\tif (config.a9 && config.a9.enabled) {\n\t\tbiddersRegistry.a9 = new A9(config.a9, config.timeout);\n\t}\n\n\tforEachBidder((bidder) => {\n\t\tif (responseListener) {\n\t\t\tbidder.addResponseListener(responseListener);\n\t\t}\n\n\t\tbidder.call();\n\t});\n}\n\n/**\n * Executes callback function if bidding is finished or timeout is reached\n *\n * @param {function} callback\n *\n * @returns {Promise}\n */\nfunction runOnBiddingReady(callback) {\n\tconst responses = [];\n\n\tforEachBidder((bidder) => {\n\t\tresponses.push(bidder.waitForResponse());\n\t});\n\n\treturn Promise.all(responses).then(callback);\n}\n\nfunction storeRealSlotPrices(slotName) {\n\trealSlotPrices[slotName] = getCurrentSlotPrices(slotName);\n}\n\nfunction updateSlotTargeting(slotName) {\n\tconst bidderTargeting = getBidParameters(slotName);\n\n\tstoreRealSlotPrices(slotName);\n\n\tresetTargetingKeys(slotName);\n\tapplyTargetingParams(slotName, bidderTargeting);\n\n\tutils.logger(logGroup, 'updateSlotTargeting', slotName, bidderTargeting);\n\n\treturn bidderTargeting;\n}\n\nexport const bidders = {\n\tgetBidParameters,\n\tgetCurrentSlotPrices,\n\tgetDfpSlotPrices,\n\thasAllResponses,\n\tprebidHelper,\n\trequestBids,\n\trunOnBiddingReady,\n\ttransformPriceFromBid,\n\tupdateSlotTargeting,\n};\n\nexport * from './wrappers';\n"],"sourceRoot":""}