{"version":3,"sources":["webpack://adEngine/webpack/bootstrap","webpack://adEngine/external \"@wikia/ad-engine\"","webpack://adEngine/external \"babel-runtime/helpers/createClass\"","webpack://adEngine/external \"babel-runtime/helpers/classCallCheck\"","webpack://adEngine/external \"babel-runtime/helpers/inherits\"","webpack://adEngine/external \"babel-runtime/helpers/possibleConstructorReturn\"","webpack://adEngine/external \"babel-runtime/core-js/object/get-prototype-of\"","webpack://adEngine/external \"babel-runtime/core-js/object/keys\"","webpack://adEngine/external \"babel-runtime/helpers/slicedToArray\"","webpack://adEngine/external \"babel-runtime/core-js/object/assign\"","webpack://adEngine/external \"core-decorators\"","webpack://adEngine/external \"babel-runtime/core-js/object/get-own-property-descriptor\"","webpack://adEngine/external \"babel-runtime/helpers/extends\"","webpack://adEngine/external \"babel-runtime/core-js/promise\"","webpack://adEngine/./src/ad-bidders/base-bidder.js","webpack://adEngine/./src/ad-bidders/a9/index.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/base-adapter.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/aol.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/appnexus.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/appnexus-ast.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/audience-network.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/beachfront.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/index-exchange.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/kargo.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/lkqd.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/onemobile.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/openx.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/pubmatic.js","webpack://adEngine/./src/ad-bidders/prebid/prebid-helper.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/rubicon.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/rubicon-display.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/wikia.js","webpack://adEngine/./src/ad-bidders/prebid/adapters/wikia-video.js","webpack://adEngine/./src/ad-bidders/prebid/adapters-registry.js","webpack://adEngine/./src/ad-bidders/prebid/price-helper.js","webpack://adEngine/./src/ad-bidders/prebid/prebid-settings.js","webpack://adEngine/./src/ad-bidders/prebid/index.js","webpack://adEngine/./src/ad-bidders/index.js"],"names":["BaseBidder","name","bidderConfig","timeout","logGroup","resetState","onResponse","onResponseCall","utils","logger","callback","onResponseCallbacks","push","response","called","callBids","slotName","context","get","getBestPrice","isSlotSupported","getTargetingParams","isSupported","calculatePrices","flush","LazyQueue","onItemFlush","createWithTimeout","resolve","hasResponse","addResponseListener","loaded","A9","isCMPEnabled","amazonId","slots","slotsNames","bids","priceMap","slotNamesMap","targetingKeys","bidsRefreshing","isBidsRefreshingEnabled","enabled","isRenderImpOverwritten","forEach","amznbid","window","__cmp","consentData","init","insertScript","configureApstag","apsConfig","pubID","videoAdServer","deals","dealsEnabled","gdpr","gdprApplies","consent","cmpTimeout","apstag","a9Slots","getA9SlotsDefinitions","fetchBids","refresh","currentBids","overwriteRenderImp","bid","slotID","bidTargeting","keys","helpers","targeting","key","indexOf","events","emit","BIDS_REFRESH","_Q","args","configureApstagCommand","command","slotAlias","getSlotAlias","a9","scriptLoader","loadScript","renderImp","original","doc","impId","slot","getRenderedSlot","getSlotName","refreshBid","includes","renderedSlot","slotService","getTargeting","amzniid","shouldRefreshSlot","slotDef","createSlotDefinition","map","filter","config","slotId","definition","getState","videoEnabled","type","mediaType","sizes","BaseAdapter","prepareConfigForAdUnit","Aol","options","bidderName","network","code","placement","alias","sizeId","mediaTypes","banner","bidder","params","Appnexus","placements","position","placementId","getPlacement","vertical","AppnexusAst","aliases","appnexus","debugPlacementId","isDebugMode","queryString","video","playerSize","skippable","playback_method","AudienceNetwork","testMode","Beachfront","bidfloor","debugAppId","appId","IndexExchange","ix","siteId","size","Kargo","Lkqd","Onemobile","pos","dcn","Openx","delDomain","unit","Pubmatic","publisherId","ids","toLowerCase","getVideoConfig","getStandardConfig","videoParams","mimes","minduration","maxduration","startdelay","playbackmethod","protocols","linearity","getBids","adSlot","lazyLoadSlots","isSlotApplicable","lazyLoad","isSlotLazy","setupAdUnits","adaptersConfig","adUnits","adapters","getAdapters","adapter","adapterAdUnits","prepareAdUnits","adUnit","getBidByAdId","adId","pbjs","getBidResponses","getAllPrebidWinningBids","length","responses","adUnitsBids","concat","getAvailableBidsByAdUnitCode","adUnitCode","getBidResponsesForAdUnitCode","status","getPrebid","getWinningVideoBidBySlotName","allowedBidders","canUseThisBidder","bidderCode","hasVast","vastUrl","vastContent","cpm","reduce","previousBid","currentBid","pushPrebid","que","Rubicon","accountId","zoneId","inventory","playerWidth","playerHeight","size_id","language","lang","RubiconDisplay","rubicon","pageTargeting","keywords","price","limit","parseInt","useRandomPrice","Wikia","create","supportedMediaTypes","Math","floor","random","bidRequest","addBidResponse","done","addBids","setTimeout","bidResponse","createBid","width","height","getPrice","ad","getCreative","ttl","creative","document","createElement","style","background","color","fontFamily","textAlign","title","innerText","fontWeight","margin","paddingTop","details","join","appendChild","outerHTML","WikiaVideo","buildVastUrl","videoAdUnitId","customParams","creativeId","getVastUrl","videoCacheKey","customAdapters","availableAdapters","aol","appnexusAst","audienceNetwork","beachfront","indexExchange","kargo","lkqd","onemobile","openx","pubmatic","rubiconDisplay","registerAliases","aliasMap","aliasBidder","setupAdapters","bidders","setupCustomAdapters","wikia","wikiaVideo","registerBidAdapter","getPriorities","priorities","priority","DEFAULT_MAX_CPM","videoBiddersCap50","isValidPrice","getStatusCode","Prebid","validResponseStatusCode","roundCpm","maxCpm","result","transformPriceFromCpm","max","toFixed","getPrebidBestPrice","bestPrices","slotBids","cmpPrice","transformPriceFromBid","dfpVideoBidders","contextKey","getSettings","standard","alwaysUseBid","adserverTargeting","val","getBidderUuid","isVideo","some","postponeExecutionUntilPbjsLoads","method","apply","registerEvent","decorate","lazyLoaded","isLazyLoadingEnabled","lazyLoadingEnabled","prebidConfig","debug","enableSendAllBids","bidderSequence","bidderTimeout","cache","url","userSync","iframeEnabled","enabledBidders","syncDelay","consentManagement","cmpApi","allowAuctionWithoutConsent","applyConfig","registerBidsRefreshing","setConfig","bidderSettings","bidsBackHandler","applySettings","requestBids","removeAdUnits","on","PREBID_LAZY_CALL","lazyCall","libraryUrl","adUnitsLazy","removeAdUnit","slotParams","bidParams","param","timeToRespond","hb_uuid","refreshUsedBid","winningBid","adUnitsToRefresh","onEvent","once","PAGE_CHANGE_EVENT","offEvent","withRemove","undefined","errorResponseStatusCode","biddersRegistry","realSlotPrices","VIDEO_AD_REQUESTED","resetTargetingKeys","applyTargetingParams","set","forEachBidder","getBidParameters","wasCalled","getSlotTargetingParams","getCurrentSlotPrices","slotPrices","priceFromBidder","getSlotBestPrice","getDfpSlotPrices","hasAllResponses","missingBidders","getTargetingKeysToReset","remove","responseListener","prebid","call","runOnBiddingReady","waitForResponse","all","then","storeRealSlotPrices","updateSlotTargeting","bidderTargeting","prebidHelper"],"mappings":"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","file":"ad-bidders.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 13);\n","module.exports = require(\"@wikia/ad-engine\");","module.exports = require(\"babel-runtime/helpers/createClass\");","module.exports = require(\"babel-runtime/helpers/classCallCheck\");","module.exports = require(\"babel-runtime/helpers/inherits\");","module.exports = require(\"babel-runtime/helpers/possibleConstructorReturn\");","module.exports = require(\"babel-runtime/core-js/object/get-prototype-of\");","module.exports = require(\"babel-runtime/core-js/object/keys\");","module.exports = require(\"babel-runtime/helpers/slicedToArray\");","module.exports = require(\"babel-runtime/core-js/object/assign\");","module.exports = require(\"core-decorators\");","module.exports = require(\"babel-runtime/core-js/object/get-own-property-descriptor\");","module.exports = require(\"babel-runtime/helpers/extends\");","module.exports = require(\"babel-runtime/core-js/promise\");","import { context, utils } from '@wikia/ad-engine';\n\nexport class BaseBidder {\n\tconstructor(name, bidderConfig, timeout = 2000) {\n\t\tthis.name = name;\n\t\tthis.logGroup = `${name}-bidder`;\n\t\tthis.bidderConfig = bidderConfig;\n\t\tthis.timeout = timeout;\n\n\t\tthis.resetState();\n\t\tthis.onResponse = () => this.onResponseCall();\n\n\t\tutils.logger(this.logGroup, 'created');\n\t}\n\n\taddResponseListener(callback) {\n\t\tthis.onResponseCallbacks.push(callback);\n\t}\n\n\tcall() {\n\t\tthis.response = false;\n\t\tthis.called = true;\n\n\t\tif (this.callBids) {\n\t\t\tthis.callBids(this.onResponse);\n\t\t}\n\n\t\tutils.logger(this.logGroup, 'called');\n\t}\n\n\t/**\n\t * Returns bidder slot alias if available, otherwise slot name\n\t *\n\t * @param {string} slotName\n\t *\n\t * @returns {string}\n\t */\n\tgetSlotAlias(slotName) {\n\t\treturn context.get(`slots.${slotName}.bidderAlias`) || slotName;\n\t}\n\n\tgetSlotBestPrice(slotName) {\n\t\tif (this.getBestPrice) {\n\t\t\treturn this.getBestPrice(slotName);\n\t\t}\n\n\t\treturn {};\n\t}\n\n\tgetSlotTargetingParams(slotName) {\n\t\tif (!this.called || !this.isSlotSupported(slotName) || !this.getTargetingParams) {\n\t\t\treturn {};\n\t\t}\n\n\t\treturn this.getTargetingParams(slotName);\n\t}\n\n\thasResponse() {\n\t\treturn this.response;\n\t}\n\n\tisSupported() {\n\t\treturn false;\n\t}\n\n\tisSlotSupported(slotName) {\n\t\treturn this.isSupported(slotName);\n\t}\n\n\tonResponseCall() {\n\t\tthis.response = true;\n\n\t\tif (this.calculatePrices) {\n\t\t\tthis.calculatePrices();\n\t\t}\n\n\t\tthis.onResponseCallbacks.flush();\n\t\tutils.logger(this.logGroup, 'respond');\n\t}\n\n\tresetState() {\n\t\tthis.called = false;\n\t\tthis.response = false;\n\n\t\tthis.onResponseCallbacks = new utils.LazyQueue();\n\t\tthis.onResponseCallbacks.onItemFlush((callback) => {\n\t\t\tcallback(this.name);\n\t\t});\n\t}\n\n\t/**\n\t * Fires the Promise if bidder replied or timeout is reached\n\t *\n\t * @returns {Promise}\n\t */\n\twaitForResponse() {\n\t\treturn utils.createWithTimeout((resolve) => {\n\t\t\tif (this.hasResponse()) {\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\tthis.addResponseListener(resolve);\n\t\t\t}\n\t\t}, this.timeout);\n\t}\n\n\t/**\n\t * Check if bidder was called\n\t *\n\t * @returns {boolean}\n\t */\n\twasCalled() {\n\t\treturn this.called;\n\t}\n}\n","import { context, events, slotService, utils } from '@wikia/ad-engine';\nimport { BaseBidder } from '../base-bidder';\n\n/**\n * @typedef {Object} A9SlotDefinition\n * @property {string} slotID\n * @property {string} slotName\n */\n\nlet loaded = false;\nconst logGroup = 'A9';\n\nexport class A9 extends BaseBidder {\n\tconstructor(bidderConfig, timeout = 2000) {\n\t\tsuper('a9', bidderConfig, timeout);\n\n\t\tthis.isCMPEnabled = context.get('custom.isCMPEnabled');\n\t\tthis.amazonId = this.bidderConfig.amazonId;\n\t\tthis.slots = this.bidderConfig.slots;\n\t\tthis.slotsNames = Object.keys(this.slots);\n\t\tthis.bids = {};\n\t\tthis.priceMap = {};\n\t\tthis.slotNamesMap = {};\n\t\tthis.targetingKeys = [];\n\t\tthis.timeout = timeout;\n\t\tthis.bidsRefreshing = context.get('bidders.a9.bidsRefreshing');\n\t\tthis.isBidsRefreshingEnabled = this.bidsRefreshing && this.bidsRefreshing.enabled;\n\t\tthis.isRenderImpOverwritten = false;\n\t}\n\n\tcalculatePrices() {\n\t\tObject.keys(this.bids).forEach((slotName) => {\n\t\t\tthis.priceMap[slotName] = this.bids[slotName].amznbid;\n\t\t});\n\t}\n\n\tcallBids() {\n\t\tif (window.__cmp) {\n\t\t\twindow.__cmp('getConsentData', null, (consentData) => {\n\t\t\t\tthis.init(consentData);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.init();\n\t\t}\n\t}\n\n\tinit(consentData = {}) {\n\t\tif (!loaded) {\n\t\t\tthis.insertScript();\n\t\t\tthis.configureApstag();\n\n\t\t\tconst apsConfig = {\n\t\t\t\tpubID: this.amazonId,\n\t\t\t\tvideoAdServer: 'DFP',\n\t\t\t\tdeals: !!this.bidderConfig.dealsEnabled,\n\t\t\t};\n\n\t\t\tif (this.isCMPEnabled && consentData && consentData.consentData) {\n\t\t\t\tapsConfig.gdpr = {\n\t\t\t\t\tenabled: consentData.gdprApplies,\n\t\t\t\t\tconsent: consentData.consentData,\n\t\t\t\t\tcmpTimeout: 5000,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\twindow.apstag.init(apsConfig);\n\n\t\t\tloaded = true;\n\t\t}\n\n\t\tthis.bids = {};\n\t\tthis.priceMap = {};\n\n\t\tconst a9Slots = this.getA9SlotsDefinitions(this.slotsNames);\n\n\t\tthis.fetchBids(a9Slots);\n\t}\n\n\t/**\n\t * Fetches bids from A9.\n\t *\n\t * Calls this.onResponse() upon success.\n\t *\n\t * @param {A9SlotDefinition[]} slots\n\t */\n\tfetchBids(slots, refresh = false) {\n\t\tutils.logger(logGroup, 'fetching bids for slots', slots);\n\t\twindow.apstag.fetchBids(\n\t\t\t{\n\t\t\t\tslots,\n\t\t\t\ttimeout: this.timeout,\n\t\t\t},\n\t\t\t(currentBids) => {\n\t\t\t\tutils.logger(logGroup, 'bids fetched for slots', slots, 'bids', currentBids);\n\t\t\t\t// overwrite window.apstag.renderImp on the first fetch\n\t\t\t\tif (!this.isRenderImpOverwritten) {\n\t\t\t\t\tthis.overwriteRenderImp();\n\t\t\t\t\tthis.isRenderImpOverwritten = true;\n\t\t\t\t}\n\t\t\t\tcurrentBids.forEach((bid) => {\n\t\t\t\t\tconst slotName = this.slotNamesMap[bid.slotID] || bid.slotID;\n\n\t\t\t\t\tlet bidTargeting = bid;\n\t\t\t\t\tlet keys = window.apstag.targetingKeys();\n\n\t\t\t\t\tif (this.bidderConfig.dealsEnabled) {\n\t\t\t\t\t\tkeys = bid.helpers.targetingKeys;\n\t\t\t\t\t\tbidTargeting = bid.targeting;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.bids[slotName] = {};\n\t\t\t\t\tkeys.forEach((key) => {\n\t\t\t\t\t\tif (this.targetingKeys.indexOf(key) === -1) {\n\t\t\t\t\t\t\tthis.targetingKeys.push(key);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.bids[slotName][key] = bidTargeting[key];\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tthis.onResponse();\n\t\t\t\tif (refresh) {\n\t\t\t\t\tevents.emit(events.BIDS_REFRESH);\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\tconfigureApstag() {\n\t\twindow.apstag = window.apstag || {};\n\t\twindow.apstag._Q = window.apstag._Q || [];\n\n\t\tif (typeof window.apstag.init === 'undefined') {\n\t\t\twindow.apstag.init = (...args) => {\n\t\t\t\tthis.configureApstagCommand('i', args);\n\t\t\t};\n\t\t}\n\n\t\tif (typeof window.apstag.fetchBids === 'undefined') {\n\t\t\twindow.apstag.fetchBids = (...args) => {\n\t\t\t\tthis.configureApstagCommand('f', args);\n\t\t\t};\n\t\t}\n\t}\n\n\tconfigureApstagCommand(command, args) {\n\t\twindow.apstag._Q.push([command, args]);\n\t}\n\n\tgetBestPrice(slotName) {\n\t\tconst slotAlias = this.getSlotAlias(slotName);\n\n\t\treturn this.priceMap[slotAlias] ? { a9: this.priceMap[slotAlias] } : {};\n\t}\n\n\tgetPrices() {\n\t\treturn this.priceMap;\n\t}\n\n\tgetTargetingKeysToReset() {\n\t\treturn this.targetingKeys;\n\t}\n\n\tgetTargetingParams(slotName) {\n\t\treturn this.bids[this.getSlotAlias(slotName)] || {};\n\t}\n\n\tinsertScript() {\n\t\tutils.scriptLoader.loadScript(\n\t\t\t'//c.amazon-adsystem.com/aax2/apstag.js',\n\t\t\t'text/javascript',\n\t\t\ttrue,\n\t\t\t'first',\n\t\t);\n\t}\n\n\t/**\n\t * Wraps apstag.renderImp\n\t *\n\t * Calls this.refreshBid() if bids refreshing is enabled.\n\t */\n\toverwriteRenderImp() {\n\t\tutils.logger(logGroup, 'overwriting window.apstag.renderImp');\n\t\twindow.apstag.renderImp = ((original) => (doc, impId) => {\n\t\t\toriginal(doc, impId);\n\n\t\t\tconst slot = this.getRenderedSlot(impId);\n\t\t\tconst slotName = slot.getSlotName();\n\n\t\t\tutils.logger(logGroup, `bid used for slot ${slotName}`);\n\t\t\tdelete this.bids[this.getSlotAlias(slotName)];\n\n\t\t\tif (window.apstag.renderImp && this.isBidsRefreshingEnabled) {\n\t\t\t\tthis.refreshBid(slot);\n\t\t\t}\n\t\t})(window.apstag.renderImp);\n\t}\n\n\t/**\n\t * Checks if slot with given name is supported by bidder.\n\t *\n\t * @param {string} slotName\n\t * @returns {boolean}\n\t */\n\tisSupported(slotName) {\n\t\treturn !!this.slots[this.getSlotAlias(slotName)];\n\t}\n\n\t/**\n\t * Checks if slot should be refreshed.\n\t *\n\t * @param {AdSlot} slot\n\t * @returns {boolean}\n\t */\n\tshouldRefreshSlot(slot) {\n\t\treturn this.bidsRefreshing.slots.includes(this.getSlotAlias(slot.getSlotName()));\n\t}\n\n\t/**\n\t * Returns slot which used bid with given impression id.\n\t *\n\t * @param {string | number} impId\n\t * @returns {AdSlot | undefined }\n\t */\n\tgetRenderedSlot(impId) {\n\t\tlet renderedSlot;\n\n\t\tslotService.forEach((slot) => {\n\t\t\tif (slot.getTargeting().amzniid === impId) {\n\t\t\t\trenderedSlot = slot;\n\t\t\t}\n\t\t});\n\n\t\treturn renderedSlot;\n\t}\n\n\t/**\n\t * Refreshes bid for given slot.\n\t *\n\t * @param {string | number} impId\n\t */\n\trefreshBid(slot) {\n\t\tif (!this.shouldRefreshSlot(slot)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst slotDef = this.createSlotDefinition(this.getSlotAlias(slot.getSlotName()));\n\n\t\tif (slotDef) {\n\t\t\tutils.logger(logGroup, 'refresh bids for slot', slotDef);\n\t\t\tthis.fetchBids([slotDef], true);\n\t\t}\n\t}\n\n\t/**\n\t * Transforms slots names into A9 slot definitions.\n\t *\n\t * @param {string[]} slotsNames\n\t * @returns {A9SlotDefinition[]}\n\t */\n\tgetA9SlotsDefinitions(slotsNames) {\n\t\treturn slotsNames\n\t\t\t.map((slotName) => this.getSlotAlias(slotName))\n\t\t\t.map((slotAlias) => this.createSlotDefinition(slotAlias))\n\t\t\t.filter((slot) => slot !== null);\n\t}\n\n\t/**\n\t * Creates A9 slot definition from slot name.\n\t *\n\t * @param {string} slotName\n\t * @returns {A9SlotDefinition | null} Returns null i\n\t */\n\tcreateSlotDefinition(slotName) {\n\t\tconst config = this.slots[slotName];\n\t\tconst slotID = config.slotId || slotName;\n\t\tconst definition = {\n\t\t\tslotID,\n\t\t\tslotName: slotID,\n\t\t};\n\n\t\tif (!slotService.getState(slotID)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.slotNamesMap[slotID] = slotName;\n\n\t\tif (!this.bidderConfig.videoEnabled && config.type === 'video') {\n\t\t\treturn null;\n\t\t}\n\t\tif (config.type === 'video') {\n\t\t\tdefinition.mediaType = 'video';\n\t\t} else {\n\t\t\tdefinition.sizes = config.sizes;\n\t\t}\n\n\t\treturn definition;\n\t}\n}\n","export class BaseAdapter {\n\tconstructor({ enabled, slots }) {\n\t\tthis.enabled = enabled;\n\t\tthis.slots = slots;\n\t}\n\n\tprepareAdUnits() {\n\t\treturn Object.keys(this.slots).map((slotName) =>\n\t\t\tthis.prepareConfigForAdUnit(slotName, this.slots[slotName]),\n\t\t);\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Aol extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'aol';\n\t\tthis.network = options.network;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, placement, alias, sizeId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacement,\n\t\t\t\t\t\tnetwork: this.network,\n\t\t\t\t\t\talias,\n\t\t\t\t\t\tsizeId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { context } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class Appnexus extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'appnexus';\n\t\tthis.placements = options.placements;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, position = 'mobile' }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacementId: this.getPlacement(position),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tgetPlacement(position) {\n\t\tif (position === 'mobile') {\n\t\t\tconst vertical = context.get('targeting.mappedVerticalName');\n\n\t\t\tposition = vertical && this.placements[vertical] ? vertical : 'other';\n\t\t}\n\n\t\treturn this.placements[position];\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class AppnexusAst extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'appnexusAst';\n\t\tthis.aliases = {\n\t\t\tappnexus: [this.bidderName],\n\t\t};\n\t\tthis.debugPlacementId = options.debugPlacementId;\n\t\tthis.isDebugMode = utils.queryString.get('appnexusast_debug_mode') === '1';\n\t}\n\n\tprepareConfigForAdUnit(code, { placementId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tcontext: 'instream',\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacementId: this.isDebugMode ? this.debugPlacementId : placementId,\n\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\tskippable: false,\n\t\t\t\t\t\t\tplayback_method: ['auto_play_sound_off'],\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class AudienceNetwork extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'audienceNetwork';\n\t\tthis.testMode = utils.queryString.get('audiencenetworktest') === 'true';\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, placementId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\ttestMode: this.testMode,\n\t\t\t\t\t\tplacementId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class Beachfront extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'beachfront';\n\t\tthis.bidfloor = 0.01;\n\t\tthis.debugAppId = options.debugAppId;\n\t\tthis.isDebugMode = utils.queryString.get('beachfront_debug_mode') === '1';\n\t}\n\n\tprepareConfigForAdUnit(code, { appId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tcontext: 'instream',\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tbidfloor: this.bidfloor,\n\t\t\t\t\t\tappId: this.isDebugMode ? this.debugAppId : appId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class IndexExchange extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'indexExchange';\n\t\tthis.aliases = {\n\t\t\tix: [this.bidderName],\n\t\t};\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, siteId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: sizes.map((size) => ({\n\t\t\t\tbidder: this.bidderName,\n\t\t\t\tparams: {\n\t\t\t\t\tsiteId,\n\t\t\t\t\tsize,\n\t\t\t\t},\n\t\t\t})),\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Kargo extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'kargo';\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, placementId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tsizes,\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacementId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Lkqd extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'lkqd';\n\t}\n\n\tprepareConfigForAdUnit(code, { placementId, siteId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tsiteId,\n\t\t\t\t\t\tplacementId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Onemobile extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'onemobile';\n\t\tthis.siteId = options.siteId;\n\t}\n\n\tprepareConfigForAdUnit(code, { size, pos }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes: [size],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tdcn: this.siteId,\n\t\t\t\t\t\tpos,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Openx extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'openx';\n\t\tthis.delDomain = options.delDomain;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, unit }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tunit,\n\t\t\t\t\t\tdelDomain: this.delDomain,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Pubmatic extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'pubmatic';\n\t\tthis.publisherId = options.publisherId;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, ids }) {\n\t\tswitch (code.toLowerCase()) {\n\t\t\tcase 'featured':\n\t\t\tcase 'incontent_player':\n\t\t\t\treturn this.getVideoConfig(code, ids);\n\t\t\tdefault:\n\t\t\t\treturn this.getStandardConfig(code, sizes, ids);\n\t\t}\n\t}\n\n\tgetVideoConfig(code, ids) {\n\t\tconst videoParams = {\n\t\t\tvideo: {\n\t\t\t\tmimes: ['video/mp4', 'video/x-flv', 'video/webm', 'video/ogg'],\n\t\t\t\tskippable: true,\n\t\t\t\tminduration: 1,\n\t\t\t\tmaxduration: 30,\n\t\t\t\tstartdelay: 0,\n\t\t\t\tplaybackmethod: [2, 3],\n\t\t\t\tprotocols: [2, 3, 5, 6],\n\t\t\t\tlinearity: 1,\n\t\t\t\tplacement: 1,\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t\tcontext: 'instream',\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: this.getBids(ids, videoParams),\n\t\t};\n\t}\n\n\tgetStandardConfig(code, sizes, ids) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: this.getBids(ids),\n\t\t};\n\t}\n\n\tgetBids(ids, params = {}) {\n\t\treturn ids.map((adSlot) => ({\n\t\t\tbidder: this.bidderName,\n\t\t\tparams: {\n\t\t\t\tadSlot,\n\t\t\t\tpublisherId: this.publisherId,\n\t\t\t\t...params,\n\t\t\t},\n\t\t}));\n\t}\n}\n","import { context, slotService } from '@wikia/ad-engine';\nimport { getAdapters } from './adapters-registry';\n\nconst lazyLoadSlots = ['bottom_leaderboard'];\n\nfunction isSlotApplicable(code, lazyLoad) {\n\tconst isSlotLazy = lazyLoadSlots.indexOf(code) !== -1;\n\n\tif (!slotService.getState(code)) {\n\t\treturn false;\n\t}\n\n\tif (\n\t\tlazyLoad !== 'off' &&\n\t\t((lazyLoad === 'pre' && isSlotLazy) || (lazyLoad === 'post' && !isSlotLazy))\n\t) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nexport function setupAdUnits(adaptersConfig, lazyLoad = 'off') {\n\tconst adUnits = [];\n\tconst adapters = getAdapters(adaptersConfig);\n\n\tadapters.forEach((adapter) => {\n\t\tif (adapter && adapter.enabled) {\n\t\t\tconst adapterAdUnits = adapter.prepareAdUnits();\n\n\t\t\tadapterAdUnits.forEach((adUnit) => {\n\t\t\t\tif (adUnit && isSlotApplicable(adUnit.code, lazyLoad)) {\n\t\t\t\t\tadUnits.push(adUnit);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\treturn adUnits;\n}\n\nexport function getBidByAdId(adId) {\n\tif (!window.pbjs || typeof window.pbjs.getBidResponses !== 'function') {\n\t\treturn null;\n\t}\n\n\tlet bids = window.pbjs.getAllPrebidWinningBids().filter((bid) => adId === bid.adId);\n\n\tif (!bids.length) {\n\t\tconst responses = window.pbjs.getBidResponses();\n\n\t\tObject.keys(responses).forEach((adUnit) => {\n\t\t\tconst adUnitsBids = responses[adUnit].bids.filter((bid) => adId === bid.adId);\n\n\t\t\tbids = bids.concat(adUnitsBids);\n\t\t});\n\t}\n\n\treturn bids.length ? bids[0] : null;\n}\n\nexport function getAvailableBidsByAdUnitCode(adUnitCode) {\n\tlet bids = [];\n\n\tif (window.pbjs && typeof window.pbjs.getBidResponsesForAdUnitCode === 'function') {\n\t\tbids = window.pbjs.getBidResponsesForAdUnitCode(adUnitCode).bids || [];\n\t\tbids = bids.filter((bid) => bid.status !== 'rendered');\n\t}\n\n\treturn bids;\n}\n\nexport function getPrebid() {\n\treturn window.pbjs;\n}\n\nexport function getTargeting(slotName) {\n\treturn Object.assign(\n\t\t{\n\t\t\tpos: [slotName],\n\t\t},\n\t\tcontext.get('bidders.prebid.targeting') || {},\n\t);\n}\n\nexport function getWinningVideoBidBySlotName(slotName, allowedBidders) {\n\tif (!window.pbjs || !window.pbjs.getBidResponsesForAdUnitCode) {\n\t\treturn null;\n\t}\n\n\tconst bids = window.pbjs.getBidResponsesForAdUnitCode(slotName).bids || [];\n\n\treturn bids\n\t\t.filter((bid) => {\n\t\t\tconst canUseThisBidder = !allowedBidders || allowedBidders.indexOf(bid.bidderCode) !== -1;\n\t\t\tconst hasVast = bid.vastUrl || bid.vastContent;\n\n\t\t\treturn canUseThisBidder && hasVast && bid.cpm > 0;\n\t\t})\n\t\t.reduce((previousBid, currentBid) => {\n\t\t\tif (previousBid === null || currentBid.cpm > previousBid.cpm) {\n\t\t\t\treturn currentBid;\n\t\t\t}\n\n\t\t\treturn previousBid;\n\t\t}, null);\n}\n\nexport function pushPrebid(callback) {\n\twindow.pbjs.que.push(callback);\n}\n","import { context } from '@wikia/ad-engine';\nimport { getTargeting } from '../prebid-helper';\nimport { BaseAdapter } from './base-adapter';\n\nexport class Rubicon extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'rubicon';\n\t\tthis.accountId = options.accountId;\n\t}\n\n\tprepareConfigForAdUnit(code, { siteId, zoneId, sizeId, position }) {\n\t\tif (code === 'featured' && !context.get('custom.rubiconInFV')) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst targeting = getTargeting(code);\n\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaType: 'video',\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t\tcontext: 'instream',\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\taccountId: this.accountId,\n\t\t\t\t\t\tsiteId,\n\t\t\t\t\t\tzoneId,\n\t\t\t\t\t\tname: code,\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\tinventory: targeting,\n\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\tplayerWidth: '640',\n\t\t\t\t\t\t\tplayerHeight: '480',\n\t\t\t\t\t\t\tsize_id: sizeId,\n\t\t\t\t\t\t\tlanguage: targeting.lang ? targeting.lang[0] : 'en',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { getTargeting } from '../prebid-helper';\nimport { BaseAdapter } from './base-adapter';\n\nexport class RubiconDisplay extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'rubicon_display';\n\t\tthis.aliases = {\n\t\t\trubicon: [this.bidderName],\n\t\t};\n\t\tthis.accountId = options.accountId;\n\t}\n\n\tprepareConfigForAdUnit(code, { siteId, zoneId, sizes, position, targeting }) {\n\t\tconst pageTargeting = getTargeting(code);\n\n\t\tObject.keys(targeting || {}).forEach((key) => {\n\t\t\tpageTargeting[key] = targeting[key];\n\t\t});\n\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\taccountId: this.accountId,\n\t\t\t\t\t\tsiteId,\n\t\t\t\t\t\tzoneId,\n\t\t\t\t\t\tname: code,\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\tkeywords: ['rp.fastlane'],\n\t\t\t\t\t\tinventory: pageTargeting,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nconst price = utils.queryString.get('wikia_adapter');\nconst limit = parseInt(utils.queryString.get('wikia_adapter_limit'), 10) || 99;\nconst timeout = parseInt(utils.queryString.get('wikia_adapter_timeout'), 10) || 0;\nconst useRandomPrice = utils.queryString.get('wikia_adapter_random') === '1';\n\nexport class Wikia extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'wikia';\n\t\tthis.enabled = !!price;\n\t\tthis.limit = limit;\n\t\tthis.useRandomPrice = useRandomPrice;\n\t\tthis.timeout = timeout;\n\n\t\tthis.create = () => this;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tgetSpec() {\n\t\treturn {\n\t\t\tcode: this.bidderName,\n\t\t\tsupportedMediaTypes: ['banner'],\n\t\t};\n\t}\n\n\tgetPrice() {\n\t\tif (this.useRandomPrice) {\n\t\t\treturn Math.floor(Math.random() * 2000) / 100;\n\t\t}\n\n\t\treturn parseInt(price, 10) / 100;\n\t}\n\n\tcallBids(bidRequest, addBidResponse, done) {\n\t\twindow.pbjs.que.push(() => {\n\t\t\tthis.addBids(bidRequest, addBidResponse, done);\n\t\t});\n\t}\n\n\taddBids(bidRequest, addBidResponse, done) {\n\t\tsetTimeout(() => {\n\t\t\tbidRequest.bids.forEach((bid) => {\n\t\t\t\tif (this.limit === 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst bidResponse = window.pbjs.createBid(1);\n\t\t\t\tconst [width, height] = bid.sizes[0];\n\t\t\t\tconst cpm = this.getPrice();\n\n\t\t\t\tbidResponse.ad = this.getCreative(bid.sizes[0], cpm);\n\t\t\t\tbidResponse.bidderCode = bidRequest.bidderCode;\n\t\t\t\tbidResponse.cpm = cpm;\n\t\t\t\tbidResponse.ttl = 300;\n\t\t\t\tbidResponse.mediaType = 'banner';\n\t\t\t\tbidResponse.width = width;\n\t\t\t\tbidResponse.height = height;\n\n\t\t\t\taddBidResponse(bid.adUnitCode, bidResponse);\n\t\t\t\tthis.limit -= 1;\n\t\t\t});\n\t\t\tdone();\n\t\t}, this.timeout);\n\t}\n\n\tgetCreative(size, cpm) {\n\t\tconst creative = document.createElement('div');\n\n\t\tcreative.style.background = '#00b7e0';\n\t\tcreative.style.color = '#fff';\n\t\tcreative.style.fontFamily = 'sans-serif';\n\t\tcreative.style.height = '100%';\n\t\tcreative.style.textAlign = 'center';\n\t\tcreative.style.width = '100%';\n\n\t\tconst title = document.createElement('p');\n\n\t\ttitle.innerText = 'Wikia Creative';\n\t\ttitle.style.fontWeight = 'bold';\n\t\ttitle.style.margin = '0';\n\t\ttitle.style.paddingTop = '10px';\n\n\t\tconst details = document.createElement('small');\n\n\t\tdetails.innerText = `cpm: ${cpm}, size: ${size.join('x')}`;\n\n\t\tcreative.appendChild(title);\n\t\tcreative.appendChild(details);\n\n\t\treturn creative.outerHTML;\n\t}\n}\n","import { buildVastUrl, context, utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nconst price = utils.queryString.get('wikia_video_adapter');\nconst limit = parseInt(utils.queryString.get('wikia_adapter_limit'), 10) || 99;\nconst timeout = parseInt(utils.queryString.get('wikia_adapter_timeout'), 10) || 0;\nconst useRandomPrice = utils.queryString.get('wikia_adapter_random') === '1';\n\nexport class WikiaVideo extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'wikiaVideo';\n\t\tthis.enabled = !!price;\n\t\tthis.limit = limit;\n\t\tthis.useRandomPrice = useRandomPrice;\n\t\tthis.timeout = timeout;\n\n\t\tthis.create = () => this;\n\t}\n\n\tprepareConfigForAdUnit(code) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tcontext: 'outstream',\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tgetSpec() {\n\t\treturn {\n\t\t\tcode: this.bidderName,\n\t\t\tsupportedMediaTypes: ['video'],\n\t\t};\n\t}\n\n\tgetPrice() {\n\t\tif (this.useRandomPrice) {\n\t\t\treturn Math.floor(Math.random() * 20);\n\t\t}\n\n\t\treturn parseInt(price, 10) / 100;\n\t}\n\n\tgetVastUrl(width, height, slotName) {\n\t\treturn buildVastUrl(width / height, slotName, {\n\t\t\tvideoAdUnitId: context.get(`bidders.prebid.wikiaVideo.slots.${slotName}.videoAdUnitId`),\n\t\t\tcustomParams: context.get(`bidders.prebid.wikiaVideo.slots.${slotName}.customParams`),\n\t\t});\n\t}\n\n\tcallBids(bidRequest, addBidResponse, done) {\n\t\twindow.pbjs.que.push(() => {\n\t\t\tthis.addBids(bidRequest, addBidResponse, done);\n\t\t});\n\t}\n\n\taddBids(bidRequest, addBidResponse, done) {\n\t\tsetTimeout(() => {\n\t\t\tbidRequest.bids.forEach((bid) => {\n\t\t\t\tif (this.limit === 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst bidResponse = window.pbjs.createBid(1);\n\t\t\t\tconst [width, height] = bid.sizes[0];\n\t\t\t\tconst slotName = bid.adUnitCode;\n\n\t\t\t\tbidResponse.bidderCode = bidRequest.bidderCode;\n\t\t\t\tbidResponse.cpm = this.getPrice();\n\t\t\t\tbidResponse.creativeId = 'foo123_wikiaVideoCreativeId';\n\t\t\t\tbidResponse.ttl = 300;\n\t\t\t\tbidResponse.mediaType = 'video';\n\t\t\t\tbidResponse.width = width;\n\t\t\t\tbidResponse.height = height;\n\t\t\t\tbidResponse.vastUrl = this.getVastUrl(width, height, slotName);\n\t\t\t\tbidResponse.videoCacheKey = '123foo_wikiaVideoCacheKey';\n\n\t\t\t\taddBidResponse(bid.adUnitCode, bidResponse);\n\t\t\t\tthis.limit -= 1;\n\t\t\t});\n\n\t\t\tdone();\n\t\t}, this.timeout);\n\t}\n}\n","import { Aol } from './adapters/aol';\nimport { Appnexus } from './adapters/appnexus';\nimport { AppnexusAst } from './adapters/appnexus-ast';\nimport { AudienceNetwork } from './adapters/audience-network';\nimport { Beachfront } from './adapters/beachfront';\nimport { IndexExchange } from './adapters/index-exchange';\nimport { Kargo } from './adapters/kargo';\nimport { Lkqd } from './adapters/lkqd';\nimport { Onemobile } from './adapters/onemobile';\nimport { Openx } from './adapters/openx';\nimport { Pubmatic } from './adapters/pubmatic';\nimport { Rubicon } from './adapters/rubicon';\nimport { RubiconDisplay } from './adapters/rubicon-display';\nimport { Wikia } from './adapters/wikia';\nimport { WikiaVideo } from './adapters/wikia-video';\n\nconst adapters = [];\nconst customAdapters = [];\nconst availableAdapters = {\n\taol: Aol,\n\tappnexus: Appnexus,\n\tappnexusAst: AppnexusAst,\n\taudienceNetwork: AudienceNetwork,\n\tbeachfront: Beachfront,\n\tindexExchange: IndexExchange,\n\tkargo: Kargo,\n\tlkqd: Lkqd,\n\tonemobile: Onemobile,\n\topenx: Openx,\n\tpubmatic: Pubmatic,\n\trubicon: Rubicon,\n\trubiconDisplay: RubiconDisplay,\n};\n\nfunction registerAliases() {\n\tadapters\n\t\t.filter((adapter) => adapter.aliases)\n\t\t.forEach((adapter) => {\n\t\t\twindow.pbjs.que.push(() => {\n\t\t\t\tconst aliasMap = adapter.aliases;\n\n\t\t\t\tObject.keys(aliasMap).forEach((bidderName) => {\n\t\t\t\t\taliasMap[bidderName].forEach((alias) => {\n\t\t\t\t\t\twindow.pbjs.aliasBidder(bidderName, alias);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n}\n\nfunction setupAdapters(bidders) {\n\tObject.keys(availableAdapters).forEach((key) => {\n\t\tif (bidders[key]) {\n\t\t\tconst adapter = new availableAdapters[key](bidders[key]);\n\n\t\t\tadapters.push(adapter);\n\t\t}\n\t});\n\n\tsetupCustomAdapters(bidders);\n}\n\nfunction setupCustomAdapters(bidders) {\n\tif (bidders.wikia) {\n\t\tcustomAdapters.push(new Wikia(bidders.wikia));\n\t}\n\n\tif (bidders.wikiaVideo) {\n\t\tcustomAdapters.push(new WikiaVideo(bidders.wikiaVideo));\n\t}\n\n\tcustomAdapters.forEach((adapter) => {\n\t\tadapters.push(adapter);\n\n\t\twindow.pbjs.que.push(() => {\n\t\t\twindow.pbjs.registerBidAdapter(adapter.create, adapter.bidderName);\n\t\t});\n\t});\n}\n\nexport function getPriorities() {\n\tconst priorities = {};\n\n\tadapters.forEach((adapter) => {\n\t\tpriorities[adapter.bidderName] = adapter.priority || 1;\n\t});\n\n\treturn priorities;\n}\n\nexport function getAdapters(config) {\n\tif (adapters.length === 0 && config) {\n\t\tsetupAdapters(config);\n\t\tregisterAliases();\n\t}\n\n\treturn adapters;\n}\n","import { getAdapters } from './adapters-registry';\nimport { Prebid } from './index';\n\nconst DEFAULT_MAX_CPM = 20;\nconst videoBiddersCap50 = ['appnexusAst', 'rubicon', 'wikiaVideo']; // bidders with $50 cap\n\nfunction isValidPrice(bid) {\n\treturn bid.getStatusCode && bid.getStatusCode() === Prebid.validResponseStatusCode;\n}\n\n/**\n * Round cpm to predefined values.\n *\n * @param {number} cpm\n * @param {number} maxCpm\n * @returns {number}\n */\nfunction roundCpm(cpm, maxCpm) {\n\tlet result = Math.floor(maxCpm);\n\n\tif (cpm === 0) {\n\t\tresult = 0.0;\n\t} else if (cpm < 0.05) {\n\t\tresult = 0.01;\n\t} else if (cpm < 5.0) {\n\t\tresult = Math.floor(cpm * 20) / 20;\n\t} else if (cpm < 10.0) {\n\t\tresult = Math.floor(cpm * 10) / 10;\n\t} else if (cpm < 20.0) {\n\t\tresult = Math.floor(cpm * 2) / 2;\n\t} else if (cpm < maxCpm) {\n\t\tresult = Math.floor(cpm);\n\t}\n\n\treturn result;\n}\n\n/**\n * Round cpm to predefined values and transform to String with 2 decimal places.\n *\n * @param {number} cpm\n * @param {number} maxCpm\n * @returns {string}\n */\nexport function transformPriceFromCpm(cpm, maxCpm = DEFAULT_MAX_CPM) {\n\tmaxCpm = Math.max(maxCpm, DEFAULT_MAX_CPM);\n\n\treturn roundCpm(cpm, maxCpm).toFixed(2);\n}\n\n/**\n *\n * @param {string} slotName\n * @return {object}\n */\nexport function getPrebidBestPrice(slotName) {\n\tconst bestPrices = {};\n\n\tif (window.pbjs && window.pbjs.getBidResponsesForAdUnitCode) {\n\t\tconst slotBids = window.pbjs.getBidResponsesForAdUnitCode(slotName).bids || [];\n\n\t\tgetAdapters().forEach((adapter) => {\n\t\t\tbestPrices[adapter.bidderName] = '';\n\t\t});\n\n\t\tslotBids.forEach((bid) => {\n\t\t\tif (isValidPrice(bid) && bid.status !== 'rendered') {\n\t\t\t\tconst { bidderCode, cpm } = bid;\n\t\t\t\tconst cmpPrice = Math.max(bestPrices[bidderCode] || 0, roundCpm(cpm, DEFAULT_MAX_CPM));\n\n\t\t\t\tif (cmpPrice > 0) {\n\t\t\t\t\tbestPrices[bidderCode] = cmpPrice.toFixed(2);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\treturn bestPrices;\n}\n\nexport function transformPriceFromBid(bid) {\n\tlet maxCpm = DEFAULT_MAX_CPM;\n\n\tif (videoBiddersCap50.includes(bid.bidderCode)) {\n\t\tmaxCpm = 50;\n\t}\n\n\treturn transformPriceFromCpm(bid.cpm, maxCpm);\n}\n","import { context } from '@wikia/ad-engine';\nimport { transformPriceFromBid } from './price-helper';\n\nconst dfpVideoBidders = [\n\t{ bidderCode: 'appnexusAst', contextKey: 'custom.appnexusDfp' },\n\t{ bidderCode: 'beachfront', contextKey: 'custom.beachfrontDfp' },\n\t{ bidderCode: 'lkqd', contextKey: 'custom.lkqdDfp' },\n\t{ bidderCode: 'rubicon', contextKey: 'custom.rubiconDfp' },\n\t{ bidderCode: 'pubmatic', contextKey: 'custom.pubmaticDfp' },\n];\n\nexport function getSettings() {\n\treturn {\n\t\tstandard: {\n\t\t\talwaysUseBid: false,\n\t\t\tadserverTargeting: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_bidder',\n\t\t\t\t\tval: ({ bidderCode }) => bidderCode,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_adid',\n\t\t\t\t\tval: ({ adId }) => adId,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_pb',\n\t\t\t\t\tval: (bidResponse) => transformPriceFromBid(bidResponse),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_size',\n\t\t\t\t\tval: ({ size }) => size,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_uuid',\n\t\t\t\t\tval: (bidResponse) => getBidderUuid(bidResponse),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t};\n}\n\nfunction getBidderUuid(bidResponse) {\n\tconst isVideo = dfpVideoBidders.some(\n\t\t(video) => bidResponse.bidderCode === video.bidderCode && context.get(video.contextKey),\n\t);\n\n\treturn isVideo ? bidResponse.videoCacheKey : 'disabled';\n}\n","import { decorate } from 'core-decorators';\nimport { context, events, utils } from '@wikia/ad-engine';\nimport { BaseBidder } from '../base-bidder';\nimport { getPriorities } from './adapters-registry';\nimport { getPrebidBestPrice } from './price-helper';\nimport { getSettings } from './prebid-settings';\nimport { getAvailableBidsByAdUnitCode, setupAdUnits } from './prebid-helper';\n\nfunction postponeExecutionUntilPbjsLoads(method) {\n\treturn function (...args) {\n\t\treturn window.pbjs.que.push(() => method.apply(this, args));\n\t};\n}\n\nconst logGroup = 'prebid';\n\nlet loaded = false;\n\nwindow.pbjs = window.pbjs || {};\nwindow.pbjs.que = window.pbjs.que || [];\n\nevents.registerEvent('BIDS_REFRESH');\nevents.registerEvent('PREBID_LAZY_CALL');\n\nexport class Prebid extends BaseBidder {\n\tstatic validResponseStatusCode = 1;\n\tstatic errorResponseStatusCode = 2;\n\n\tconstructor(bidderConfig, timeout = 2000) {\n\t\tsuper('prebid', bidderConfig, timeout);\n\n\t\tthis.insertScript();\n\n\t\tthis.lazyLoaded = false;\n\t\tthis.isLazyLoadingEnabled = this.bidderConfig.lazyLoadingEnabled;\n\t\tthis.isCMPEnabled = context.get('custom.isCMPEnabled');\n\t\tthis.adUnits = setupAdUnits(this.bidderConfig, this.isLazyLoadingEnabled ? 'pre' : 'off');\n\t\tthis.prebidConfig = {\n\t\t\tdebug:\n\t\t\t\tutils.queryString.get('pbjs_debug') === '1' ||\n\t\t\t\tutils.queryString.get('pbjs_debug') === 'true',\n\t\t\tenableSendAllBids: true,\n\t\t\tbidderSequence: 'random',\n\t\t\tbidderTimeout: this.timeout,\n\t\t\tcache: {\n\t\t\t\turl: 'https://prebid.adnxs.com/pbc/v1/cache',\n\t\t\t},\n\t\t\tuserSync: {\n\t\t\t\tiframeEnabled: true,\n\t\t\t\tenabledBidders: [],\n\t\t\t\tsyncDelay: 6000,\n\t\t\t},\n\t\t};\n\t\tthis.bidsRefreshing = context.get('bidders.prebid.bidsRefreshing');\n\n\t\tif (this.isCMPEnabled) {\n\t\t\tthis.prebidConfig.consentManagement = {\n\t\t\t\tcmpApi: 'iab',\n\t\t\t\ttimeout: this.timeout,\n\t\t\t\tallowAuctionWithoutConsent: false,\n\t\t\t};\n\t\t}\n\n\t\twindow.pbjs = window.pbjs || {};\n\t\twindow.pbjs.que = window.pbjs.que || [];\n\n\t\tthis.applyConfig(this.prebidConfig);\n\n\t\tif (this.bidsRefreshing && this.bidsRefreshing.enabled) {\n\t\t\tthis.registerBidsRefreshing();\n\t\t}\n\t}\n\n\t@decorate(postponeExecutionUntilPbjsLoads)\n\tapplyConfig(config) {\n\t\twindow.pbjs.setConfig(config);\n\t}\n\n\t@decorate(postponeExecutionUntilPbjsLoads)\n\tapplySettings() {\n\t\twindow.pbjs.bidderSettings = getSettings();\n\t}\n\n\tcallBids(bidsBackHandler) {\n\t\tif (!this.adUnits) {\n\t\t\tthis.adUnits = setupAdUnits(this.bidderConfig, this.isLazyLoadingEnabled ? 'pre' : 'off');\n\t\t}\n\n\t\tif (this.adUnits.length > 0) {\n\t\t\tthis.applySettings();\n\t\t\tthis.requestBids(this.adUnits, bidsBackHandler, this.removeAdUnits);\n\t\t}\n\n\t\tif (this.isLazyLoadingEnabled) {\n\t\t\tevents.on(events.PREBID_LAZY_CALL, () => {\n\t\t\t\tthis.lazyCall(bidsBackHandler);\n\t\t\t});\n\t\t}\n\t}\n\n\tinsertScript() {\n\t\tif (loaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst libraryUrl = context.get('bidders.prebid.libraryUrl');\n\n\t\tif (!libraryUrl) {\n\t\t\tutils.logger(\n\t\t\t\tlogGroup,\n\t\t\t\t'Prebid library URL not defined. Assuming that window.pbjs will be loaded.',\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\n\t\tutils.scriptLoader.loadScript(libraryUrl, 'text/javascript', true, 'first');\n\t\tloaded = true;\n\t}\n\n\tlazyCall(bidsBackHandler) {\n\t\tif (this.lazyLoaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.lazyLoaded = true;\n\n\t\tconst adUnitsLazy = setupAdUnits(this.bidderConfig, 'post');\n\n\t\tif (adUnitsLazy.length > 0) {\n\t\t\tthis.requestBids(adUnitsLazy, bidsBackHandler);\n\n\t\t\tthis.adUnits = this.adUnits.concat(adUnitsLazy);\n\t\t}\n\t}\n\n\tremoveAdUnits() {\n\t\t(window.pbjs.adUnits || []).forEach((adUnit) => {\n\t\t\twindow.pbjs.removeAdUnit(adUnit.code);\n\t\t});\n\t}\n\n\tgetBestPrice(slotName) {\n\t\tconst slotAlias = this.getSlotAlias(slotName);\n\n\t\treturn getPrebidBestPrice(slotAlias);\n\t}\n\n\tgetTargetingKeysToReset() {\n\t\treturn ['hb_bidder', 'hb_adid', 'hb_pb', 'hb_size', 'hb_uuid'];\n\t}\n\n\tgetTargetingParams(slotName) {\n\t\tlet slotParams = {};\n\n\t\tconst slotAlias = this.getSlotAlias(slotName);\n\t\tconst bids = getAvailableBidsByAdUnitCode(slotAlias);\n\n\t\tif (bids.length) {\n\t\t\tlet bidParams = null;\n\t\t\tconst priorities = getPriorities();\n\n\t\t\tbids.forEach((param) => {\n\t\t\t\tif (!bidParams) {\n\t\t\t\t\tbidParams = param;\n\t\t\t\t} else if (bidParams.cpm === param.cpm) {\n\t\t\t\t\tif (priorities[bidParams.bidder] === priorities[param.bidder]) {\n\t\t\t\t\t\tbidParams = bidParams.timeToRespond > param.timeToRespond ? param : bidParams;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbidParams = priorities[bidParams.bidder] < priorities[param.bidder] ? param : bidParams;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tbidParams = bidParams.cpm < param.cpm ? param : bidParams;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (bidParams) {\n\t\t\t\tslotParams = bidParams.adserverTargeting;\n\t\t\t}\n\n\t\t\t// ADEN-7436: AppNexus hb_uuid fix\n\t\t\t// (adserverTargeting params are being set before cache key is returned)\n\t\t\tslotParams.hb_uuid = slotParams.hb_uuid || bidParams.videoCacheKey || 'disabled';\n\t\t}\n\n\t\treturn slotParams || {};\n\t}\n\n\tisSupported(slotName) {\n\t\tconst slotAlias = this.getSlotAlias(slotName);\n\n\t\treturn this.adUnits && this.adUnits.some((adUnit) => adUnit.code === slotAlias);\n\t}\n\n\tregisterBidsRefreshing() {\n\t\twindow.pbjs.que.push(() => {\n\t\t\tconst refreshUsedBid = (winningBid) => {\n\t\t\t\tif (this.bidsRefreshing.slots.indexOf(winningBid.adUnitCode) !== -1) {\n\t\t\t\t\tevents.emit(events.BIDS_REFRESH);\n\t\t\t\t\tconst adUnitsToRefresh = this.adUnits.filter(\n\t\t\t\t\t\t(adUnit) =>\n\t\t\t\t\t\t\tadUnit.code === winningBid.adUnitCode &&\n\t\t\t\t\t\t\tadUnit.bids &&\n\t\t\t\t\t\t\tadUnit.bids[0] &&\n\t\t\t\t\t\t\tadUnit.bids[0].bidder === winningBid.bidderCode,\n\t\t\t\t\t);\n\n\t\t\t\t\tthis.requestBids(adUnitsToRefresh, this.bidsRefreshing.bidsBackHandler);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\twindow.pbjs.onEvent('bidWon', refreshUsedBid);\n\t\t\tevents.once(events.PAGE_CHANGE_EVENT, () => {\n\t\t\t\twindow.pbjs.offEvent('bidWon', refreshUsedBid);\n\t\t\t});\n\t\t});\n\t}\n\n\t@decorate(postponeExecutionUntilPbjsLoads)\n\trequestBids(adUnits, bidsBackHandler, withRemove = undefined) {\n\t\tif (withRemove) {\n\t\t\twithRemove();\n\t\t}\n\n\t\twindow.pbjs.requestBids({\n\t\t\tadUnits,\n\t\t\tbidsBackHandler,\n\t\t});\n\t}\n}\n","import { context, events, utils } from '@wikia/ad-engine';\nimport { A9 } from './a9';\nimport { Prebid } from './prebid';\nimport * as prebidHelper from './prebid/prebid-helper';\nimport { transformPriceFromBid } from './prebid/price-helper';\n\nconst biddersRegistry = {};\nconst realSlotPrices = {};\nconst logGroup = 'bidders';\n\nevents.on(events.VIDEO_AD_REQUESTED, (adSlot) => {\n\tresetTargetingKeys(adSlot.getSlotName());\n});\n\nfunction applyTargetingParams(slotName, targeting) {\n\tObject.keys(targeting).forEach((key) =>\n\t\tcontext.set(`slots.${slotName}.targeting.${key}`, targeting[key]),\n\t);\n}\n\n/**\n * Executes callback function on each enabled bidder\n *\n * @param {function} callback\n */\nfunction forEachBidder(callback) {\n\tObject.keys(biddersRegistry).forEach((bidderName) => {\n\t\tcallback(biddersRegistry[bidderName]);\n\t});\n}\n\nfunction getBidParameters(slotName) {\n\tconst slotParams = {};\n\n\tforEachBidder((bidder) => {\n\t\tif (bidder && bidder.wasCalled()) {\n\t\t\tconst params = bidder.getSlotTargetingParams(slotName);\n\n\t\t\tObject.assign(slotParams, params);\n\t\t}\n\t});\n\n\treturn slotParams;\n}\n\nfunction getCurrentSlotPrices(slotName) {\n\tconst slotPrices = {};\n\n\tforEachBidder((bidder) => {\n\t\tif (bidder && bidder.isSlotSupported(slotName)) {\n\t\t\tconst priceFromBidder = bidder.getSlotBestPrice(slotName);\n\n\t\t\tObject.keys(priceFromBidder).forEach((bidderName) => {\n\t\t\t\tslotPrices[bidderName] = priceFromBidder[bidderName];\n\t\t\t});\n\t\t}\n\t});\n\n\treturn slotPrices;\n}\n\nfunction getDfpSlotPrices(slotName) {\n\treturn realSlotPrices[slotName] || {};\n}\n\n/**\n * Returns true if all bidders replied\n *\n * @returns {boolean}\n */\nfunction hasAllResponses() {\n\tconst missingBidders = Object.keys(biddersRegistry).filter((bidderName) => {\n\t\tconst bidder = biddersRegistry[bidderName];\n\n\t\treturn !bidder.hasResponse();\n\t});\n\n\treturn missingBidders.length === 0;\n}\n\nfunction resetTargetingKeys(slotName) {\n\tforEachBidder((bidder) => {\n\t\tbidder.getTargetingKeysToReset().forEach((key) => {\n\t\t\tcontext.remove(`slots.${slotName}.targeting.${key}`);\n\t\t});\n\t});\n\n\tutils.logger(logGroup, 'resetTargetingKeys', slotName);\n}\n\nfunction requestBids({ responseListener = null }) {\n\tconst config = context.get('bidders');\n\n\tif (config.prebid && config.prebid.enabled) {\n\t\tbiddersRegistry.prebid = new Prebid(config.prebid, config.timeout);\n\t}\n\n\tif (config.a9 && config.a9.enabled) {\n\t\tbiddersRegistry.a9 = new A9(config.a9, config.timeout);\n\t}\n\n\tforEachBidder((bidder) => {\n\t\tif (responseListener) {\n\t\t\tbidder.addResponseListener(responseListener);\n\t\t}\n\n\t\tbidder.call();\n\t});\n}\n\n/**\n * Executes callback function if bidding is finished or timeout is reached\n *\n * @param {function} callback\n *\n * @returns {Promise}\n */\nfunction runOnBiddingReady(callback) {\n\tconst responses = [];\n\n\tforEachBidder((bidder) => {\n\t\tresponses.push(bidder.waitForResponse());\n\t});\n\n\treturn Promise.all(responses).then(callback);\n}\n\nfunction storeRealSlotPrices(slotName) {\n\trealSlotPrices[slotName] = getCurrentSlotPrices(slotName);\n}\n\nfunction updateSlotTargeting(slotName) {\n\tconst bidderTargeting = getBidParameters(slotName);\n\n\tstoreRealSlotPrices(slotName);\n\n\tresetTargetingKeys(slotName);\n\tapplyTargetingParams(slotName, bidderTargeting);\n\n\tutils.logger(logGroup, 'updateSlotTargeting', slotName, bidderTargeting);\n\n\treturn bidderTargeting;\n}\n\nexport const bidders = {\n\tgetBidParameters,\n\tgetCurrentSlotPrices,\n\tgetDfpSlotPrices,\n\thasAllResponses,\n\tprebidHelper,\n\trequestBids,\n\trunOnBiddingReady,\n\ttransformPriceFromBid,\n\tupdateSlotTargeting,\n};\n"],"sourceRoot":""}