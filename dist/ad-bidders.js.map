<<<<<<< HEAD
{"version":3,"sources":["webpack://adEngine/webpack/bootstrap","webpack://adEngine/external \"@wikia/ad-engine\"","webpack://adEngine/external \"@babel/runtime-corejs2/helpers/createClass\"","webpack://adEngine/external \"@babel/runtime-corejs2/helpers/classCallCheck\"","webpack://adEngine/external \"@babel/runtime-corejs2/helpers/inherits\"","webpack://adEngine/external \"@babel/runtime-corejs2/helpers/getPrototypeOf\"","webpack://adEngine/external \"@babel/runtime-corejs2/helpers/possibleConstructorReturn\"","webpack://adEngine/external \"@babel/runtime-corejs2/core-js/object/keys\"","webpack://adEngine/external \"@babel/runtime-corejs2/core-js/parse-int\"","webpack://adEngine/external \"@babel/runtime-corejs2/helpers/assertThisInitialized\"","webpack://adEngine/external \"@babel/runtime-corejs2/helpers/slicedToArray\"","webpack://adEngine/external \"@babel/runtime-corejs2/helpers/objectSpread\"","webpack://adEngine/external \"@babel/runtime-corejs2/core-js/object/assign\"","webpack://adEngine/external \"core-decorators\"","webpack://adEngine/external \"@babel/runtime-corejs2/helpers/applyDecoratedDescriptor\"","webpack://adEngine/external \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\"","webpack://adEngine/external \"@babel/runtime-corejs2/core-js/promise\"","webpack://adEngine/./src/ad-bidders/wrappers/apstag.ts","webpack://adEngine/./src/ad-bidders/wrappers/cmp.ts","webpack://adEngine/./src/ad-bidders/wrappers/index.ts","webpack://adEngine/./src/ad-bidders/base-bidder.ts","webpack://adEngine/./src/ad-bidders/a9/index.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/base-adapter.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/aol.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/appnexus.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/appnexus-ast.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/audience-network.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/beachfront.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/index-exchange.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/kargo.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/lkqd.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/onemobile.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/openx.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/pubmatic.ts","webpack://adEngine/./src/ad-bidders/prebid/prebid-helper.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/rubicon.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/rubicon-display.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/wikia.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/wikia-video.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters-registry.ts","webpack://adEngine/./src/ad-bidders/prebid/price-helper.ts","webpack://adEngine/./src/ad-bidders/prebid/prebid-settings.ts","webpack://adEngine/./src/ad-bidders/prebid/index.ts","webpack://adEngine/./src/ad-bidders/index.ts"],"names":["Apstag","instance","renderImpEndCallbacks","renderImpHookPresent","utils","insertScript","configure","script","scriptLoader","loadScript","window","apstag","_Q","init","args","configureCommand","fetchBids","command","push","apsConfig","bidsConfig","cb","currentBids","targetingKeys","debug","callback","Error","addRenderImpHook","original","renderImp","options","doc","impId","forEach","Cmp","param","__cmp","consentData","newCmp","cmp","BaseBidder","name","bidderConfig","timeout","logGroup","context","resetState","logger","called","response","onResponseCallbacks","LazyQueue","onItemFlush","callBids","onBidResponse","calculatePrices","flush","slotName","get","getBestPrice","isSlotSupported","getTargetingParams","isSupported","createWithTimeout","resolve","hasResponse","addResponseListener","NotImplementedException","A9","loaded","isCMPEnabled","amazonId","slots","slotsNames","bids","priceMap","slotNamesMap","make","events","slotService","bidsRefreshing","isRenderImpOverwritten","initIfNotLoaded","a9Slots","getA9SlotsDefinitions","getApstagConfig","pubID","videoAdServer","deals","dealsEnabled","getGdprIfApplicable","gdpr","enabled","gdprApplies","consent","cmpTimeout","map","getSlotAlias","slotAlias","createSlotDefinition","filter","slot","refresh","addApstagRenderImpHookOnFirstFetch","bid","slotID","getBidTargetingWithKeys","keys","bidTargeting","updateBidSlot","emit","BIDS_REFRESH","addApstagRenderImpHook","onRenderImpEnd","getRenderedSlot","getSlotName","addClass","A9_CLASS","refreshBid","renderedSlot","getTargeting","amzniid","shouldRefreshSlot","slotDef","includes","config","slotId","definition","videoEnabled","type","mediaType","sizes","helpers","targeting","key","indexOf","exists","getConsentData","amznbid","a9","BaseAdapter","prepareConfigForAdUnit","Aol","bidderName","network","code","placement","alias","sizeId","mediaTypes","banner","bidder","params","Appnexus","placements","position","placementId","getPlacement","vertical","AppnexusAst","aliases","appnexus","debugPlacementId","isDebugMode","queryString","video","playerSize","skippable","playback_method","AudienceNetwork","testMode","Beachfront","bidfloor","debugAppId","appId","IndexExchange","ix","siteId","size","Kargo","Lkqd","pageurl","location","hostname","output","Onemobile","pos","dcn","Openx","delDomain","unit","Pubmatic","publisherId","ids","toLowerCase","getVideoConfig","getStandardConfig","videoParams","mimes","minduration","maxduration","startdelay","playbackmethod","protocols","linearity","getBids","adSlot","lazyLoadSlots","isSlotApplicable","lazyLoad","isSlotLazy","getState","setupAdUnits","adaptersConfig","adUnits","adapters","getAdapters","adapter","adapterAdUnits","prepareAdUnits","adUnit","getBidByAdId","adId","pbjs","getBidResponses","getAllPrebidWinningBids","length","responses","adUnitsBids","concat","getAvailableBidsByAdUnitCode","adUnitCode","getBidResponsesForAdUnitCode","status","getPrebid","getWinningVideoBidBySlotName","allowedBidders","canUseThisBidder","bidderCode","hasVast","vastUrl","vastContent","cpm","reduce","previousBid","currentBid","pushPrebid","que","Rubicon","accountId","zoneId","inventory","playerWidth","playerHeight","size_id","language","lang","RubiconDisplay","rubicon","pageTargeting","keywords","price","limit","useRandomPrice","Wikia","create","supportedMediaTypes","Math","floor","random","bidRequest","addBidResponse","done","addBids","setTimeout","bidResponse","createBid","width","height","getPrice","ad","getCreative","ttl","creative","document","createElement","style","background","color","fontFamily","textAlign","title","innerText","fontWeight","margin","paddingTop","details","join","appendChild","outerHTML","WikiaVideo","buildVastUrl","videoAdUnitId","customParams","creativeId","getVastUrl","videoCacheKey","customAdapters","availableAdapters","aol","appnexusAst","audienceNetwork","beachfront","indexExchange","kargo","lkqd","onemobile","openx","pubmatic","rubiconDisplay","registerAliases","aliasMap","aliasBidder","setupAdapters","bidders","setupCustomAdapters","wikia","wikiaVideo","registerBidAdapter","getPriorities","priorities","priority","DEFAULT_MAX_CPM","videoBiddersCap50","isValidPrice","getStatusCode","Prebid","validResponseStatusCode","roundCpm","maxCpm","result","transformPriceFromCpm","max","toFixed","getPrebidBestPrice","bestPrices","slotBids","cmpPrice","transformPriceFromBid","dfpVideoBidders","contextKey","getSettings","standard","alwaysUseBid","adserverTargeting","val","getBidderUuid","isVideo","some","postponeExecutionUntilPbjsLoads","method","apply","on","VIDEO_AD_IMPRESSION","markWinningBidAsUsed","VIDEO_AD_ERROR","VIDEO_AD_USED","decorate","lazyLoaded","isLazyLoadingEnabled","lazyLoadingEnabled","prebidConfig","enableSendAllBids","bidderSequence","bidderTimeout","cache","url","userSync","iframeEnabled","enabledBidders","syncDelay","consentManagement","cmpApi","allowAuctionWithoutConsent","applyConfig","registerBidsRefreshing","setConfig","bidderSettings","bidsBackHandler","applySettings","requestBids","removeAdUnits","PREBID_LAZY_CALL","lazyCall","libraryUrl","adUnitsLazy","removeAdUnit","slotParams","bidParams","timeToRespond","hb_uuid","refreshUsedBid","winningBid","adUnitsToRefresh","onEvent","once","PAGE_CHANGE_EVENT","offEvent","withRemove","undefined","errorResponseStatusCode","biddersRegistry","realSlotPrices","VIDEO_AD_REQUESTED","updateWinningPbBidderDetails","updateSlotTargeting","applyTargetingParams","set","forEachBidder","getBidParameters","wasCalled","getSlotTargetingParams","getCurrentSlotPrices","slotPrices","priceFromBidder","getSlotBestPrice","getDfpSlotPrices","hasAllResponses","missingBidders","resetTargetingKeys","getTargetingKeysToReset","remove","responseListener","prebid","call","runOnBiddingReady","waitForResponse","all","then","storeRealSlotPrices","bidderTargeting","prebidHelper"],"mappings":"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","file":"ad-bidders.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 16);\n","module.exports = require(\"@wikia/ad-engine\");","module.exports = require(\"@babel/runtime-corejs2/helpers/createClass\");","module.exports = require(\"@babel/runtime-corejs2/helpers/classCallCheck\");","module.exports = require(\"@babel/runtime-corejs2/helpers/inherits\");","module.exports = require(\"@babel/runtime-corejs2/helpers/getPrototypeOf\");","module.exports = require(\"@babel/runtime-corejs2/helpers/possibleConstructorReturn\");","module.exports = require(\"@babel/runtime-corejs2/core-js/object/keys\");","module.exports = require(\"@babel/runtime-corejs2/core-js/parse-int\");","module.exports = require(\"@babel/runtime-corejs2/helpers/assertThisInitialized\");","module.exports = require(\"@babel/runtime-corejs2/helpers/slicedToArray\");","module.exports = require(\"@babel/runtime-corejs2/helpers/objectSpread\");","module.exports = require(\"@babel/runtime-corejs2/core-js/object/assign\");","module.exports = require(\"core-decorators\");","module.exports = require(\"@babel/runtime-corejs2/helpers/applyDecoratedDescriptor\");","module.exports = require(\"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\");","module.exports = require(\"@babel/runtime-corejs2/core-js/promise\");","import { utils } from '@wikia/ad-engine';\n\nexport class Apstag {\n\t/**\n\t * @private\n\t */\n\tstatic instance;\n\n\tstatic make() {\n\t\tif (!Apstag.instance) {\n\t\t\tApstag.instance = new Apstag();\n\t\t}\n\n\t\treturn Apstag.instance;\n\t}\n\n\t/**\n\t * @private\n\t */\n\trenderImpEndCallbacks = [];\n\n\t/**\n\t * @private\n\t * @type {boolean}\n\t */\n\trenderImpHookPresent = false;\n\n\t/**\n\t * @private\n\t */\n\tconstructor() {\n\t\tthis.utils = utils;\n\t\tthis.insertScript();\n\t\tthis.configure();\n\t}\n\n\t/**\n\t * @private\n\t */\n\tinsertScript() {\n\t\tthis.script = this.utils.scriptLoader.loadScript(\n\t\t\t'//c.amazon-adsystem.com/aax2/apstag.js',\n\t\t\t'text/javascript',\n\t\t\ttrue,\n\t\t\t'first',\n\t\t);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tconfigure() {\n\t\twindow.apstag = window.apstag || {};\n\t\twindow.apstag._Q = window.apstag._Q || [];\n\n\t\tif (typeof window.apstag.init === 'undefined') {\n\t\t\twindow.apstag.init = (...args) => {\n\t\t\t\tthis.configureCommand('i', args);\n\t\t\t};\n\t\t}\n\n\t\tif (typeof window.apstag.fetchBids === 'undefined') {\n\t\t\twindow.apstag.fetchBids = (...args) => {\n\t\t\t\tthis.configureCommand('f', args);\n\t\t\t};\n\t\t}\n\t}\n\n\t/** @private */\n\tconfigureCommand(command, args) {\n\t\twindow.apstag._Q.push([command, args]);\n\t}\n\n\tinit(apsConfig) {\n\t\twindow.apstag.init(apsConfig);\n\t}\n\n\t/**\n\t * @param {{slots: A9SlotDefinition[], timeout: number}} bidsConfig configuration of bids\n\t * @param {function(object)} cb Callback receiving current bids\n\t * @returns {!Promise} If `cb` has been omitted\n\t */\n\tfetchBids(bidsConfig, cb = null) {\n\t\twindow.apstag.fetchBids(bidsConfig, (currentBids) => cb(currentBids));\n\t}\n\n\ttargetingKeys() {\n\t\treturn window.apstag.targetingKeys();\n\t}\n\n\tenableDebug() {\n\t\twindow.apstag.debug('enable');\n\t}\n\n\tdisableDebug() {\n\t\twindow.apstag.debug('disable');\n\t}\n\n\t/**\n\t * Executes callback each time after apstag.renderImp is called\n\t * @param {function} callback\n\t */\n\tonRenderImpEnd(callback) {\n\t\tif (typeof callback !== 'function') {\n\t\t\tthrow new Error('onRenderImpEnd used with callback not being a function');\n\t\t}\n\t\tif (!this.renderImpHookPresent) {\n\t\t\tthis.addRenderImpHook();\n\t\t}\n\t\tthis.renderImpEndCallbacks.push(callback);\n\t}\n\n\t/**\n\t * @private\n\t */\n\taddRenderImpHook() {\n\t\tconst original = window.apstag.renderImp;\n\n\t\twindow.apstag.renderImp = (...options) => {\n\t\t\toriginal(...options);\n\t\t\tconst [doc, impId] = options;\n\t\t\tthis.renderImpEndCallbacks.forEach((cb) => cb(doc, impId));\n\t\t};\n\t}\n}\n","export class Cmp {\n\tget exists() {\n\t\treturn !!window.__cmp;\n\t}\n\n\t/**\n\t * @param {*=} param\n\t * @param {function(object)} cb Callback receiving current bids\n\t */\n\tgetConsentData(param, cb) {\n\t\twindow.__cmp('getConsentData', param, (consentData) => cb(consentData));\n\t}\n\n\toverride(newCmp) {\n\t\twindow.__cmp = newCmp;\n\t}\n}\n\nexport const cmp = new Cmp();\n","export * from './apstag';\nexport * from './cmp';\n","import { context, utils } from '@wikia/ad-engine';\n\n/**\n * @abstract\n */\nexport class BaseBidder {\n\tconstructor(name, bidderConfig, timeout = 2000) {\n\t\tthis.name = name;\n\t\tthis.logGroup = `${name}-bidder`;\n\t\tthis.bidderConfig = bidderConfig;\n\t\tthis.timeout = timeout;\n\t\tthis.utils = utils;\n\t\tthis.context = context;\n\n\t\tthis.resetState();\n\n\t\tthis.utils.logger(this.logGroup, 'created');\n\t}\n\n\tresetState() {\n\t\tthis.called = false;\n\t\tthis.response = false;\n\n\t\tthis.onResponseCallbacks = new utils.LazyQueue();\n\t\tthis.onResponseCallbacks.onItemFlush((callback) => {\n\t\t\tcallback(this.name);\n\t\t});\n\t}\n\n\tcall() {\n\t\tthis.response = false;\n\t\tthis.called = true;\n\n\t\tthis.callBids(() => this.onBidResponse());\n\n\t\tthis.utils.logger(this.logGroup, 'called');\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tonBidResponse() {\n\t\tthis.response = true;\n\n\t\tthis.calculatePrices();\n\t\tthis.onResponseCallbacks.flush();\n\n\t\tthis.utils.logger(this.logGroup, 'respond');\n\t}\n\n\t/**\n\t * Returns bidder slot alias if available, otherwise slot name\n\t * @protected\n\t * @param {string} slotName\n\t * @returns {string}\n\t */\n\tgetSlotAlias(slotName) {\n\t\treturn context.get(`slots.${slotName}.bidderAlias`) || slotName;\n\t}\n\n\t/**\n\t * @param {string} slotName\n\t * @returns {{}}\n\t */\n\tgetSlotBestPrice(slotName) {\n\t\treturn this.getBestPrice(slotName);\n\t}\n\n\t/**\n\t * @param {string} slotName\n\t * @returns {{}}\n\t */\n\tgetSlotTargetingParams(slotName) {\n\t\tif (!this.called || !this.isSlotSupported(slotName)) {\n\t\t\treturn {};\n\t\t}\n\n\t\treturn this.getTargetingParams(slotName);\n\t}\n\n\t/**\n\t * @param {string} slotName\n\t * @returns {boolean}\n\t */\n\tisSlotSupported(slotName) {\n\t\treturn this.isSupported(slotName);\n\t}\n\n\t/**\n\t * Fires the Promise if bidder replied or timeout is reached\n\t * @returns {Promise}\n\t */\n\twaitForResponse() {\n\t\treturn this.utils.createWithTimeout((resolve) => {\n\t\t\tif (this.hasResponse()) {\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\tthis.addResponseListener(resolve);\n\t\t\t}\n\t\t}, this.timeout);\n\t}\n\n\t/**\n\t * @returns {boolean}\n\t */\n\thasResponse() {\n\t\treturn this.response;\n\t}\n\n\taddResponseListener(callback) {\n\t\tthis.onResponseCallbacks.push(callback);\n\t}\n\n\t/**\n\t * Check if bidder was called\n\t * @returns {boolean}\n\t */\n\twasCalled() {\n\t\treturn this.called;\n\t}\n\n\t/**\n\t * @abstract\n\t * @protected\n\t */\n\tcallBids(cb) {\n\t\tthrow new utils.NotImplementedException({ cb });\n\t}\n\n\t/**\n\t * @abstract\n\t * @protected\n\t */\n\tcalculatePrices() {\n\t\tthrow new utils.NotImplementedException();\n\t}\n\n\t/**\n\t * @abstract\n\t * @protected\n\t * @param {string} slotName\n\t * @returns {*|{}}\n\t */\n\tgetBestPrice(slotName) {\n\t\tthrow new utils.NotImplementedException({ slotName });\n\t}\n\n\t/**\n\t * @abstract\n\t * @protected\n\t * @param {string} slotName\n\t * @returns {*|{}}\n\t */\n\tgetTargetingParams(slotName) {\n\t\tthrow new utils.NotImplementedException({ slotName });\n\t}\n\n\t/**\n\t * Checks if slot with given name is supported by bidder.\n\t * @abstract\n\t * @protected\n\t * @param {string} slotName\n\t * @returns {boolean}\n\t */\n\tisSupported(slotName) {\n\t\tthrow new utils.NotImplementedException({ slotName });\n\t}\n}\n","import { AdSlot, context, events, slotService, utils } from '@wikia/ad-engine';\nimport { Apstag, cmp } from '../wrappers';\nimport { BaseBidder } from '../base-bidder';\n\nconst logGroup = 'A9';\n\n/**\n * @typedef {Object} A9SlotDefinition\n * @property {string} slotID\n * @property {string} slotName\n */\n\nexport class A9 extends BaseBidder {\n\tstatic A9_CLASS = 'a9-ad';\n\n\t/** @private */\n\tloaded = false;\n\n\tconstructor(bidderConfig, timeout = 2000) {\n\t\tsuper('a9', bidderConfig, timeout);\n\n\t\tthis.isCMPEnabled = context.get('custom.isCMPEnabled');\n\t\tthis.amazonId = this.bidderConfig.amazonId;\n\t\tthis.slots = this.bidderConfig.slots;\n\t\tthis.slotsNames = Object.keys(this.slots);\n\t\tthis.bids = {};\n\t\tthis.priceMap = {};\n\t\tthis.slotNamesMap = {};\n\t\tthis.targetingKeys = [];\n\t\tthis.apstag = Apstag.make();\n\t\tthis.cmp = cmp;\n\t\tthis.utils = utils;\n\t\tthis.events = events;\n\t\tthis.slotService = slotService;\n\t\tthis.timeout = timeout;\n\t\tthis.bidsRefreshing = context.get('bidders.a9.bidsRefreshing') || {};\n\t\tthis.isRenderImpOverwritten = false;\n\t}\n\n\tgetPrices() {\n\t\treturn this.priceMap;\n\t}\n\n\tgetTargetingKeysToReset() {\n\t\treturn this.targetingKeys;\n\t}\n\n\tinit(consentData = {}) {\n\t\tthis.initIfNotLoaded(consentData);\n\n\t\tthis.bids = {};\n\t\tthis.priceMap = {};\n\t\tconst a9Slots = this.getA9SlotsDefinitions(this.slotsNames);\n\n\t\tthis.fetchBids(a9Slots);\n\t}\n\n\t/**\n\t * @private\n\t * @param consentData\n\t */\n\tinitIfNotLoaded(consentData) {\n\t\tif (!this.loaded) {\n\t\t\tthis.apstag.init(this.getApstagConfig(consentData));\n\t\t\tthis.loaded = true;\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t * @param consentData\n\t * @returns {{videoAdServer: string, deals: boolean, pubID: (*|string), gdpr: ()}}\n\t */\n\tgetApstagConfig(consentData) {\n\t\treturn {\n\t\t\tpubID: this.amazonId,\n\t\t\tvideoAdServer: 'DFP',\n\t\t\tdeals: !!this.bidderConfig.dealsEnabled,\n\t\t\t...this.getGdprIfApplicable(consentData),\n\t\t};\n\t}\n\n\t/**\n\t * @private\n\t * @param consentData\n\t * @returns {*}\n\t */\n\tgetGdprIfApplicable(consentData) {\n\t\tif (this.isCMPEnabled && consentData && consentData.consentData) {\n\t\t\treturn {\n\t\t\t\tgdpr: {\n\t\t\t\t\tenabled: consentData.gdprApplies,\n\t\t\t\t\tconsent: consentData.consentData,\n\t\t\t\t\tcmpTimeout: 5000,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\treturn {};\n\t}\n\n\t/**\n\t * Transforms slots names into A9 slot definitions.\n\t * @param {string[]} slotsNames\n\t * @returns {A9SlotDefinition[]}\n\t */\n\tgetA9SlotsDefinitions(slotsNames) {\n\t\treturn slotsNames\n\t\t\t.map((slotName) => this.getSlotAlias(slotName))\n\t\t\t.map((slotAlias) => this.createSlotDefinition(slotAlias))\n\t\t\t.filter((slot) => slot !== null);\n\t}\n\n\t/**\n\t * Fetches bids from A9.\n\t * Calls this.onBidResponse() upon success.\n\t * @private\n\t * @param {A9SlotDefinition[]} slots\n\t * @param {boolean} refresh\n\t */\n\tfetchBids(slots, refresh = false) {\n\t\tutils.logger(logGroup, 'fetching bids for slots', slots);\n\t\tthis.apstag.fetchBids({ slots, timeout: this.timeout }, (currentBids) => {\n\t\t\tutils.logger(logGroup, 'bids fetched for slots', slots, 'bids', currentBids);\n\t\t\tthis.addApstagRenderImpHookOnFirstFetch();\n\n\t\t\tcurrentBids.forEach((bid) => {\n\t\t\t\tconst slotName = this.slotNamesMap[bid.slotID] || bid.slotID;\n\t\t\t\tconst { keys, bidTargeting } = this.getBidTargetingWithKeys(bid);\n\n\t\t\t\tthis.updateBidSlot(slotName, keys, bidTargeting);\n\t\t\t});\n\n\t\t\tthis.onBidResponse();\n\t\t\tif (refresh) {\n\t\t\t\tthis.events.emit(this.events.BIDS_REFRESH);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * @private\n\t */\n\taddApstagRenderImpHookOnFirstFetch() {\n\t\tif (!this.isRenderImpOverwritten) {\n\t\t\tthis.isRenderImpOverwritten = true;\n\t\t\tthis.addApstagRenderImpHook();\n\t\t}\n\t}\n\n\t/**\n\t * Wraps apstag.renderImp\n\t * Calls this.refreshBid() if bids refreshing is enabled.\n\t * @private\n\t */\n\taddApstagRenderImpHook() {\n\t\tutils.logger(logGroup, 'overwriting window.apstag.renderImp');\n\t\tthis.apstag.onRenderImpEnd((doc, impId) => {\n\t\t\tif (!impId) {\n\t\t\t\tutils.logger(logGroup, 'apstag.renderImp() called with 1 argument only');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst slot = this.getRenderedSlot(impId);\n\t\t\tconst slotName = slot.getSlotName();\n\n\t\t\tslot.addClass(A9.A9_CLASS);\n\t\t\tutils.logger(logGroup, `bid used for slot ${slotName}`);\n\t\t\tdelete this.bids[this.getSlotAlias(slotName)];\n\n\t\t\tif (this.bidsRefreshing.enabled) {\n\t\t\t\tthis.refreshBid(slot);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Returns slot which used bid with given impression id.\n\t * @private\n\t */\n\tgetRenderedSlot(impId: string | number): AdSlot {\n\t\tlet renderedSlot;\n\n\t\tslotService.forEach((slot) => {\n\t\t\tif (slot.getTargeting().amzniid === impId) {\n\t\t\t\trenderedSlot = slot;\n\t\t\t}\n\t\t});\n\n\t\treturn renderedSlot;\n\t}\n\n\t/**\n\t * Refreshes bid for given slot.\n\t * @private\n\t * @param {AdSlot} slot\n\t */\n\trefreshBid(slot) {\n\t\tif (!this.shouldRefreshSlot(slot)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst slotDef = this.createSlotDefinition(this.getSlotAlias(slot.getSlotName()));\n\n\t\tif (slotDef) {\n\t\t\tutils.logger(logGroup, 'refresh bids for slot', slotDef);\n\t\t\tthis.fetchBids([slotDef], true);\n\t\t}\n\t}\n\n\t/**\n\t * Checks if slot should be refreshed.\n\t * @private\n\t * @param {AdSlot} slot\n\t * @returns {boolean}\n\t */\n\tshouldRefreshSlot(slot) {\n\t\treturn this.bidsRefreshing.slots.includes(this.getSlotAlias(slot.getSlotName()));\n\t}\n\n\t/**\n\t * Creates A9 slot definition from slot alias.\n\t * @param {string} slotAlias\n\t * @returns {A9SlotDefinition | null} Returns null i\n\t */\n\tcreateSlotDefinition(slotAlias) {\n\t\tconst config = this.slots[slotAlias];\n\t\tconst slotID = config.slotId || slotAlias;\n\t\tconst definition = {\n\t\t\tslotID,\n\t\t\tslotName: slotID,\n\t\t};\n\n\t\tthis.slotNamesMap[slotID] = slotAlias;\n\n\t\tif (!this.bidderConfig.videoEnabled && config.type === 'video') {\n\t\t\treturn null;\n\t\t}\n\t\tif (config.type === 'video') {\n\t\t\tdefinition.mediaType = 'video';\n\t\t} else {\n\t\t\tdefinition.sizes = config.sizes;\n\t\t}\n\n\t\treturn definition;\n\t}\n\n\t/**\n\t * @private\n\t * @param bid\n\t * @returns {*}\n\t */\n\tgetBidTargetingWithKeys(bid) {\n\t\tlet bidTargeting = bid;\n\t\tlet keys = this.apstag.targetingKeys();\n\n\t\tif (this.bidderConfig.dealsEnabled) {\n\t\t\tkeys = bid.helpers.targetingKeys;\n\t\t\tbidTargeting = bid.targeting;\n\t\t}\n\n\t\treturn {\n\t\t\tkeys,\n\t\t\tbidTargeting,\n\t\t};\n\t}\n\n\t/**\n\t * @private\n\t * @param slotName\n\t * @param keys\n\t * @param bidTargeting\n\t */\n\tupdateBidSlot(slotName, keys, bidTargeting) {\n\t\tthis.bids[slotName] = {};\n\t\tkeys.forEach((key) => {\n\t\t\tif (this.targetingKeys.indexOf(key) === -1) {\n\t\t\t\tthis.targetingKeys.push(key);\n\t\t\t}\n\t\t\tthis.bids[slotName][key] = bidTargeting[key];\n\t\t});\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tcallBids() {\n\t\tif (this.cmp.exists) {\n\t\t\tthis.cmp.getConsentData(null, (consentData) => {\n\t\t\t\tthis.init(consentData);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.init();\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tcalculatePrices() {\n\t\treturn Object.keys(this.bids).forEach((slotName) => {\n\t\t\tthis.priceMap[slotName] = this.bids[slotName].amznbid;\n\t\t});\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tgetBestPrice(slotName) {\n\t\tconst slotAlias = this.getSlotAlias(slotName);\n\n\t\treturn this.priceMap[slotAlias] ? { a9: this.priceMap[slotAlias] } : {};\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tgetTargetingParams(slotName) {\n\t\treturn this.bids[this.getSlotAlias(slotName)] || {};\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tisSupported(slotName) {\n\t\treturn !!this.slots[this.getSlotAlias(slotName)];\n\t}\n}\n","export class BaseAdapter {\n\tconstructor({ enabled, slots }) {\n\t\tthis.enabled = enabled;\n\t\tthis.slots = slots;\n\t}\n\n\tprepareAdUnits() {\n\t\treturn Object.keys(this.slots).map((slotName) =>\n\t\t\tthis.prepareConfigForAdUnit(slotName, this.slots[slotName]),\n\t\t);\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Aol extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'aol';\n\t\tthis.network = options.network;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, placement, alias, sizeId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacement,\n\t\t\t\t\t\tnetwork: this.network,\n\t\t\t\t\t\talias,\n\t\t\t\t\t\tsizeId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { context } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class Appnexus extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'appnexus';\n\t\tthis.placements = options.placements;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, position = 'mobile' }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacementId: this.getPlacement(position),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tgetPlacement(position) {\n\t\tif (position === 'mobile') {\n\t\t\tconst vertical = context.get('targeting.mappedVerticalName');\n\n\t\t\tposition = vertical && this.placements[vertical] ? vertical : 'other';\n\t\t}\n\n\t\treturn this.placements[position];\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class AppnexusAst extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'appnexusAst';\n\t\tthis.aliases = {\n\t\t\tappnexus: [this.bidderName],\n\t\t};\n\t\tthis.debugPlacementId = options.debugPlacementId;\n\t\tthis.isDebugMode = utils.queryString.get('appnexusast_debug_mode') === '1';\n\t}\n\n\tprepareConfigForAdUnit(code, { placementId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tcontext: 'instream',\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacementId: this.isDebugMode ? this.debugPlacementId : placementId,\n\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\tskippable: false,\n\t\t\t\t\t\t\tplayback_method: ['auto_play_sound_off'],\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class AudienceNetwork extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'audienceNetwork';\n\t\tthis.testMode = utils.queryString.get('audiencenetworktest') === 'true';\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, placementId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\ttestMode: this.testMode,\n\t\t\t\t\t\tplacementId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class Beachfront extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'beachfront';\n\t\tthis.bidfloor = 0.01;\n\t\tthis.debugAppId = options.debugAppId;\n\t\tthis.isDebugMode = utils.queryString.get('beachfront_debug_mode') === '1';\n\t}\n\n\tprepareConfigForAdUnit(code, { appId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tcontext: 'instream',\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tbidfloor: this.bidfloor,\n\t\t\t\t\t\tappId: this.isDebugMode ? this.debugAppId : appId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class IndexExchange extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'indexExchange';\n\t\tthis.aliases = {\n\t\t\tix: [this.bidderName],\n\t\t};\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, siteId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: sizes.map((size) => ({\n\t\t\t\tbidder: this.bidderName,\n\t\t\t\tparams: {\n\t\t\t\t\tsiteId,\n\t\t\t\t\tsize,\n\t\t\t\t},\n\t\t\t})),\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Kargo extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'kargo';\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, placementId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tsizes,\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacementId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Lkqd extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'lkqd';\n\t}\n\n\tprepareConfigForAdUnit(code, { placementId, siteId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tsiteId,\n\t\t\t\t\t\tplacementId,\n\t\t\t\t\t\tpageurl: window.location.hostname,\n\t\t\t\t\t\toutput: 'svpaid',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Onemobile extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'onemobile';\n\t\tthis.siteId = options.siteId;\n\t}\n\n\tprepareConfigForAdUnit(code, { size, pos }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes: [size],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tdcn: this.siteId,\n\t\t\t\t\t\tpos,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Openx extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'openx';\n\t\tthis.delDomain = options.delDomain;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, unit }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tunit,\n\t\t\t\t\t\tdelDomain: this.delDomain,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Pubmatic extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'pubmatic';\n\t\tthis.publisherId = options.publisherId;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, ids }) {\n\t\tswitch (code.toLowerCase()) {\n\t\t\tcase 'featured':\n\t\t\tcase 'incontent_player':\n\t\t\t\treturn this.getVideoConfig(code, ids);\n\t\t\tdefault:\n\t\t\t\treturn this.getStandardConfig(code, sizes, ids);\n\t\t}\n\t}\n\n\tgetVideoConfig(code, ids) {\n\t\tconst videoParams = {\n\t\t\tvideo: {\n\t\t\t\tmimes: ['video/mp4', 'video/x-flv', 'video/webm', 'video/ogg'],\n\t\t\t\tskippable: true,\n\t\t\t\tminduration: 1,\n\t\t\t\tmaxduration: 30,\n\t\t\t\tstartdelay: 0,\n\t\t\t\tplaybackmethod: [2, 3],\n\t\t\t\tprotocols: [2, 3, 5, 6],\n\t\t\t\tlinearity: 1,\n\t\t\t\tplacement: 1,\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t\tcontext: 'instream',\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: this.getBids(ids, videoParams),\n\t\t};\n\t}\n\n\tgetStandardConfig(code, sizes, ids) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: this.getBids(ids),\n\t\t};\n\t}\n\n\tgetBids(ids, params = {}) {\n\t\treturn ids.map((adSlot) => ({\n\t\t\tbidder: this.bidderName,\n\t\t\tparams: {\n\t\t\t\tadSlot,\n\t\t\t\tpublisherId: this.publisherId,\n\t\t\t\t...params,\n\t\t\t},\n\t\t}));\n\t}\n}\n","import { context, slotService } from '@wikia/ad-engine';\nimport { getAdapters } from './adapters-registry';\n\nconst lazyLoadSlots = ['bottom_leaderboard'];\n\nfunction isSlotApplicable(code, lazyLoad) {\n\tconst isSlotLazy = lazyLoadSlots.indexOf(code) !== -1;\n\n\tif (!slotService.getState(code)) {\n\t\treturn false;\n\t}\n\n\tif (\n\t\tlazyLoad !== 'off' &&\n\t\t((lazyLoad === 'pre' && isSlotLazy) || (lazyLoad === 'post' && !isSlotLazy))\n\t) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nexport function setupAdUnits(adaptersConfig, lazyLoad = 'off') {\n\tconst adUnits = [];\n\tconst adapters = getAdapters(adaptersConfig);\n\n\tadapters.forEach((adapter) => {\n\t\tif (adapter && adapter.enabled) {\n\t\t\tconst adapterAdUnits = adapter.prepareAdUnits();\n\n\t\t\tadapterAdUnits.forEach((adUnit) => {\n\t\t\t\tif (adUnit && isSlotApplicable(adUnit.code, lazyLoad)) {\n\t\t\t\t\tadUnits.push(adUnit);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\treturn adUnits;\n}\n\nexport function getBidByAdId(adId) {\n\tif (!window.pbjs || typeof window.pbjs.getBidResponses !== 'function') {\n\t\treturn null;\n\t}\n\n\tlet bids = window.pbjs.getAllPrebidWinningBids().filter((bid) => adId === bid.adId);\n\n\tif (!bids.length) {\n\t\tconst responses = window.pbjs.getBidResponses();\n\n\t\tObject.keys(responses).forEach((adUnit) => {\n\t\t\tconst adUnitsBids = responses[adUnit].bids.filter((bid) => adId === bid.adId);\n\n\t\t\tbids = bids.concat(adUnitsBids);\n\t\t});\n\t}\n\n\treturn bids.length ? bids[0] : null;\n}\n\nexport function getAvailableBidsByAdUnitCode(adUnitCode) {\n\tlet bids = [];\n\n\tif (window.pbjs && typeof window.pbjs.getBidResponsesForAdUnitCode === 'function') {\n\t\tbids = window.pbjs.getBidResponsesForAdUnitCode(adUnitCode).bids || [];\n\t\tbids = bids.filter((bid) => bid.status !== 'rendered');\n\t}\n\n\treturn bids;\n}\n\nexport function getPrebid() {\n\treturn window.pbjs;\n}\n\nexport function getTargeting(slotName) {\n\treturn Object.assign(\n\t\t{\n\t\t\tpos: [slotName],\n\t\t},\n\t\tcontext.get('bidders.prebid.targeting') || {},\n\t);\n}\n\nexport function getWinningVideoBidBySlotName(slotName, allowedBidders) {\n\tif (!window.pbjs || !window.pbjs.getBidResponsesForAdUnitCode) {\n\t\treturn null;\n\t}\n\n\tconst bids = window.pbjs.getBidResponsesForAdUnitCode(slotName).bids || [];\n\n\treturn bids\n\t\t.filter((bid) => {\n\t\t\tconst canUseThisBidder = !allowedBidders || allowedBidders.indexOf(bid.bidderCode) !== -1;\n\t\t\tconst hasVast = bid.vastUrl || bid.vastContent;\n\n\t\t\treturn canUseThisBidder && hasVast && bid.cpm > 0;\n\t\t})\n\t\t.reduce((previousBid, currentBid) => {\n\t\t\tif (previousBid === null || currentBid.cpm > previousBid.cpm) {\n\t\t\t\treturn currentBid;\n\t\t\t}\n\n\t\t\treturn previousBid;\n\t\t}, null);\n}\n\nexport function pushPrebid(callback) {\n\twindow.pbjs.que.push(callback);\n}\n","import { context } from '@wikia/ad-engine';\nimport { getTargeting } from '../prebid-helper';\nimport { BaseAdapter } from './base-adapter';\n\nexport class Rubicon extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'rubicon';\n\t\tthis.accountId = options.accountId;\n\t}\n\n\tprepareConfigForAdUnit(code, { siteId, zoneId, sizeId, position }) {\n\t\tif (code === 'featured' && !context.get('custom.rubiconInFV')) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst targeting = getTargeting(code);\n\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaType: 'video',\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t\tcontext: 'instream',\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\taccountId: this.accountId,\n\t\t\t\t\t\tsiteId,\n\t\t\t\t\t\tzoneId,\n\t\t\t\t\t\tname: code,\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\tinventory: targeting,\n\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\tplayerWidth: '640',\n\t\t\t\t\t\t\tplayerHeight: '480',\n\t\t\t\t\t\t\tsize_id: sizeId,\n\t\t\t\t\t\t\tlanguage: targeting.lang ? targeting.lang[0] : 'en',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { getTargeting } from '../prebid-helper';\nimport { BaseAdapter } from './base-adapter';\n\nexport class RubiconDisplay extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'rubicon_display';\n\t\tthis.aliases = {\n\t\t\trubicon: [this.bidderName],\n\t\t};\n\t\tthis.accountId = options.accountId;\n\t}\n\n\tprepareConfigForAdUnit(code, { siteId, zoneId, sizes, position, targeting }) {\n\t\tconst pageTargeting = getTargeting(code);\n\n\t\tObject.keys(targeting || {}).forEach((key) => {\n\t\t\tpageTargeting[key] = targeting[key];\n\t\t});\n\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\taccountId: this.accountId,\n\t\t\t\t\t\tsiteId,\n\t\t\t\t\t\tzoneId,\n\t\t\t\t\t\tname: code,\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\tkeywords: ['rp.fastlane'],\n\t\t\t\t\t\tinventory: pageTargeting,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nconst price = utils.queryString.get('wikia_adapter');\nconst limit = parseInt(utils.queryString.get('wikia_adapter_limit'), 10) || 99;\nconst timeout = parseInt(utils.queryString.get('wikia_adapter_timeout'), 10) || 0;\nconst useRandomPrice = utils.queryString.get('wikia_adapter_random') === '1';\n\nexport class Wikia extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'wikia';\n\t\tthis.enabled = !!price;\n\t\tthis.limit = limit;\n\t\tthis.useRandomPrice = useRandomPrice;\n\t\tthis.timeout = timeout;\n\n\t\tthis.create = () => this;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tgetSpec() {\n\t\treturn {\n\t\t\tcode: this.bidderName,\n\t\t\tsupportedMediaTypes: ['banner'],\n\t\t};\n\t}\n\n\tgetPrice() {\n\t\tif (this.useRandomPrice) {\n\t\t\treturn Math.floor(Math.random() * 2000) / 100;\n\t\t}\n\n\t\treturn parseInt(price, 10) / 100;\n\t}\n\n\tcallBids(bidRequest, addBidResponse, done) {\n\t\twindow.pbjs.que.push(() => {\n\t\t\tthis.addBids(bidRequest, addBidResponse, done);\n\t\t});\n\t}\n\n\taddBids(bidRequest, addBidResponse, done) {\n\t\tsetTimeout(() => {\n\t\t\tbidRequest.bids.forEach((bid) => {\n\t\t\t\tif (this.limit === 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst bidResponse = window.pbjs.createBid(1);\n\t\t\t\tconst [width, height] = bid.sizes[0];\n\t\t\t\tconst cpm = this.getPrice();\n\n\t\t\t\tbidResponse.ad = this.getCreative(bid.sizes[0], cpm);\n\t\t\t\tbidResponse.bidderCode = bidRequest.bidderCode;\n\t\t\t\tbidResponse.cpm = cpm;\n\t\t\t\tbidResponse.ttl = 300;\n\t\t\t\tbidResponse.mediaType = 'banner';\n\t\t\t\tbidResponse.width = width;\n\t\t\t\tbidResponse.height = height;\n\n\t\t\t\taddBidResponse(bid.adUnitCode, bidResponse);\n\t\t\t\tthis.limit -= 1;\n\t\t\t});\n\t\t\tdone();\n\t\t}, this.timeout);\n\t}\n\n\tgetCreative(size, cpm) {\n\t\tconst creative = document.createElement('div');\n\n\t\tcreative.style.background = '#00b7e0';\n\t\tcreative.style.color = '#fff';\n\t\tcreative.style.fontFamily = 'sans-serif';\n\t\tcreative.style.height = '100%';\n\t\tcreative.style.textAlign = 'center';\n\t\tcreative.style.width = '100%';\n\n\t\tconst title = document.createElement('p');\n\n\t\ttitle.innerText = 'Wikia Creative';\n\t\ttitle.style.fontWeight = 'bold';\n\t\ttitle.style.margin = '0';\n\t\ttitle.style.paddingTop = '10px';\n\n\t\tconst details = document.createElement('small');\n\n\t\tdetails.innerText = `cpm: ${cpm}, size: ${size.join('x')}`;\n\n\t\tcreative.appendChild(title);\n\t\tcreative.appendChild(details);\n\n\t\treturn creative.outerHTML;\n\t}\n}\n","import { buildVastUrl, context, utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nconst price = utils.queryString.get('wikia_video_adapter');\nconst limit = parseInt(utils.queryString.get('wikia_adapter_limit'), 10) || 99;\nconst timeout = parseInt(utils.queryString.get('wikia_adapter_timeout'), 10) || 0;\nconst useRandomPrice = utils.queryString.get('wikia_adapter_random') === '1';\n\nexport class WikiaVideo extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'wikiaVideo';\n\t\tthis.enabled = !!price;\n\t\tthis.limit = limit;\n\t\tthis.useRandomPrice = useRandomPrice;\n\t\tthis.timeout = timeout;\n\n\t\tthis.create = () => this;\n\t}\n\n\tprepareConfigForAdUnit(code) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tcontext: 'outstream',\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tgetSpec() {\n\t\treturn {\n\t\t\tcode: this.bidderName,\n\t\t\tsupportedMediaTypes: ['video'],\n\t\t};\n\t}\n\n\tgetPrice() {\n\t\tif (this.useRandomPrice) {\n\t\t\treturn Math.floor(Math.random() * 20);\n\t\t}\n\n\t\treturn parseInt(price, 10) / 100;\n\t}\n\n\tgetVastUrl(width, height, slotName) {\n\t\treturn buildVastUrl(width / height, slotName, {\n\t\t\tvideoAdUnitId: context.get(`bidders.prebid.wikiaVideo.slots.${slotName}.videoAdUnitId`),\n\t\t\tcustomParams: context.get(`bidders.prebid.wikiaVideo.slots.${slotName}.customParams`),\n\t\t});\n\t}\n\n\tcallBids(bidRequest, addBidResponse, done) {\n\t\twindow.pbjs.que.push(() => {\n\t\t\tthis.addBids(bidRequest, addBidResponse, done);\n\t\t});\n\t}\n\n\taddBids(bidRequest, addBidResponse, done) {\n\t\tsetTimeout(() => {\n\t\t\tbidRequest.bids.forEach((bid) => {\n\t\t\t\tif (this.limit === 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst bidResponse = window.pbjs.createBid(1);\n\t\t\t\tconst [width, height] = bid.sizes[0];\n\t\t\t\tconst slotName = bid.adUnitCode;\n\n\t\t\t\tbidResponse.bidderCode = bidRequest.bidderCode;\n\t\t\t\tbidResponse.cpm = this.getPrice();\n\t\t\t\tbidResponse.creativeId = 'foo123_wikiaVideoCreativeId';\n\t\t\t\tbidResponse.ttl = 300;\n\t\t\t\tbidResponse.mediaType = 'video';\n\t\t\t\tbidResponse.width = width;\n\t\t\t\tbidResponse.height = height;\n\t\t\t\tbidResponse.vastUrl = this.getVastUrl(width, height, slotName);\n\t\t\t\tbidResponse.videoCacheKey = '123foo_wikiaVideoCacheKey';\n\n\t\t\t\taddBidResponse(bid.adUnitCode, bidResponse);\n\t\t\t\tthis.limit -= 1;\n\t\t\t});\n\n\t\t\tdone();\n\t\t}, this.timeout);\n\t}\n}\n","import { Aol } from './adapters/aol';\nimport { Appnexus } from './adapters/appnexus';\nimport { AppnexusAst } from './adapters/appnexus-ast';\nimport { AudienceNetwork } from './adapters/audience-network';\nimport { Beachfront } from './adapters/beachfront';\nimport { IndexExchange } from './adapters/index-exchange';\nimport { Kargo } from './adapters/kargo';\nimport { Lkqd } from './adapters/lkqd';\nimport { Onemobile } from './adapters/onemobile';\nimport { Openx } from './adapters/openx';\nimport { Pubmatic } from './adapters/pubmatic';\nimport { Rubicon } from './adapters/rubicon';\nimport { RubiconDisplay } from './adapters/rubicon-display';\nimport { Wikia } from './adapters/wikia';\nimport { WikiaVideo } from './adapters/wikia-video';\n\nconst adapters = [];\nconst customAdapters = [];\nconst availableAdapters = {\n\taol: Aol,\n\tappnexus: Appnexus,\n\tappnexusAst: AppnexusAst,\n\taudienceNetwork: AudienceNetwork,\n\tbeachfront: Beachfront,\n\tindexExchange: IndexExchange,\n\tkargo: Kargo,\n\tlkqd: Lkqd,\n\tonemobile: Onemobile,\n\topenx: Openx,\n\tpubmatic: Pubmatic,\n\trubicon: Rubicon,\n\trubiconDisplay: RubiconDisplay,\n};\n\nfunction registerAliases() {\n\tadapters\n\t\t.filter((adapter) => adapter.aliases)\n\t\t.forEach((adapter) => {\n\t\t\twindow.pbjs.que.push(() => {\n\t\t\t\tconst aliasMap = adapter.aliases;\n\n\t\t\t\tObject.keys(aliasMap).forEach((bidderName) => {\n\t\t\t\t\taliasMap[bidderName].forEach((alias) => {\n\t\t\t\t\t\twindow.pbjs.aliasBidder(bidderName, alias);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n}\n\nfunction setupAdapters(bidders) {\n\tObject.keys(availableAdapters).forEach((key) => {\n\t\tif (bidders[key]) {\n\t\t\tconst adapter = new availableAdapters[key](bidders[key]);\n\n\t\t\tadapters.push(adapter);\n\t\t}\n\t});\n\n\tsetupCustomAdapters(bidders);\n}\n\nfunction setupCustomAdapters(bidders) {\n\tif (bidders.wikia) {\n\t\tcustomAdapters.push(new Wikia(bidders.wikia));\n\t}\n\n\tif (bidders.wikiaVideo) {\n\t\tcustomAdapters.push(new WikiaVideo(bidders.wikiaVideo));\n\t}\n\n\tcustomAdapters.forEach((adapter) => {\n\t\tadapters.push(adapter);\n\n\t\twindow.pbjs.que.push(() => {\n\t\t\twindow.pbjs.registerBidAdapter(adapter.create, adapter.bidderName);\n\t\t});\n\t});\n}\n\nexport function getPriorities() {\n\tconst priorities = {};\n\n\tadapters.forEach((adapter) => {\n\t\tpriorities[adapter.bidderName] = adapter.priority || 1;\n\t});\n\n\treturn priorities;\n}\n\nexport function getAdapters(config) {\n\tif (adapters.length === 0 && config) {\n\t\tsetupAdapters(config);\n\t\tregisterAliases();\n\t}\n\n\treturn adapters;\n}\n","import { getAdapters } from './adapters-registry';\nimport { Prebid } from './index';\n\nconst DEFAULT_MAX_CPM = 20;\nconst videoBiddersCap50 = ['appnexusAst', 'rubicon', 'wikiaVideo']; // bidders with $50 cap\n\nfunction isValidPrice(bid) {\n\treturn bid.getStatusCode && bid.getStatusCode() === Prebid.validResponseStatusCode;\n}\n\n/**\n * Round cpm to predefined values.\n *\n * @param {number} cpm\n * @param {number} maxCpm\n * @returns {number}\n */\nfunction roundCpm(cpm, maxCpm) {\n\tlet result = Math.floor(maxCpm);\n\n\tif (cpm === 0) {\n\t\tresult = 0.0;\n\t} else if (cpm < 0.05) {\n\t\tresult = 0.01;\n\t} else if (cpm < 5.0) {\n\t\tresult = Math.floor(cpm * 20) / 20;\n\t} else if (cpm < 10.0) {\n\t\tresult = Math.floor(cpm * 10) / 10;\n\t} else if (cpm < 20.0) {\n\t\tresult = Math.floor(cpm * 2) / 2;\n\t} else if (cpm < maxCpm) {\n\t\tresult = Math.floor(cpm);\n\t}\n\n\treturn result;\n}\n\n/**\n * Round cpm to predefined values and transform to String with 2 decimal places.\n *\n * @param {number} cpm\n * @param {number} maxCpm\n * @returns {string}\n */\nexport function transformPriceFromCpm(cpm, maxCpm = DEFAULT_MAX_CPM) {\n\tmaxCpm = Math.max(maxCpm, DEFAULT_MAX_CPM);\n\n\treturn roundCpm(cpm, maxCpm).toFixed(2);\n}\n\n/**\n *\n * @param {string} slotName\n * @return {object}\n */\nexport function getPrebidBestPrice(slotName) {\n\tconst bestPrices = {};\n\n\tif (window.pbjs && window.pbjs.getBidResponsesForAdUnitCode) {\n\t\tconst slotBids = window.pbjs.getBidResponsesForAdUnitCode(slotName).bids || [];\n\n\t\tgetAdapters().forEach((adapter) => {\n\t\t\tbestPrices[adapter.bidderName] = '';\n\t\t});\n\n\t\tslotBids.forEach((bid) => {\n\t\t\tif (isValidPrice(bid) && bid.status !== 'rendered') {\n\t\t\t\tconst { bidderCode, cpm } = bid;\n\t\t\t\tconst cmpPrice = Math.max(bestPrices[bidderCode] || 0, roundCpm(cpm, DEFAULT_MAX_CPM));\n\n\t\t\t\tif (cmpPrice > 0) {\n\t\t\t\t\tbestPrices[bidderCode] = cmpPrice.toFixed(2);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\treturn bestPrices;\n}\n\nexport function transformPriceFromBid(bid) {\n\tlet maxCpm = DEFAULT_MAX_CPM;\n\n\tif (videoBiddersCap50.includes(bid.bidderCode)) {\n\t\tmaxCpm = 50;\n\t}\n\n\treturn transformPriceFromCpm(bid.cpm, maxCpm);\n}\n","import { context } from '@wikia/ad-engine';\nimport { transformPriceFromBid } from './price-helper';\n\nconst dfpVideoBidders = [\n\t{ bidderCode: 'appnexusAst', contextKey: 'custom.appnexusDfp' },\n\t{ bidderCode: 'beachfront', contextKey: 'custom.beachfrontDfp' },\n\t{ bidderCode: 'lkqd', contextKey: 'custom.lkqdDfp' },\n\t{ bidderCode: 'rubicon', contextKey: 'custom.rubiconDfp' },\n\t{ bidderCode: 'pubmatic', contextKey: 'custom.pubmaticDfp' },\n];\n\nexport function getSettings() {\n\treturn {\n\t\tstandard: {\n\t\t\talwaysUseBid: false,\n\t\t\tadserverTargeting: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_bidder',\n\t\t\t\t\tval: ({ bidderCode }) => bidderCode,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_adid',\n\t\t\t\t\tval: ({ adId }) => adId,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_pb',\n\t\t\t\t\tval: (bidResponse) => transformPriceFromBid(bidResponse),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_size',\n\t\t\t\t\tval: ({ size }) => size,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_uuid',\n\t\t\t\t\tval: (bidResponse) => getBidderUuid(bidResponse),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t};\n}\n\nfunction getBidderUuid(bidResponse) {\n\tconst isVideo = dfpVideoBidders.some(\n\t\t(video) => bidResponse.bidderCode === video.bidderCode && context.get(video.contextKey),\n\t);\n\n\treturn isVideo ? bidResponse.videoCacheKey : 'disabled';\n}\n","import { decorate } from 'core-decorators';\nimport { context, events, utils } from '@wikia/ad-engine';\nimport { BaseBidder } from '../base-bidder';\nimport { getPriorities } from './adapters-registry';\nimport { getPrebidBestPrice } from './price-helper';\nimport { getSettings } from './prebid-settings';\nimport { getAvailableBidsByAdUnitCode, setupAdUnits } from './prebid-helper';\n\nfunction postponeExecutionUntilPbjsLoads(method) {\n\treturn function (...args) {\n\t\treturn window.pbjs.que.push(() => method.apply(this, args));\n\t};\n}\n\nevents.on(events.VIDEO_AD_IMPRESSION, markWinningBidAsUsed);\nevents.on(events.VIDEO_AD_ERROR, markWinningBidAsUsed);\n\nfunction markWinningBidAsUsed(adSlot) {\n\t// Mark ad as rendered\n\tconst adId = context.get(`slots.${adSlot.getSlotName()}.targeting.hb_adid`);\n\n\tif (adId) {\n\t\tif (window.pbjs && typeof window.pbjs.markWinningBidAsUsed === 'function') {\n\t\t\twindow.pbjs.markWinningBidAsUsed({ adId });\n\t\t\tevents.emit(events.VIDEO_AD_USED, adSlot);\n\t\t}\n\t}\n}\n\nconst logGroup = 'prebid';\n\nlet loaded = false;\n\nwindow.pbjs = window.pbjs || {};\nwindow.pbjs.que = window.pbjs.que || [];\n\nexport class Prebid extends BaseBidder {\n\tstatic validResponseStatusCode = 1;\n\tstatic errorResponseStatusCode = 2;\n\n\tconstructor(bidderConfig, timeout = 2000) {\n\t\tsuper('prebid', bidderConfig, timeout);\n\n\t\tthis.insertScript();\n\n\t\tthis.lazyLoaded = false;\n\t\tthis.isLazyLoadingEnabled = this.bidderConfig.lazyLoadingEnabled;\n\t\tthis.isCMPEnabled = context.get('custom.isCMPEnabled');\n\t\tthis.adUnits = setupAdUnits(this.bidderConfig, this.isLazyLoadingEnabled ? 'pre' : 'off');\n\t\tthis.prebidConfig = {\n\t\t\tdebug:\n\t\t\t\tutils.queryString.get('pbjs_debug') === '1' ||\n\t\t\t\tutils.queryString.get('pbjs_debug') === 'true',\n\t\t\tenableSendAllBids: true,\n\t\t\tbidderSequence: 'random',\n\t\t\tbidderTimeout: this.timeout,\n\t\t\tcache: {\n\t\t\t\turl: 'https://prebid.adnxs.com/pbc/v1/cache',\n\t\t\t},\n\t\t\tuserSync: {\n\t\t\t\tiframeEnabled: true,\n\t\t\t\tenabledBidders: [],\n\t\t\t\tsyncDelay: 6000,\n\t\t\t},\n\t\t};\n\t\tthis.bidsRefreshing = context.get('bidders.prebid.bidsRefreshing');\n\n\t\tif (this.isCMPEnabled) {\n\t\t\tthis.prebidConfig.consentManagement = {\n\t\t\t\tcmpApi: 'iab',\n\t\t\t\ttimeout: this.timeout,\n\t\t\t\tallowAuctionWithoutConsent: false,\n\t\t\t};\n\t\t}\n\n\t\twindow.pbjs = window.pbjs || {};\n\t\twindow.pbjs.que = window.pbjs.que || [];\n\n\t\tthis.applyConfig(this.prebidConfig);\n\n\t\tif (this.bidsRefreshing && this.bidsRefreshing.enabled) {\n\t\t\tthis.registerBidsRefreshing();\n\t\t}\n\t}\n\n\t@decorate(postponeExecutionUntilPbjsLoads)\n\tapplyConfig(config) {\n\t\twindow.pbjs.setConfig(config);\n\t}\n\n\t@decorate(postponeExecutionUntilPbjsLoads)\n\tapplySettings() {\n\t\twindow.pbjs.bidderSettings = getSettings();\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tcallBids(bidsBackHandler) {\n\t\tif (!this.adUnits) {\n\t\t\tthis.adUnits = setupAdUnits(this.bidderConfig, this.isLazyLoadingEnabled ? 'pre' : 'off');\n\t\t}\n\n\t\tif (this.adUnits.length > 0) {\n\t\t\tthis.applySettings();\n\t\t\tthis.requestBids(this.adUnits, bidsBackHandler, this.removeAdUnits);\n\t\t}\n\n\t\tif (this.isLazyLoadingEnabled) {\n\t\t\tevents.on(events.PREBID_LAZY_CALL, () => {\n\t\t\t\tthis.lazyCall(bidsBackHandler);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\tinsertScript() {\n\t\tif (loaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst libraryUrl = context.get('bidders.prebid.libraryUrl');\n\n\t\tif (!libraryUrl) {\n\t\t\tutils.logger(\n\t\t\t\tlogGroup,\n\t\t\t\t'Prebid library URL not defined. Assuming that window.pbjs will be loaded.',\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\n\t\tutils.scriptLoader.loadScript(libraryUrl, 'text/javascript', true, 'first');\n\t\tloaded = true;\n\t}\n\n\tlazyCall(bidsBackHandler) {\n\t\tif (this.lazyLoaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.lazyLoaded = true;\n\n\t\tconst adUnitsLazy = setupAdUnits(this.bidderConfig, 'post');\n\n\t\tif (adUnitsLazy.length > 0) {\n\t\t\tthis.requestBids(adUnitsLazy, bidsBackHandler);\n\n\t\t\tthis.adUnits = this.adUnits.concat(adUnitsLazy);\n\t\t}\n\t}\n\n\tremoveAdUnits() {\n\t\t(window.pbjs.adUnits || []).forEach((adUnit) => {\n\t\t\twindow.pbjs.removeAdUnit(adUnit.code);\n\t\t});\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tgetBestPrice(slotName) {\n\t\tconst slotAlias = this.getSlotAlias(slotName);\n\n\t\treturn getPrebidBestPrice(slotAlias);\n\t}\n\n\tgetTargetingKeysToReset() {\n\t\treturn ['hb_bidder', 'hb_adid', 'hb_pb', 'hb_size', 'hb_uuid'];\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tgetTargetingParams(slotName) {\n\t\tlet slotParams = {};\n\n\t\tconst slotAlias = this.getSlotAlias(slotName);\n\t\tconst bids = getAvailableBidsByAdUnitCode(slotAlias);\n\n\t\tif (bids.length) {\n\t\t\tlet bidParams = null;\n\t\t\tconst priorities = getPriorities();\n\n\t\t\tbids.forEach((param) => {\n\t\t\t\tif (!bidParams) {\n\t\t\t\t\tbidParams = param;\n\t\t\t\t} else if (bidParams.cpm === param.cpm) {\n\t\t\t\t\tif (priorities[bidParams.bidder] === priorities[param.bidder]) {\n\t\t\t\t\t\tbidParams = bidParams.timeToRespond > param.timeToRespond ? param : bidParams;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbidParams = priorities[bidParams.bidder] < priorities[param.bidder] ? param : bidParams;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tbidParams = bidParams.cpm < param.cpm ? param : bidParams;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (bidParams) {\n\t\t\t\tslotParams = bidParams.adserverTargeting;\n\t\t\t}\n\n\t\t\t// ADEN-7436: AppNexus hb_uuid fix\n\t\t\t// (adserverTargeting params are being set before cache key is returned)\n\t\t\tslotParams.hb_uuid = slotParams.hb_uuid || bidParams.videoCacheKey || 'disabled';\n\t\t}\n\n\t\treturn slotParams || {};\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tisSupported(slotName) {\n\t\tconst slotAlias = this.getSlotAlias(slotName);\n\n\t\treturn this.adUnits && this.adUnits.some((adUnit) => adUnit.code === slotAlias);\n\t}\n\n\tregisterBidsRefreshing() {\n\t\twindow.pbjs.que.push(() => {\n\t\t\tconst refreshUsedBid = (winningBid) => {\n\t\t\t\tif (this.bidsRefreshing.slots.indexOf(winningBid.adUnitCode) !== -1) {\n\t\t\t\t\tevents.emit(events.BIDS_REFRESH);\n\t\t\t\t\tconst adUnitsToRefresh = this.adUnits.filter(\n\t\t\t\t\t\t(adUnit) =>\n\t\t\t\t\t\t\tadUnit.code === winningBid.adUnitCode &&\n\t\t\t\t\t\t\tadUnit.bids &&\n\t\t\t\t\t\t\tadUnit.bids[0] &&\n\t\t\t\t\t\t\tadUnit.bids[0].bidder === winningBid.bidderCode,\n\t\t\t\t\t);\n\n\t\t\t\t\tthis.requestBids(adUnitsToRefresh, this.bidsRefreshing.bidsBackHandler);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\twindow.pbjs.onEvent('bidWon', refreshUsedBid);\n\t\t\tevents.once(events.PAGE_CHANGE_EVENT, () => {\n\t\t\t\twindow.pbjs.offEvent('bidWon', refreshUsedBid);\n\t\t\t});\n\t\t});\n\t}\n\n\t@decorate(postponeExecutionUntilPbjsLoads)\n\trequestBids(adUnits, bidsBackHandler, withRemove = undefined) {\n\t\tif (withRemove) {\n\t\t\twithRemove();\n\t\t}\n\n\t\twindow.pbjs.requestBids({\n\t\t\tadUnits,\n\t\t\tbidsBackHandler,\n\t\t});\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tcalculatePrices() {\n\t\treturn null;\n\t}\n}\n","import { context, events, utils } from '@wikia/ad-engine';\nimport { A9 } from './a9';\nimport { Prebid } from './prebid';\nimport * as prebidHelper from './prebid/prebid-helper';\nimport { transformPriceFromBid } from './prebid/price-helper';\n\nconst biddersRegistry = {};\nconst realSlotPrices = {};\nconst logGroup = 'bidders';\n\nevents.on(events.VIDEO_AD_REQUESTED, (adSlot) => {\n\tadSlot.updateWinningPbBidderDetails();\n});\n\nevents.on(events.VIDEO_AD_USED, (adSlot) => {\n\tupdateSlotTargeting(adSlot.getSlotName());\n});\n\nfunction applyTargetingParams(slotName, targeting) {\n\tObject.keys(targeting).forEach((key) =>\n\t\tcontext.set(`slots.${slotName}.targeting.${key}`, targeting[key]),\n\t);\n}\n\n/**\n * Executes callback function on each enabled bidder\n *\n * @param {function} callback\n */\nfunction forEachBidder(callback) {\n\tObject.keys(biddersRegistry).forEach((bidderName) => {\n\t\tcallback(biddersRegistry[bidderName]);\n\t});\n}\n\nfunction getBidParameters(slotName) {\n\tconst slotParams = {};\n\n\tforEachBidder((bidder) => {\n\t\tif (bidder && bidder.wasCalled()) {\n\t\t\tconst params = bidder.getSlotTargetingParams(slotName);\n\n\t\t\tObject.assign(slotParams, params);\n\t\t}\n\t});\n\n\treturn slotParams;\n}\n\nfunction getCurrentSlotPrices(slotName) {\n\tconst slotPrices = {};\n\n\tforEachBidder((bidder) => {\n\t\tif (bidder && bidder.isSlotSupported(slotName)) {\n\t\t\tconst priceFromBidder = bidder.getSlotBestPrice(slotName);\n\n\t\t\tObject.keys(priceFromBidder).forEach((bidderName) => {\n\t\t\t\tslotPrices[bidderName] = priceFromBidder[bidderName];\n\t\t\t});\n\t\t}\n\t});\n\n\treturn slotPrices;\n}\n\nfunction getDfpSlotPrices(slotName) {\n\treturn realSlotPrices[slotName] || {};\n}\n\n/**\n * Returns true if all bidders replied\n *\n * @returns {boolean}\n */\nfunction hasAllResponses() {\n\tconst missingBidders = Object.keys(biddersRegistry).filter((bidderName) => {\n\t\tconst bidder = biddersRegistry[bidderName];\n\n\t\treturn !bidder.hasResponse();\n\t});\n\n\treturn missingBidders.length === 0;\n}\n\nfunction resetTargetingKeys(slotName) {\n\tforEachBidder((bidder) => {\n\t\tbidder.getTargetingKeysToReset().forEach((key) => {\n\t\t\tcontext.remove(`slots.${slotName}.targeting.${key}`);\n\t\t});\n\t});\n\n\tutils.logger(logGroup, 'resetTargetingKeys', slotName);\n}\n\nfunction requestBids({ responseListener = null }) {\n\tconst config = context.get('bidders');\n\n\tif (config.prebid && config.prebid.enabled) {\n\t\tbiddersRegistry.prebid = new Prebid(config.prebid, config.timeout);\n\t}\n\n\tif (config.a9 && config.a9.enabled) {\n\t\tbiddersRegistry.a9 = new A9(config.a9, config.timeout);\n\t}\n\n\tforEachBidder((bidder) => {\n\t\tif (responseListener) {\n\t\t\tbidder.addResponseListener(responseListener);\n\t\t}\n\n\t\tbidder.call();\n\t});\n}\n\n/**\n * Executes callback function if bidding is finished or timeout is reached\n *\n * @param {function} callback\n *\n * @returns {Promise}\n */\nfunction runOnBiddingReady(callback) {\n\tconst responses = [];\n\n\tforEachBidder((bidder) => {\n\t\tresponses.push(bidder.waitForResponse());\n\t});\n\n\treturn Promise.all(responses).then(callback);\n}\n\nfunction storeRealSlotPrices(slotName) {\n\trealSlotPrices[slotName] = getCurrentSlotPrices(slotName);\n}\n\nfunction updateSlotTargeting(slotName) {\n\tconst bidderTargeting = getBidParameters(slotName);\n\n\tstoreRealSlotPrices(slotName);\n\n\tresetTargetingKeys(slotName);\n\tapplyTargetingParams(slotName, bidderTargeting);\n\n\tutils.logger(logGroup, 'updateSlotTargeting', slotName, bidderTargeting);\n\n\treturn bidderTargeting;\n}\n\nexport const bidders = {\n\tgetBidParameters,\n\tgetCurrentSlotPrices,\n\tgetDfpSlotPrices,\n\thasAllResponses,\n\tprebidHelper,\n\trequestBids,\n\trunOnBiddingReady,\n\ttransformPriceFromBid,\n\tupdateSlotTargeting,\n};\n\nexport * from './wrappers';\n"],"sourceRoot":""}
=======
{"version":3,"sources":["webpack://adEngine/webpack/bootstrap","webpack://adEngine/external \"@wikia/ad-engine\"","webpack://adEngine/external \"@babel/runtime-corejs2/helpers/createClass\"","webpack://adEngine/external \"@babel/runtime-corejs2/helpers/classCallCheck\"","webpack://adEngine/external \"@babel/runtime-corejs2/helpers/inherits\"","webpack://adEngine/external \"@babel/runtime-corejs2/helpers/getPrototypeOf\"","webpack://adEngine/external \"@babel/runtime-corejs2/helpers/possibleConstructorReturn\"","webpack://adEngine/external \"@babel/runtime-corejs2/core-js/object/keys\"","webpack://adEngine/external \"@babel/runtime-corejs2/core-js/parse-int\"","webpack://adEngine/external \"@babel/runtime-corejs2/helpers/assertThisInitialized\"","webpack://adEngine/external \"@babel/runtime-corejs2/helpers/slicedToArray\"","webpack://adEngine/external \"@babel/runtime-corejs2/core-js/object/assign\"","webpack://adEngine/external \"core-decorators\"","webpack://adEngine/external \"@babel/runtime-corejs2/helpers/applyDecoratedDescriptor\"","webpack://adEngine/external \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\"","webpack://adEngine/external \"@babel/runtime-corejs2/helpers/objectSpread\"","webpack://adEngine/external \"@babel/runtime-corejs2/core-js/promise\"","webpack://adEngine/./src/ad-bidders/base-bidder.ts","webpack://adEngine/./src/ad-bidders/a9/index.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/base-adapter.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/aol.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/appnexus.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/appnexus-ast.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/audience-network.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/beachfront.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/index-exchange.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/kargo.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/lkqd.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/onemobile.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/openx.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/pubmatic.ts","webpack://adEngine/./src/ad-bidders/prebid/prebid-helper.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/rubicon.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/rubicon-display.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/wikia.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters/wikia-video.ts","webpack://adEngine/./src/ad-bidders/prebid/adapters-registry.ts","webpack://adEngine/./src/ad-bidders/prebid/price-helper.ts","webpack://adEngine/./src/ad-bidders/prebid/prebid-settings.ts","webpack://adEngine/./src/ad-bidders/prebid/index.ts","webpack://adEngine/./src/ad-bidders/index.ts"],"names":["BaseBidder","name","bidderConfig","timeout","logGroup","resetState","onResponse","onResponseCall","utils","logger","callback","onResponseCallbacks","push","response","called","callBids","slotName","context","get","getBestPrice","isSlotSupported","getTargetingParams","isSupported","calculatePrices","flush","LazyQueue","onItemFlush","createWithTimeout","resolve","hasResponse","addResponseListener","loaded","A9","isCMPEnabled","amazonId","slots","slotsNames","bids","priceMap","slotNamesMap","targetingKeys","bidsRefreshing","isBidsRefreshingEnabled","enabled","isRenderImpOverwritten","forEach","amznbid","window","__cmp","consentData","init","insertScript","configureApstag","apsConfig","pubID","videoAdServer","deals","dealsEnabled","gdpr","gdprApplies","consent","cmpTimeout","apstag","a9Slots","getA9SlotsDefinitions","fetchBids","refresh","currentBids","overwriteRenderImp","bid","slotID","bidTargeting","keys","helpers","targeting","key","indexOf","eventService","emit","events","BIDS_REFRESH","_Q","args","configureApstagCommand","command","slotAlias","getSlotAlias","a9","scriptLoader","loadScript","renderImp","original","doc","impId","slot","getRenderedSlot","getSlotName","refreshBid","includes","renderedSlot","slotService","getTargeting","amzniid","shouldRefreshSlot","slotDef","createSlotDefinition","map","filter","config","slotId","definition","getState","videoEnabled","type","mediaType","sizes","BaseAdapter","prepareConfigForAdUnit","Aol","options","bidderName","network","code","placement","alias","sizeId","mediaTypes","banner","bidder","params","Appnexus","placements","position","placementId","getPlacement","vertical","AppnexusAst","aliases","appnexus","debugPlacementId","isDebugMode","queryString","video","playerSize","skippable","playback_method","AudienceNetwork","testMode","Beachfront","bidfloor","debugAppId","appId","IndexExchange","ix","siteId","size","Kargo","Lkqd","pageurl","location","hostname","output","Onemobile","pos","dcn","Openx","delDomain","unit","Pubmatic","publisherId","ids","toLowerCase","getVideoConfig","getStandardConfig","videoParams","mimes","minduration","maxduration","startdelay","playbackmethod","protocols","linearity","getBids","adSlot","lazyLoadSlots","isSlotApplicable","lazyLoad","isSlotLazy","setupAdUnits","adaptersConfig","adUnits","adapters","getAdapters","adapter","adapterAdUnits","prepareAdUnits","adUnit","getBidByAdId","adId","pbjs","getBidResponses","getAllPrebidWinningBids","length","responses","adUnitsBids","concat","getAvailableBidsByAdUnitCode","adUnitCode","getBidResponsesForAdUnitCode","status","getPrebid","getWinningVideoBidBySlotName","allowedBidders","canUseThisBidder","bidderCode","hasVast","vastUrl","vastContent","cpm","reduce","previousBid","currentBid","pushPrebid","que","Rubicon","accountId","zoneId","inventory","playerWidth","playerHeight","size_id","language","lang","RubiconDisplay","rubicon","pageTargeting","keywords","price","limit","useRandomPrice","Wikia","create","supportedMediaTypes","Math","floor","random","bidRequest","addBidResponse","done","addBids","setTimeout","bidResponse","createBid","width","height","getPrice","ad","getCreative","ttl","creative","document","createElement","style","background","color","fontFamily","textAlign","title","innerText","fontWeight","margin","paddingTop","details","join","appendChild","outerHTML","WikiaVideo","buildVastUrl","videoAdUnitId","customParams","creativeId","getVastUrl","videoCacheKey","customAdapters","availableAdapters","aol","appnexusAst","audienceNetwork","beachfront","indexExchange","kargo","lkqd","onemobile","openx","pubmatic","rubiconDisplay","registerAliases","aliasMap","aliasBidder","setupAdapters","bidders","setupCustomAdapters","wikia","wikiaVideo","registerBidAdapter","getPriorities","priorities","priority","DEFAULT_MAX_CPM","videoBiddersCap50","isValidPrice","getStatusCode","Prebid","validResponseStatusCode","roundCpm","maxCpm","result","transformPriceFromCpm","max","toFixed","getPrebidBestPrice","bestPrices","slotBids","cmpPrice","transformPriceFromBid","dfpVideoBidders","contextKey","getSettings","standard","alwaysUseBid","adserverTargeting","val","getBidderUuid","isVideo","some","postponeExecutionUntilPbjsLoads","method","apply","on","VIDEO_AD_IMPRESSION","markWinningBidAsUsed","VIDEO_AD_ERROR","VIDEO_AD_USED","decorate","lazyLoaded","isLazyLoadingEnabled","lazyLoadingEnabled","prebidConfig","debug","enableSendAllBids","bidderSequence","bidderTimeout","cache","url","userSync","iframeEnabled","enabledBidders","syncDelay","consentManagement","cmpApi","allowAuctionWithoutConsent","applyConfig","registerBidsRefreshing","setConfig","bidderSettings","bidsBackHandler","applySettings","requestBids","removeAdUnits","PREBID_LAZY_CALL","lazyCall","libraryUrl","adUnitsLazy","removeAdUnit","slotParams","bidParams","param","timeToRespond","hb_uuid","refreshUsedBid","winningBid","adUnitsToRefresh","onEvent","once","PAGE_CHANGE_EVENT","offEvent","withRemove","undefined","errorResponseStatusCode","biddersRegistry","realSlotPrices","VIDEO_AD_REQUESTED","updateWinningPbBidderDetails","updateSlotTargeting","applyTargetingParams","set","forEachBidder","getBidParameters","wasCalled","getSlotTargetingParams","getCurrentSlotPrices","slotPrices","priceFromBidder","getSlotBestPrice","getDfpSlotPrices","hasAllResponses","missingBidders","resetTargetingKeys","getTargetingKeysToReset","remove","responseListener","prebid","call","runOnBiddingReady","waitForResponse","all","then","storeRealSlotPrices","bidderTargeting","prebidHelper"],"mappings":"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","file":"ad-bidders.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 16);\n","module.exports = require(\"@wikia/ad-engine\");","module.exports = require(\"@babel/runtime-corejs2/helpers/createClass\");","module.exports = require(\"@babel/runtime-corejs2/helpers/classCallCheck\");","module.exports = require(\"@babel/runtime-corejs2/helpers/inherits\");","module.exports = require(\"@babel/runtime-corejs2/helpers/getPrototypeOf\");","module.exports = require(\"@babel/runtime-corejs2/helpers/possibleConstructorReturn\");","module.exports = require(\"@babel/runtime-corejs2/core-js/object/keys\");","module.exports = require(\"@babel/runtime-corejs2/core-js/parse-int\");","module.exports = require(\"@babel/runtime-corejs2/helpers/assertThisInitialized\");","module.exports = require(\"@babel/runtime-corejs2/helpers/slicedToArray\");","module.exports = require(\"@babel/runtime-corejs2/core-js/object/assign\");","module.exports = require(\"core-decorators\");","module.exports = require(\"@babel/runtime-corejs2/helpers/applyDecoratedDescriptor\");","module.exports = require(\"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\");","module.exports = require(\"@babel/runtime-corejs2/helpers/objectSpread\");","module.exports = require(\"@babel/runtime-corejs2/core-js/promise\");","import { context, utils } from '@wikia/ad-engine';\n\nexport class BaseBidder {\n\tconstructor(name, bidderConfig, timeout = 2000) {\n\t\tthis.name = name;\n\t\tthis.logGroup = `${name}-bidder`;\n\t\tthis.bidderConfig = bidderConfig;\n\t\tthis.timeout = timeout;\n\n\t\tthis.resetState();\n\t\tthis.onResponse = () => this.onResponseCall();\n\n\t\tutils.logger(this.logGroup, 'created');\n\t}\n\n\taddResponseListener(callback) {\n\t\tthis.onResponseCallbacks.push(callback);\n\t}\n\n\tcall() {\n\t\tthis.response = false;\n\t\tthis.called = true;\n\n\t\tif (this.callBids) {\n\t\t\tthis.callBids(this.onResponse);\n\t\t}\n\n\t\tutils.logger(this.logGroup, 'called');\n\t}\n\n\t/**\n\t * Returns bidder slot alias if available, otherwise slot name\n\t *\n\t * @param {string} slotName\n\t *\n\t * @returns {string}\n\t */\n\tgetSlotAlias(slotName) {\n\t\treturn context.get(`slots.${slotName}.bidderAlias`) || slotName;\n\t}\n\n\tgetSlotBestPrice(slotName) {\n\t\tif (this.getBestPrice) {\n\t\t\treturn this.getBestPrice(slotName);\n\t\t}\n\n\t\treturn {};\n\t}\n\n\tgetSlotTargetingParams(slotName) {\n\t\tif (!this.called || !this.isSlotSupported(slotName) || !this.getTargetingParams) {\n\t\t\treturn {};\n\t\t}\n\n\t\treturn this.getTargetingParams(slotName);\n\t}\n\n\thasResponse() {\n\t\treturn this.response;\n\t}\n\n\tisSupported() {\n\t\treturn false;\n\t}\n\n\tisSlotSupported(slotName) {\n\t\treturn this.isSupported(slotName);\n\t}\n\n\tonResponseCall() {\n\t\tthis.response = true;\n\n\t\tif (this.calculatePrices) {\n\t\t\tthis.calculatePrices();\n\t\t}\n\n\t\tthis.onResponseCallbacks.flush();\n\t\tutils.logger(this.logGroup, 'respond');\n\t}\n\n\tresetState() {\n\t\tthis.called = false;\n\t\tthis.response = false;\n\n\t\tthis.onResponseCallbacks = new utils.LazyQueue();\n\t\tthis.onResponseCallbacks.onItemFlush((callback) => {\n\t\t\tcallback(this.name);\n\t\t});\n\t}\n\n\t/**\n\t * Fires the Promise if bidder replied or timeout is reached\n\t *\n\t * @returns {Promise}\n\t */\n\twaitForResponse() {\n\t\treturn utils.createWithTimeout((resolve) => {\n\t\t\tif (this.hasResponse()) {\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\tthis.addResponseListener(resolve);\n\t\t\t}\n\t\t}, this.timeout);\n\t}\n\n\t/**\n\t * Check if bidder was called\n\t *\n\t * @returns {boolean}\n\t */\n\twasCalled() {\n\t\treturn this.called;\n\t}\n}\n","import { context, events, eventService, slotService, utils } from '@wikia/ad-engine';\nimport { BaseBidder } from '../base-bidder';\n\n/**\n * @typedef {Object} A9SlotDefinition\n * @property {string} slotID\n * @property {string} slotName\n */\n\nlet loaded = false;\nconst logGroup = 'A9';\n\nexport class A9 extends BaseBidder {\n\tconstructor(bidderConfig, timeout = 2000) {\n\t\tsuper('a9', bidderConfig, timeout);\n\n\t\tthis.isCMPEnabled = context.get('custom.isCMPEnabled');\n\t\tthis.amazonId = this.bidderConfig.amazonId;\n\t\tthis.slots = this.bidderConfig.slots;\n\t\tthis.slotsNames = Object.keys(this.slots);\n\t\tthis.bids = {};\n\t\tthis.priceMap = {};\n\t\tthis.slotNamesMap = {};\n\t\tthis.targetingKeys = [];\n\t\tthis.timeout = timeout;\n\t\tthis.bidsRefreshing = context.get('bidders.a9.bidsRefreshing');\n\t\tthis.isBidsRefreshingEnabled = this.bidsRefreshing && this.bidsRefreshing.enabled;\n\t\tthis.isRenderImpOverwritten = false;\n\t}\n\n\tcalculatePrices() {\n\t\tObject.keys(this.bids).forEach((slotName) => {\n\t\t\tthis.priceMap[slotName] = this.bids[slotName].amznbid;\n\t\t});\n\t}\n\n\tcallBids() {\n\t\tif (window.__cmp) {\n\t\t\twindow.__cmp('getConsentData', null, (consentData) => {\n\t\t\t\tthis.init(consentData);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.init();\n\t\t}\n\t}\n\n\tinit(consentData = {}) {\n\t\tif (!loaded) {\n\t\t\tthis.insertScript();\n\t\t\tthis.configureApstag();\n\n\t\t\tconst apsConfig = {\n\t\t\t\tpubID: this.amazonId,\n\t\t\t\tvideoAdServer: 'DFP',\n\t\t\t\tdeals: !!this.bidderConfig.dealsEnabled,\n\t\t\t};\n\n\t\t\tif (this.isCMPEnabled && consentData && consentData.consentData) {\n\t\t\t\tapsConfig.gdpr = {\n\t\t\t\t\tenabled: consentData.gdprApplies,\n\t\t\t\t\tconsent: consentData.consentData,\n\t\t\t\t\tcmpTimeout: 5000,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\twindow.apstag.init(apsConfig);\n\n\t\t\tloaded = true;\n\t\t}\n\n\t\tthis.bids = {};\n\t\tthis.priceMap = {};\n\n\t\tconst a9Slots = this.getA9SlotsDefinitions(this.slotsNames);\n\n\t\tthis.fetchBids(a9Slots);\n\t}\n\n\t/**\n\t * Fetches bids from A9.\n\t *\n\t * Calls this.onResponse() upon success.\n\t *\n\t * @param {A9SlotDefinition[]} slots\n\t */\n\tfetchBids(slots, refresh = false) {\n\t\tutils.logger(logGroup, 'fetching bids for slots', slots);\n\t\twindow.apstag.fetchBids(\n\t\t\t{\n\t\t\t\tslots,\n\t\t\t\ttimeout: this.timeout,\n\t\t\t},\n\t\t\t(currentBids) => {\n\t\t\t\tutils.logger(logGroup, 'bids fetched for slots', slots, 'bids', currentBids);\n\t\t\t\t// overwrite window.apstag.renderImp on the first fetch\n\t\t\t\tif (!this.isRenderImpOverwritten) {\n\t\t\t\t\tthis.overwriteRenderImp();\n\t\t\t\t\tthis.isRenderImpOverwritten = true;\n\t\t\t\t}\n\t\t\t\tcurrentBids.forEach((bid) => {\n\t\t\t\t\tconst slotName = this.slotNamesMap[bid.slotID] || bid.slotID;\n\n\t\t\t\t\tlet bidTargeting = bid;\n\t\t\t\t\tlet keys = window.apstag.targetingKeys();\n\n\t\t\t\t\tif (this.bidderConfig.dealsEnabled) {\n\t\t\t\t\t\tkeys = bid.helpers.targetingKeys;\n\t\t\t\t\t\tbidTargeting = bid.targeting;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.bids[slotName] = {};\n\t\t\t\t\tkeys.forEach((key) => {\n\t\t\t\t\t\tif (this.targetingKeys.indexOf(key) === -1) {\n\t\t\t\t\t\t\tthis.targetingKeys.push(key);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.bids[slotName][key] = bidTargeting[key];\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tthis.onResponse();\n\t\t\t\tif (refresh) {\n\t\t\t\t\teventService.emit(events.BIDS_REFRESH);\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\tconfigureApstag() {\n\t\twindow.apstag = window.apstag || {};\n\t\twindow.apstag._Q = window.apstag._Q || [];\n\n\t\tif (typeof window.apstag.init === 'undefined') {\n\t\t\twindow.apstag.init = (...args) => {\n\t\t\t\tthis.configureApstagCommand('i', args);\n\t\t\t};\n\t\t}\n\n\t\tif (typeof window.apstag.fetchBids === 'undefined') {\n\t\t\twindow.apstag.fetchBids = (...args) => {\n\t\t\t\tthis.configureApstagCommand('f', args);\n\t\t\t};\n\t\t}\n\t}\n\n\tconfigureApstagCommand(command, args) {\n\t\twindow.apstag._Q.push([command, args]);\n\t}\n\n\tgetBestPrice(slotName) {\n\t\tconst slotAlias = this.getSlotAlias(slotName);\n\n\t\treturn this.priceMap[slotAlias] ? { a9: this.priceMap[slotAlias] } : {};\n\t}\n\n\tgetPrices() {\n\t\treturn this.priceMap;\n\t}\n\n\tgetTargetingKeysToReset() {\n\t\treturn this.targetingKeys;\n\t}\n\n\tgetTargetingParams(slotName) {\n\t\treturn this.bids[this.getSlotAlias(slotName)] || {};\n\t}\n\n\tinsertScript() {\n\t\tutils.scriptLoader.loadScript(\n\t\t\t'//c.amazon-adsystem.com/aax2/apstag.js',\n\t\t\t'text/javascript',\n\t\t\ttrue,\n\t\t\t'first',\n\t\t);\n\t}\n\n\t/**\n\t * Wraps apstag.renderImp\n\t *\n\t * Calls this.refreshBid() if bids refreshing is enabled.\n\t */\n\toverwriteRenderImp() {\n\t\tutils.logger(logGroup, 'overwriting window.apstag.renderImp');\n\t\twindow.apstag.renderImp = ((original) => (doc, impId) => {\n\t\t\toriginal(doc, impId);\n\n\t\t\tconst slot = this.getRenderedSlot(impId);\n\t\t\tconst slotName = slot.getSlotName();\n\n\t\t\tutils.logger(logGroup, `bid used for slot ${slotName}`);\n\t\t\tdelete this.bids[this.getSlotAlias(slotName)];\n\n\t\t\tif (window.apstag.renderImp && this.isBidsRefreshingEnabled) {\n\t\t\t\tthis.refreshBid(slot);\n\t\t\t}\n\t\t})(window.apstag.renderImp);\n\t}\n\n\t/**\n\t * Checks if slot with given name is supported by bidder.\n\t *\n\t * @param {string} slotName\n\t * @returns {boolean}\n\t */\n\tisSupported(slotName) {\n\t\treturn !!this.slots[this.getSlotAlias(slotName)];\n\t}\n\n\t/**\n\t * Checks if slot should be refreshed.\n\t *\n\t * @param {AdSlot} slot\n\t * @returns {boolean}\n\t */\n\tshouldRefreshSlot(slot) {\n\t\treturn this.bidsRefreshing.slots.includes(this.getSlotAlias(slot.getSlotName()));\n\t}\n\n\t/**\n\t * Returns slot which used bid with given impression id.\n\t *\n\t * @param {string | number} impId\n\t * @returns {AdSlot | undefined }\n\t */\n\tgetRenderedSlot(impId) {\n\t\tlet renderedSlot;\n\n\t\tslotService.forEach((slot) => {\n\t\t\tif (slot.getTargeting().amzniid === impId) {\n\t\t\t\trenderedSlot = slot;\n\t\t\t}\n\t\t});\n\n\t\treturn renderedSlot;\n\t}\n\n\t/**\n\t * Refreshes bid for given slot.\n\t *\n\t * @param {string | number} impId\n\t */\n\trefreshBid(slot) {\n\t\tif (!this.shouldRefreshSlot(slot)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst slotDef = this.createSlotDefinition(this.getSlotAlias(slot.getSlotName()));\n\n\t\tif (slotDef) {\n\t\t\tutils.logger(logGroup, 'refresh bids for slot', slotDef);\n\t\t\tthis.fetchBids([slotDef], true);\n\t\t}\n\t}\n\n\t/**\n\t * Transforms slots names into A9 slot definitions.\n\t *\n\t * @param {string[]} slotsNames\n\t * @returns {A9SlotDefinition[]}\n\t */\n\tgetA9SlotsDefinitions(slotsNames) {\n\t\treturn slotsNames\n\t\t\t.map((slotName) => this.getSlotAlias(slotName))\n\t\t\t.map((slotAlias) => this.createSlotDefinition(slotAlias))\n\t\t\t.filter((slot) => slot !== null);\n\t}\n\n\t/**\n\t * Creates A9 slot definition from slot name.\n\t *\n\t * @param {string} slotName\n\t * @returns {A9SlotDefinition | null} Returns null i\n\t */\n\tcreateSlotDefinition(slotName) {\n\t\tconst config = this.slots[slotName];\n\t\tconst slotID = config.slotId || slotName;\n\t\tconst definition = {\n\t\t\tslotID,\n\t\t\tslotName: slotID,\n\t\t};\n\n\t\tif (!slotService.getState(slotID)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.slotNamesMap[slotID] = slotName;\n\n\t\tif (!this.bidderConfig.videoEnabled && config.type === 'video') {\n\t\t\treturn null;\n\t\t}\n\t\tif (config.type === 'video') {\n\t\t\tdefinition.mediaType = 'video';\n\t\t} else {\n\t\t\tdefinition.sizes = config.sizes;\n\t\t}\n\n\t\treturn definition;\n\t}\n}\n","export class BaseAdapter {\n\tconstructor({ enabled, slots }) {\n\t\tthis.enabled = enabled;\n\t\tthis.slots = slots;\n\t}\n\n\tprepareAdUnits() {\n\t\treturn Object.keys(this.slots).map((slotName) =>\n\t\t\tthis.prepareConfigForAdUnit(slotName, this.slots[slotName]),\n\t\t);\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Aol extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'aol';\n\t\tthis.network = options.network;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, placement, alias, sizeId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacement,\n\t\t\t\t\t\tnetwork: this.network,\n\t\t\t\t\t\talias,\n\t\t\t\t\t\tsizeId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { context } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class Appnexus extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'appnexus';\n\t\tthis.placements = options.placements;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, position = 'mobile' }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacementId: this.getPlacement(position),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tgetPlacement(position) {\n\t\tif (position === 'mobile') {\n\t\t\tconst vertical = context.get('targeting.mappedVerticalName');\n\n\t\t\tposition = vertical && this.placements[vertical] ? vertical : 'other';\n\t\t}\n\n\t\treturn this.placements[position];\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class AppnexusAst extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'appnexusAst';\n\t\tthis.aliases = {\n\t\t\tappnexus: [this.bidderName],\n\t\t};\n\t\tthis.debugPlacementId = options.debugPlacementId;\n\t\tthis.isDebugMode = utils.queryString.get('appnexusast_debug_mode') === '1';\n\t}\n\n\tprepareConfigForAdUnit(code, { placementId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tcontext: 'instream',\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacementId: this.isDebugMode ? this.debugPlacementId : placementId,\n\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\tskippable: false,\n\t\t\t\t\t\t\tplayback_method: ['auto_play_sound_off'],\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class AudienceNetwork extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'audienceNetwork';\n\t\tthis.testMode = utils.queryString.get('audiencenetworktest') === 'true';\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, placementId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\ttestMode: this.testMode,\n\t\t\t\t\t\tplacementId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nexport class Beachfront extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'beachfront';\n\t\tthis.bidfloor = 0.01;\n\t\tthis.debugAppId = options.debugAppId;\n\t\tthis.isDebugMode = utils.queryString.get('beachfront_debug_mode') === '1';\n\t}\n\n\tprepareConfigForAdUnit(code, { appId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tcontext: 'instream',\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tbidfloor: this.bidfloor,\n\t\t\t\t\t\tappId: this.isDebugMode ? this.debugAppId : appId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class IndexExchange extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'indexExchange';\n\t\tthis.aliases = {\n\t\t\tix: [this.bidderName],\n\t\t};\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, siteId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: sizes.map((size) => ({\n\t\t\t\tbidder: this.bidderName,\n\t\t\t\tparams: {\n\t\t\t\t\tsiteId,\n\t\t\t\t\tsize,\n\t\t\t\t},\n\t\t\t})),\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Kargo extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'kargo';\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, placementId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tsizes,\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tplacementId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Lkqd extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'lkqd';\n\t}\n\n\tprepareConfigForAdUnit(code, { placementId, siteId }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tsiteId,\n\t\t\t\t\t\tplacementId,\n\t\t\t\t\t\tpageurl: window.location.hostname,\n\t\t\t\t\t\toutput: 'svpaid',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Onemobile extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'onemobile';\n\t\tthis.siteId = options.siteId;\n\t}\n\n\tprepareConfigForAdUnit(code, { size, pos }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes: [size],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tdcn: this.siteId,\n\t\t\t\t\t\tpos,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Openx extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'openx';\n\t\tthis.delDomain = options.delDomain;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, unit }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tunit,\n\t\t\t\t\t\tdelDomain: this.delDomain,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { BaseAdapter } from './base-adapter';\n\nexport class Pubmatic extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'pubmatic';\n\t\tthis.publisherId = options.publisherId;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes, ids }) {\n\t\tswitch (code.toLowerCase()) {\n\t\t\tcase 'featured':\n\t\t\tcase 'incontent_player':\n\t\t\t\treturn this.getVideoConfig(code, ids);\n\t\t\tdefault:\n\t\t\t\treturn this.getStandardConfig(code, sizes, ids);\n\t\t}\n\t}\n\n\tgetVideoConfig(code, ids) {\n\t\tconst videoParams = {\n\t\t\tvideo: {\n\t\t\t\tmimes: ['video/mp4', 'video/x-flv', 'video/webm', 'video/ogg'],\n\t\t\t\tskippable: true,\n\t\t\t\tminduration: 1,\n\t\t\t\tmaxduration: 30,\n\t\t\t\tstartdelay: 0,\n\t\t\t\tplaybackmethod: [2, 3],\n\t\t\t\tprotocols: [2, 3, 5, 6],\n\t\t\t\tlinearity: 1,\n\t\t\t\tplacement: 1,\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t\tcontext: 'instream',\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: this.getBids(ids, videoParams),\n\t\t};\n\t}\n\n\tgetStandardConfig(code, sizes, ids) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: this.getBids(ids),\n\t\t};\n\t}\n\n\tgetBids(ids, params = {}) {\n\t\treturn ids.map((adSlot) => ({\n\t\t\tbidder: this.bidderName,\n\t\t\tparams: {\n\t\t\t\tadSlot,\n\t\t\t\tpublisherId: this.publisherId,\n\t\t\t\t...params,\n\t\t\t},\n\t\t}));\n\t}\n}\n","import { context, slotService } from '@wikia/ad-engine';\nimport { getAdapters } from './adapters-registry';\n\nconst lazyLoadSlots = ['bottom_leaderboard'];\n\nfunction isSlotApplicable(code, lazyLoad) {\n\tconst isSlotLazy = lazyLoadSlots.indexOf(code) !== -1;\n\n\tif (!slotService.getState(code)) {\n\t\treturn false;\n\t}\n\n\tif (\n\t\tlazyLoad !== 'off' &&\n\t\t((lazyLoad === 'pre' && isSlotLazy) || (lazyLoad === 'post' && !isSlotLazy))\n\t) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nexport function setupAdUnits(adaptersConfig, lazyLoad = 'off') {\n\tconst adUnits = [];\n\tconst adapters = getAdapters(adaptersConfig);\n\n\tadapters.forEach((adapter) => {\n\t\tif (adapter && adapter.enabled) {\n\t\t\tconst adapterAdUnits = adapter.prepareAdUnits();\n\n\t\t\tadapterAdUnits.forEach((adUnit) => {\n\t\t\t\tif (adUnit && isSlotApplicable(adUnit.code, lazyLoad)) {\n\t\t\t\t\tadUnits.push(adUnit);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\treturn adUnits;\n}\n\nexport function getBidByAdId(adId) {\n\tif (!window.pbjs || typeof window.pbjs.getBidResponses !== 'function') {\n\t\treturn null;\n\t}\n\n\tlet bids = window.pbjs.getAllPrebidWinningBids().filter((bid) => adId === bid.adId);\n\n\tif (!bids.length) {\n\t\tconst responses = window.pbjs.getBidResponses();\n\n\t\tObject.keys(responses).forEach((adUnit) => {\n\t\t\tconst adUnitsBids = responses[adUnit].bids.filter((bid) => adId === bid.adId);\n\n\t\t\tbids = bids.concat(adUnitsBids);\n\t\t});\n\t}\n\n\treturn bids.length ? bids[0] : null;\n}\n\nexport function getAvailableBidsByAdUnitCode(adUnitCode) {\n\tlet bids = [];\n\n\tif (window.pbjs && typeof window.pbjs.getBidResponsesForAdUnitCode === 'function') {\n\t\tbids = window.pbjs.getBidResponsesForAdUnitCode(adUnitCode).bids || [];\n\t\tbids = bids.filter((bid) => bid.status !== 'rendered');\n\t}\n\n\treturn bids;\n}\n\nexport function getPrebid() {\n\treturn window.pbjs;\n}\n\nexport function getTargeting(slotName) {\n\treturn Object.assign(\n\t\t{\n\t\t\tpos: [slotName],\n\t\t},\n\t\tcontext.get('bidders.prebid.targeting') || {},\n\t);\n}\n\nexport function getWinningVideoBidBySlotName(slotName, allowedBidders) {\n\tif (!window.pbjs || !window.pbjs.getBidResponsesForAdUnitCode) {\n\t\treturn null;\n\t}\n\n\tconst bids = window.pbjs.getBidResponsesForAdUnitCode(slotName).bids || [];\n\n\treturn bids\n\t\t.filter((bid) => {\n\t\t\tconst canUseThisBidder = !allowedBidders || allowedBidders.indexOf(bid.bidderCode) !== -1;\n\t\t\tconst hasVast = bid.vastUrl || bid.vastContent;\n\n\t\t\treturn canUseThisBidder && hasVast && bid.cpm > 0;\n\t\t})\n\t\t.reduce((previousBid, currentBid) => {\n\t\t\tif (previousBid === null || currentBid.cpm > previousBid.cpm) {\n\t\t\t\treturn currentBid;\n\t\t\t}\n\n\t\t\treturn previousBid;\n\t\t}, null);\n}\n\nexport function pushPrebid(callback) {\n\twindow.pbjs.que.push(callback);\n}\n","import { context } from '@wikia/ad-engine';\nimport { getTargeting } from '../prebid-helper';\nimport { BaseAdapter } from './base-adapter';\n\nexport class Rubicon extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'rubicon';\n\t\tthis.accountId = options.accountId;\n\t}\n\n\tprepareConfigForAdUnit(code, { siteId, zoneId, sizeId, position }) {\n\t\tif (code === 'featured' && !context.get('custom.rubiconInFV')) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst targeting = getTargeting(code);\n\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaType: 'video',\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t\tcontext: 'instream',\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\taccountId: this.accountId,\n\t\t\t\t\t\tsiteId,\n\t\t\t\t\t\tzoneId,\n\t\t\t\t\t\tname: code,\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\tinventory: targeting,\n\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\tplayerWidth: '640',\n\t\t\t\t\t\t\tplayerHeight: '480',\n\t\t\t\t\t\t\tsize_id: sizeId,\n\t\t\t\t\t\t\tlanguage: targeting.lang ? targeting.lang[0] : 'en',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { getTargeting } from '../prebid-helper';\nimport { BaseAdapter } from './base-adapter';\n\nexport class RubiconDisplay extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'rubicon_display';\n\t\tthis.aliases = {\n\t\t\trubicon: [this.bidderName],\n\t\t};\n\t\tthis.accountId = options.accountId;\n\t}\n\n\tprepareConfigForAdUnit(code, { siteId, zoneId, sizes, position, targeting }) {\n\t\tconst pageTargeting = getTargeting(code);\n\n\t\tObject.keys(targeting || {}).forEach((key) => {\n\t\t\tpageTargeting[key] = targeting[key];\n\t\t});\n\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\taccountId: this.accountId,\n\t\t\t\t\t\tsiteId,\n\t\t\t\t\t\tzoneId,\n\t\t\t\t\t\tname: code,\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\tkeywords: ['rp.fastlane'],\n\t\t\t\t\t\tinventory: pageTargeting,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nconst price = utils.queryString.get('wikia_adapter');\nconst limit = parseInt(utils.queryString.get('wikia_adapter_limit'), 10) || 99;\nconst timeout = parseInt(utils.queryString.get('wikia_adapter_timeout'), 10) || 0;\nconst useRandomPrice = utils.queryString.get('wikia_adapter_random') === '1';\n\nexport class Wikia extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'wikia';\n\t\tthis.enabled = !!price;\n\t\tthis.limit = limit;\n\t\tthis.useRandomPrice = useRandomPrice;\n\t\tthis.timeout = timeout;\n\n\t\tthis.create = () => this;\n\t}\n\n\tprepareConfigForAdUnit(code, { sizes }) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tbanner: {\n\t\t\t\t\tsizes,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tgetSpec() {\n\t\treturn {\n\t\t\tcode: this.bidderName,\n\t\t\tsupportedMediaTypes: ['banner'],\n\t\t};\n\t}\n\n\tgetPrice() {\n\t\tif (this.useRandomPrice) {\n\t\t\treturn Math.floor(Math.random() * 2000) / 100;\n\t\t}\n\n\t\treturn parseInt(price, 10) / 100;\n\t}\n\n\tcallBids(bidRequest, addBidResponse, done) {\n\t\twindow.pbjs.que.push(() => {\n\t\t\tthis.addBids(bidRequest, addBidResponse, done);\n\t\t});\n\t}\n\n\taddBids(bidRequest, addBidResponse, done) {\n\t\tsetTimeout(() => {\n\t\t\tbidRequest.bids.forEach((bid) => {\n\t\t\t\tif (this.limit === 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst bidResponse = window.pbjs.createBid(1);\n\t\t\t\tconst [width, height] = bid.sizes[0];\n\t\t\t\tconst cpm = this.getPrice();\n\n\t\t\t\tbidResponse.ad = this.getCreative(bid.sizes[0], cpm);\n\t\t\t\tbidResponse.bidderCode = bidRequest.bidderCode;\n\t\t\t\tbidResponse.cpm = cpm;\n\t\t\t\tbidResponse.ttl = 300;\n\t\t\t\tbidResponse.mediaType = 'banner';\n\t\t\t\tbidResponse.width = width;\n\t\t\t\tbidResponse.height = height;\n\n\t\t\t\taddBidResponse(bid.adUnitCode, bidResponse);\n\t\t\t\tthis.limit -= 1;\n\t\t\t});\n\t\t\tdone();\n\t\t}, this.timeout);\n\t}\n\n\tgetCreative(size, cpm) {\n\t\tconst creative = document.createElement('div');\n\n\t\tcreative.style.background = '#00b7e0';\n\t\tcreative.style.color = '#fff';\n\t\tcreative.style.fontFamily = 'sans-serif';\n\t\tcreative.style.height = '100%';\n\t\tcreative.style.textAlign = 'center';\n\t\tcreative.style.width = '100%';\n\n\t\tconst title = document.createElement('p');\n\n\t\ttitle.innerText = 'Wikia Creative';\n\t\ttitle.style.fontWeight = 'bold';\n\t\ttitle.style.margin = '0';\n\t\ttitle.style.paddingTop = '10px';\n\n\t\tconst details = document.createElement('small');\n\n\t\tdetails.innerText = `cpm: ${cpm}, size: ${size.join('x')}`;\n\n\t\tcreative.appendChild(title);\n\t\tcreative.appendChild(details);\n\n\t\treturn creative.outerHTML;\n\t}\n}\n","import { buildVastUrl, context, utils } from '@wikia/ad-engine';\nimport { BaseAdapter } from './base-adapter';\n\nconst price = utils.queryString.get('wikia_video_adapter');\nconst limit = parseInt(utils.queryString.get('wikia_adapter_limit'), 10) || 99;\nconst timeout = parseInt(utils.queryString.get('wikia_adapter_timeout'), 10) || 0;\nconst useRandomPrice = utils.queryString.get('wikia_adapter_random') === '1';\n\nexport class WikiaVideo extends BaseAdapter {\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.bidderName = 'wikiaVideo';\n\t\tthis.enabled = !!price;\n\t\tthis.limit = limit;\n\t\tthis.useRandomPrice = useRandomPrice;\n\t\tthis.timeout = timeout;\n\n\t\tthis.create = () => this;\n\t}\n\n\tprepareConfigForAdUnit(code) {\n\t\treturn {\n\t\t\tcode,\n\t\t\tmediaTypes: {\n\t\t\t\tvideo: {\n\t\t\t\t\tcontext: 'outstream',\n\t\t\t\t\tplayerSize: [640, 480],\n\t\t\t\t},\n\t\t\t},\n\t\t\tbids: [\n\t\t\t\t{\n\t\t\t\t\tbidder: this.bidderName,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tgetSpec() {\n\t\treturn {\n\t\t\tcode: this.bidderName,\n\t\t\tsupportedMediaTypes: ['video'],\n\t\t};\n\t}\n\n\tgetPrice() {\n\t\tif (this.useRandomPrice) {\n\t\t\treturn Math.floor(Math.random() * 20);\n\t\t}\n\n\t\treturn parseInt(price, 10) / 100;\n\t}\n\n\tgetVastUrl(width, height, slotName) {\n\t\treturn buildVastUrl(width / height, slotName, {\n\t\t\tvideoAdUnitId: context.get(`bidders.prebid.wikiaVideo.slots.${slotName}.videoAdUnitId`),\n\t\t\tcustomParams: context.get(`bidders.prebid.wikiaVideo.slots.${slotName}.customParams`),\n\t\t});\n\t}\n\n\tcallBids(bidRequest, addBidResponse, done) {\n\t\twindow.pbjs.que.push(() => {\n\t\t\tthis.addBids(bidRequest, addBidResponse, done);\n\t\t});\n\t}\n\n\taddBids(bidRequest, addBidResponse, done) {\n\t\tsetTimeout(() => {\n\t\t\tbidRequest.bids.forEach((bid) => {\n\t\t\t\tif (this.limit === 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst bidResponse = window.pbjs.createBid(1);\n\t\t\t\tconst [width, height] = bid.sizes[0];\n\t\t\t\tconst slotName = bid.adUnitCode;\n\n\t\t\t\tbidResponse.bidderCode = bidRequest.bidderCode;\n\t\t\t\tbidResponse.cpm = this.getPrice();\n\t\t\t\tbidResponse.creativeId = 'foo123_wikiaVideoCreativeId';\n\t\t\t\tbidResponse.ttl = 300;\n\t\t\t\tbidResponse.mediaType = 'video';\n\t\t\t\tbidResponse.width = width;\n\t\t\t\tbidResponse.height = height;\n\t\t\t\tbidResponse.vastUrl = this.getVastUrl(width, height, slotName);\n\t\t\t\tbidResponse.videoCacheKey = '123foo_wikiaVideoCacheKey';\n\n\t\t\t\taddBidResponse(bid.adUnitCode, bidResponse);\n\t\t\t\tthis.limit -= 1;\n\t\t\t});\n\n\t\t\tdone();\n\t\t}, this.timeout);\n\t}\n}\n","import { Aol } from './adapters/aol';\nimport { Appnexus } from './adapters/appnexus';\nimport { AppnexusAst } from './adapters/appnexus-ast';\nimport { AudienceNetwork } from './adapters/audience-network';\nimport { Beachfront } from './adapters/beachfront';\nimport { IndexExchange } from './adapters/index-exchange';\nimport { Kargo } from './adapters/kargo';\nimport { Lkqd } from './adapters/lkqd';\nimport { Onemobile } from './adapters/onemobile';\nimport { Openx } from './adapters/openx';\nimport { Pubmatic } from './adapters/pubmatic';\nimport { Rubicon } from './adapters/rubicon';\nimport { RubiconDisplay } from './adapters/rubicon-display';\nimport { Wikia } from './adapters/wikia';\nimport { WikiaVideo } from './adapters/wikia-video';\n\nconst adapters = [];\nconst customAdapters = [];\nconst availableAdapters = {\n\taol: Aol,\n\tappnexus: Appnexus,\n\tappnexusAst: AppnexusAst,\n\taudienceNetwork: AudienceNetwork,\n\tbeachfront: Beachfront,\n\tindexExchange: IndexExchange,\n\tkargo: Kargo,\n\tlkqd: Lkqd,\n\tonemobile: Onemobile,\n\topenx: Openx,\n\tpubmatic: Pubmatic,\n\trubicon: Rubicon,\n\trubiconDisplay: RubiconDisplay,\n};\n\nfunction registerAliases() {\n\tadapters\n\t\t.filter((adapter) => adapter.aliases)\n\t\t.forEach((adapter) => {\n\t\t\twindow.pbjs.que.push(() => {\n\t\t\t\tconst aliasMap = adapter.aliases;\n\n\t\t\t\tObject.keys(aliasMap).forEach((bidderName) => {\n\t\t\t\t\taliasMap[bidderName].forEach((alias) => {\n\t\t\t\t\t\twindow.pbjs.aliasBidder(bidderName, alias);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n}\n\nfunction setupAdapters(bidders) {\n\tObject.keys(availableAdapters).forEach((key) => {\n\t\tif (bidders[key]) {\n\t\t\tconst adapter = new availableAdapters[key](bidders[key]);\n\n\t\t\tadapters.push(adapter);\n\t\t}\n\t});\n\n\tsetupCustomAdapters(bidders);\n}\n\nfunction setupCustomAdapters(bidders) {\n\tif (bidders.wikia) {\n\t\tcustomAdapters.push(new Wikia(bidders.wikia));\n\t}\n\n\tif (bidders.wikiaVideo) {\n\t\tcustomAdapters.push(new WikiaVideo(bidders.wikiaVideo));\n\t}\n\n\tcustomAdapters.forEach((adapter) => {\n\t\tadapters.push(adapter);\n\n\t\twindow.pbjs.que.push(() => {\n\t\t\twindow.pbjs.registerBidAdapter(adapter.create, adapter.bidderName);\n\t\t});\n\t});\n}\n\nexport function getPriorities() {\n\tconst priorities = {};\n\n\tadapters.forEach((adapter) => {\n\t\tpriorities[adapter.bidderName] = adapter.priority || 1;\n\t});\n\n\treturn priorities;\n}\n\nexport function getAdapters(config) {\n\tif (adapters.length === 0 && config) {\n\t\tsetupAdapters(config);\n\t\tregisterAliases();\n\t}\n\n\treturn adapters;\n}\n","import { getAdapters } from './adapters-registry';\nimport { Prebid } from './index';\n\nconst DEFAULT_MAX_CPM = 20;\nconst videoBiddersCap50 = ['appnexusAst', 'rubicon', 'wikiaVideo']; // bidders with $50 cap\n\nfunction isValidPrice(bid) {\n\treturn bid.getStatusCode && bid.getStatusCode() === Prebid.validResponseStatusCode;\n}\n\n/**\n * Round cpm to predefined values.\n *\n * @param {number} cpm\n * @param {number} maxCpm\n * @returns {number}\n */\nfunction roundCpm(cpm, maxCpm) {\n\tlet result = Math.floor(maxCpm);\n\n\tif (cpm === 0) {\n\t\tresult = 0.0;\n\t} else if (cpm < 0.05) {\n\t\tresult = 0.01;\n\t} else if (cpm < 5.0) {\n\t\tresult = Math.floor(cpm * 20) / 20;\n\t} else if (cpm < 10.0) {\n\t\tresult = Math.floor(cpm * 10) / 10;\n\t} else if (cpm < 20.0) {\n\t\tresult = Math.floor(cpm * 2) / 2;\n\t} else if (cpm < maxCpm) {\n\t\tresult = Math.floor(cpm);\n\t}\n\n\treturn result;\n}\n\n/**\n * Round cpm to predefined values and transform to String with 2 decimal places.\n *\n * @param {number} cpm\n * @param {number} maxCpm\n * @returns {string}\n */\nexport function transformPriceFromCpm(cpm, maxCpm = DEFAULT_MAX_CPM) {\n\tmaxCpm = Math.max(maxCpm, DEFAULT_MAX_CPM);\n\n\treturn roundCpm(cpm, maxCpm).toFixed(2);\n}\n\n/**\n *\n * @param {string} slotName\n * @return {object}\n */\nexport function getPrebidBestPrice(slotName) {\n\tconst bestPrices = {};\n\n\tif (window.pbjs && window.pbjs.getBidResponsesForAdUnitCode) {\n\t\tconst slotBids = window.pbjs.getBidResponsesForAdUnitCode(slotName).bids || [];\n\n\t\tgetAdapters().forEach((adapter) => {\n\t\t\tbestPrices[adapter.bidderName] = '';\n\t\t});\n\n\t\tslotBids.forEach((bid) => {\n\t\t\tif (isValidPrice(bid) && bid.status !== 'rendered') {\n\t\t\t\tconst { bidderCode, cpm } = bid;\n\t\t\t\tconst cmpPrice = Math.max(bestPrices[bidderCode] || 0, roundCpm(cpm, DEFAULT_MAX_CPM));\n\n\t\t\t\tif (cmpPrice > 0) {\n\t\t\t\t\tbestPrices[bidderCode] = cmpPrice.toFixed(2);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\treturn bestPrices;\n}\n\nexport function transformPriceFromBid(bid) {\n\tlet maxCpm = DEFAULT_MAX_CPM;\n\n\tif (videoBiddersCap50.includes(bid.bidderCode)) {\n\t\tmaxCpm = 50;\n\t}\n\n\treturn transformPriceFromCpm(bid.cpm, maxCpm);\n}\n","import { context } from '@wikia/ad-engine';\nimport { transformPriceFromBid } from './price-helper';\n\nconst dfpVideoBidders = [\n\t{ bidderCode: 'appnexusAst', contextKey: 'custom.appnexusDfp' },\n\t{ bidderCode: 'beachfront', contextKey: 'custom.beachfrontDfp' },\n\t{ bidderCode: 'lkqd', contextKey: 'custom.lkqdDfp' },\n\t{ bidderCode: 'rubicon', contextKey: 'custom.rubiconDfp' },\n\t{ bidderCode: 'pubmatic', contextKey: 'custom.pubmaticDfp' },\n];\n\nexport function getSettings() {\n\treturn {\n\t\tstandard: {\n\t\t\talwaysUseBid: false,\n\t\t\tadserverTargeting: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_bidder',\n\t\t\t\t\tval: ({ bidderCode }) => bidderCode,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_adid',\n\t\t\t\t\tval: ({ adId }) => adId,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_pb',\n\t\t\t\t\tval: (bidResponse) => transformPriceFromBid(bidResponse),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_size',\n\t\t\t\t\tval: ({ size }) => size,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'hb_uuid',\n\t\t\t\t\tval: (bidResponse) => getBidderUuid(bidResponse),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t};\n}\n\nfunction getBidderUuid(bidResponse) {\n\tconst isVideo = dfpVideoBidders.some(\n\t\t(video) => bidResponse.bidderCode === video.bidderCode && context.get(video.contextKey),\n\t);\n\n\treturn isVideo ? bidResponse.videoCacheKey : 'disabled';\n}\n","import { decorate } from 'core-decorators';\nimport { context, events, eventService, utils } from '@wikia/ad-engine';\nimport { BaseBidder } from '../base-bidder';\nimport { getPriorities } from './adapters-registry';\nimport { getPrebidBestPrice } from './price-helper';\nimport { getSettings } from './prebid-settings';\nimport { getAvailableBidsByAdUnitCode, setupAdUnits } from './prebid-helper';\n\nfunction postponeExecutionUntilPbjsLoads(method) {\n\treturn function (...args) {\n\t\treturn window.pbjs.que.push(() => method.apply(this, args));\n\t};\n}\n\neventService.on(events.VIDEO_AD_IMPRESSION, markWinningBidAsUsed);\neventService.on(events.VIDEO_AD_ERROR, markWinningBidAsUsed);\n\nfunction markWinningBidAsUsed(adSlot) {\n\t// Mark ad as rendered\n\tconst adId = context.get(`slots.${adSlot.getSlotName()}.targeting.hb_adid`);\n\n\tif (adId) {\n\t\tif (window.pbjs && typeof window.pbjs.markWinningBidAsUsed === 'function') {\n\t\t\twindow.pbjs.markWinningBidAsUsed({ adId });\n\t\t\teventService.emit(events.VIDEO_AD_USED, adSlot);\n\t\t}\n\t}\n}\n\nconst logGroup = 'prebid';\n\nlet loaded = false;\n\nwindow.pbjs = window.pbjs || {};\nwindow.pbjs.que = window.pbjs.que || [];\n\nexport class Prebid extends BaseBidder {\n\tstatic validResponseStatusCode = 1;\n\tstatic errorResponseStatusCode = 2;\n\n\tconstructor(bidderConfig, timeout = 2000) {\n\t\tsuper('prebid', bidderConfig, timeout);\n\n\t\tthis.insertScript();\n\n\t\tthis.lazyLoaded = false;\n\t\tthis.isLazyLoadingEnabled = this.bidderConfig.lazyLoadingEnabled;\n\t\tthis.isCMPEnabled = context.get('custom.isCMPEnabled');\n\t\tthis.adUnits = setupAdUnits(this.bidderConfig, this.isLazyLoadingEnabled ? 'pre' : 'off');\n\t\tthis.prebidConfig = {\n\t\t\tdebug:\n\t\t\t\tutils.queryString.get('pbjs_debug') === '1' ||\n\t\t\t\tutils.queryString.get('pbjs_debug') === 'true',\n\t\t\tenableSendAllBids: true,\n\t\t\tbidderSequence: 'random',\n\t\t\tbidderTimeout: this.timeout,\n\t\t\tcache: {\n\t\t\t\turl: 'https://prebid.adnxs.com/pbc/v1/cache',\n\t\t\t},\n\t\t\tuserSync: {\n\t\t\t\tiframeEnabled: true,\n\t\t\t\tenabledBidders: [],\n\t\t\t\tsyncDelay: 6000,\n\t\t\t},\n\t\t};\n\t\tthis.bidsRefreshing = context.get('bidders.prebid.bidsRefreshing');\n\n\t\tif (this.isCMPEnabled) {\n\t\t\tthis.prebidConfig.consentManagement = {\n\t\t\t\tcmpApi: 'iab',\n\t\t\t\ttimeout: this.timeout,\n\t\t\t\tallowAuctionWithoutConsent: false,\n\t\t\t};\n\t\t}\n\n\t\twindow.pbjs = window.pbjs || {};\n\t\twindow.pbjs.que = window.pbjs.que || [];\n\n\t\tthis.applyConfig(this.prebidConfig);\n\n\t\tif (this.bidsRefreshing && this.bidsRefreshing.enabled) {\n\t\t\tthis.registerBidsRefreshing();\n\t\t}\n\t}\n\n\t@decorate(postponeExecutionUntilPbjsLoads)\n\tapplyConfig(config) {\n\t\twindow.pbjs.setConfig(config);\n\t}\n\n\t@decorate(postponeExecutionUntilPbjsLoads)\n\tapplySettings() {\n\t\twindow.pbjs.bidderSettings = getSettings();\n\t}\n\n\tcallBids(bidsBackHandler) {\n\t\tif (!this.adUnits) {\n\t\t\tthis.adUnits = setupAdUnits(this.bidderConfig, this.isLazyLoadingEnabled ? 'pre' : 'off');\n\t\t}\n\n\t\tif (this.adUnits.length > 0) {\n\t\t\tthis.applySettings();\n\t\t\tthis.requestBids(this.adUnits, bidsBackHandler, this.removeAdUnits);\n\t\t}\n\n\t\tif (this.isLazyLoadingEnabled) {\n\t\t\teventService.on(events.PREBID_LAZY_CALL, () => {\n\t\t\t\tthis.lazyCall(bidsBackHandler);\n\t\t\t});\n\t\t}\n\t}\n\n\tinsertScript() {\n\t\tif (loaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst libraryUrl = context.get('bidders.prebid.libraryUrl');\n\n\t\tif (!libraryUrl) {\n\t\t\tutils.logger(\n\t\t\t\tlogGroup,\n\t\t\t\t'Prebid library URL not defined. Assuming that window.pbjs will be loaded.',\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\n\t\tutils.scriptLoader.loadScript(libraryUrl, 'text/javascript', true, 'first');\n\t\tloaded = true;\n\t}\n\n\tlazyCall(bidsBackHandler) {\n\t\tif (this.lazyLoaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.lazyLoaded = true;\n\n\t\tconst adUnitsLazy = setupAdUnits(this.bidderConfig, 'post');\n\n\t\tif (adUnitsLazy.length > 0) {\n\t\t\tthis.requestBids(adUnitsLazy, bidsBackHandler);\n\n\t\t\tthis.adUnits = this.adUnits.concat(adUnitsLazy);\n\t\t}\n\t}\n\n\tremoveAdUnits() {\n\t\t(window.pbjs.adUnits || []).forEach((adUnit) => {\n\t\t\twindow.pbjs.removeAdUnit(adUnit.code);\n\t\t});\n\t}\n\n\tgetBestPrice(slotName) {\n\t\tconst slotAlias = this.getSlotAlias(slotName);\n\n\t\treturn getPrebidBestPrice(slotAlias);\n\t}\n\n\tgetTargetingKeysToReset() {\n\t\treturn ['hb_bidder', 'hb_adid', 'hb_pb', 'hb_size', 'hb_uuid'];\n\t}\n\n\tgetTargetingParams(slotName) {\n\t\tlet slotParams = {};\n\n\t\tconst slotAlias = this.getSlotAlias(slotName);\n\t\tconst bids = getAvailableBidsByAdUnitCode(slotAlias);\n\n\t\tif (bids.length) {\n\t\t\tlet bidParams = null;\n\t\t\tconst priorities = getPriorities();\n\n\t\t\tbids.forEach((param) => {\n\t\t\t\tif (!bidParams) {\n\t\t\t\t\tbidParams = param;\n\t\t\t\t} else if (bidParams.cpm === param.cpm) {\n\t\t\t\t\tif (priorities[bidParams.bidder] === priorities[param.bidder]) {\n\t\t\t\t\t\tbidParams = bidParams.timeToRespond > param.timeToRespond ? param : bidParams;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbidParams = priorities[bidParams.bidder] < priorities[param.bidder] ? param : bidParams;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tbidParams = bidParams.cpm < param.cpm ? param : bidParams;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (bidParams) {\n\t\t\t\tslotParams = bidParams.adserverTargeting;\n\t\t\t}\n\n\t\t\t// ADEN-7436: AppNexus hb_uuid fix\n\t\t\t// (adserverTargeting params are being set before cache key is returned)\n\t\t\tslotParams.hb_uuid = slotParams.hb_uuid || bidParams.videoCacheKey || 'disabled';\n\t\t}\n\n\t\treturn slotParams || {};\n\t}\n\n\tisSupported(slotName) {\n\t\tconst slotAlias = this.getSlotAlias(slotName);\n\n\t\treturn this.adUnits && this.adUnits.some((adUnit) => adUnit.code === slotAlias);\n\t}\n\n\tregisterBidsRefreshing() {\n\t\twindow.pbjs.que.push(() => {\n\t\t\tconst refreshUsedBid = (winningBid) => {\n\t\t\t\tif (this.bidsRefreshing.slots.indexOf(winningBid.adUnitCode) !== -1) {\n\t\t\t\t\teventService.emit(events.BIDS_REFRESH);\n\t\t\t\t\tconst adUnitsToRefresh = this.adUnits.filter(\n\t\t\t\t\t\t(adUnit) =>\n\t\t\t\t\t\t\tadUnit.code === winningBid.adUnitCode &&\n\t\t\t\t\t\t\tadUnit.bids &&\n\t\t\t\t\t\t\tadUnit.bids[0] &&\n\t\t\t\t\t\t\tadUnit.bids[0].bidder === winningBid.bidderCode,\n\t\t\t\t\t);\n\n\t\t\t\t\tthis.requestBids(adUnitsToRefresh, this.bidsRefreshing.bidsBackHandler);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\twindow.pbjs.onEvent('bidWon', refreshUsedBid);\n\t\t\teventService.once(events.PAGE_CHANGE_EVENT, () => {\n\t\t\t\twindow.pbjs.offEvent('bidWon', refreshUsedBid);\n\t\t\t});\n\t\t});\n\t}\n\n\t@decorate(postponeExecutionUntilPbjsLoads)\n\trequestBids(adUnits, bidsBackHandler, withRemove = undefined) {\n\t\tif (withRemove) {\n\t\t\twithRemove();\n\t\t}\n\n\t\twindow.pbjs.requestBids({\n\t\t\tadUnits,\n\t\t\tbidsBackHandler,\n\t\t});\n\t}\n}\n","import { context, events, eventService, utils } from '@wikia/ad-engine';\nimport { A9 } from './a9';\nimport { Prebid } from './prebid';\nimport * as prebidHelper from './prebid/prebid-helper';\nimport { transformPriceFromBid } from './prebid/price-helper';\n\nconst biddersRegistry = {};\nconst realSlotPrices = {};\nconst logGroup = 'bidders';\n\neventService.on(events.VIDEO_AD_REQUESTED, (adSlot) => {\n\tadSlot.updateWinningPbBidderDetails();\n});\n\neventService.on(events.VIDEO_AD_USED, (adSlot) => {\n\tupdateSlotTargeting(adSlot.getSlotName());\n});\n\nfunction applyTargetingParams(slotName, targeting) {\n\tObject.keys(targeting).forEach((key) =>\n\t\tcontext.set(`slots.${slotName}.targeting.${key}`, targeting[key]),\n\t);\n}\n\n/**\n * Executes callback function on each enabled bidder\n *\n * @param {function} callback\n */\nfunction forEachBidder(callback) {\n\tObject.keys(biddersRegistry).forEach((bidderName) => {\n\t\tcallback(biddersRegistry[bidderName]);\n\t});\n}\n\nfunction getBidParameters(slotName) {\n\tconst slotParams = {};\n\n\tforEachBidder((bidder) => {\n\t\tif (bidder && bidder.wasCalled()) {\n\t\t\tconst params = bidder.getSlotTargetingParams(slotName);\n\n\t\t\tObject.assign(slotParams, params);\n\t\t}\n\t});\n\n\treturn slotParams;\n}\n\nfunction getCurrentSlotPrices(slotName) {\n\tconst slotPrices = {};\n\n\tforEachBidder((bidder) => {\n\t\tif (bidder && bidder.isSlotSupported(slotName)) {\n\t\t\tconst priceFromBidder = bidder.getSlotBestPrice(slotName);\n\n\t\t\tObject.keys(priceFromBidder).forEach((bidderName) => {\n\t\t\t\tslotPrices[bidderName] = priceFromBidder[bidderName];\n\t\t\t});\n\t\t}\n\t});\n\n\treturn slotPrices;\n}\n\nfunction getDfpSlotPrices(slotName) {\n\treturn realSlotPrices[slotName] || {};\n}\n\n/**\n * Returns true if all bidders replied\n *\n * @returns {boolean}\n */\nfunction hasAllResponses() {\n\tconst missingBidders = Object.keys(biddersRegistry).filter((bidderName) => {\n\t\tconst bidder = biddersRegistry[bidderName];\n\n\t\treturn !bidder.hasResponse();\n\t});\n\n\treturn missingBidders.length === 0;\n}\n\nfunction resetTargetingKeys(slotName) {\n\tforEachBidder((bidder) => {\n\t\tbidder.getTargetingKeysToReset().forEach((key) => {\n\t\t\tcontext.remove(`slots.${slotName}.targeting.${key}`);\n\t\t});\n\t});\n\n\tutils.logger(logGroup, 'resetTargetingKeys', slotName);\n}\n\nfunction requestBids({ responseListener = null }) {\n\tconst config = context.get('bidders');\n\n\tif (config.prebid && config.prebid.enabled) {\n\t\tbiddersRegistry.prebid = new Prebid(config.prebid, config.timeout);\n\t}\n\n\tif (config.a9 && config.a9.enabled) {\n\t\tbiddersRegistry.a9 = new A9(config.a9, config.timeout);\n\t}\n\n\tforEachBidder((bidder) => {\n\t\tif (responseListener) {\n\t\t\tbidder.addResponseListener(responseListener);\n\t\t}\n\n\t\tbidder.call();\n\t});\n}\n\n/**\n * Executes callback function if bidding is finished or timeout is reached\n *\n * @param {function} callback\n *\n * @returns {Promise}\n */\nfunction runOnBiddingReady(callback) {\n\tconst responses = [];\n\n\tforEachBidder((bidder) => {\n\t\tresponses.push(bidder.waitForResponse());\n\t});\n\n\treturn Promise.all(responses).then(callback);\n}\n\nfunction storeRealSlotPrices(slotName) {\n\trealSlotPrices[slotName] = getCurrentSlotPrices(slotName);\n}\n\nfunction updateSlotTargeting(slotName) {\n\tconst bidderTargeting = getBidParameters(slotName);\n\n\tstoreRealSlotPrices(slotName);\n\n\tresetTargetingKeys(slotName);\n\tapplyTargetingParams(slotName, bidderTargeting);\n\n\tutils.logger(logGroup, 'updateSlotTargeting', slotName, bidderTargeting);\n\n\treturn bidderTargeting;\n}\n\nexport const bidders = {\n\tgetBidParameters,\n\tgetCurrentSlotPrices,\n\tgetDfpSlotPrices,\n\thasAllResponses,\n\tprebidHelper,\n\trequestBids,\n\trunOnBiddingReady,\n\ttransformPriceFromBid,\n\tupdateSlotTargeting,\n};\n"],"sourceRoot":""}
>>>>>>> 397c1d50... ts-cleanup Refactor EventService.
